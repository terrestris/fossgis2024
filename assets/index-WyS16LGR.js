import{ac as Ha,K as yi,J as xi,E as vt,ad as hi,ae as Za,af as Ei,ag as Ja,ah as Ka,ai as Ii,aj as Qa,ak as je,Y as In,al as ot,am as el,an as tl,ao as il,ap as Ut,aq as lo,ar as nl,as as uo,at as rl,au as sl,av as ar,aw as co,ax as ol,ay as Mr,a9 as al,n as Ki,az as ll,aA as ho,I as _i,aB as ul,aC as cl,aD as hl,aE as dl,aF as lr,aG as ur,aH as fo,aI as po,aJ as fl,a7 as Qi,aK as pl,aL as go,l as gl,aM as ml,aN as mo,g as me,aO as wt,aP as ti,aQ as Zt,aR as yl,aS as Ct,aT as xl,aU as en,aV as _l,aW as Fe,aX as bl,aY as vl,aZ as ii,a_ as si,X as tn,a$ as wl,b0 as Cl,b1 as Sl,b2 as yt,b3 as Ne,b4 as nn,b5 as rn,b6 as at,b7 as lt,b8 as sn,b9 as on,ba as an,z as Rn,bb as Tl,x as _t,bc as El,_ as be,bd as zt,be as bi,bf as ln,bg as yo,bh as xo,r as Y,a1 as Il,bi as _o,bj as Rl,bk as gt,Z as cr,bl as Fl,bm as kl,bn as ms,bo as St,bp as Ml,bq as un,a8 as Ll,br as Pl,w as hr,bs as Lr,F as cn,bt as dr,ab as ys,bu as re,bv as bo,bw as We,bx as Ye,by as vo,bz as xs,bA as Al,bB as wo,bC as Co,bD as _s,v as fr,bE as st,bF as So,bG as Dl,bH as Ol,bI as To,bJ as zl,bK as ni,bL as Eo,bM as Ri,C as Gl,bN as jl,j as bs,bO as Nl,D as Pr,T as Wl,bP as Ar,bQ as Io,bR as Q,bS as Ro,bT as Fn,bU as Fo,N as Bl,P as $l,bV as ql,bW as Vl,bX as Xl,bY as Ul,bZ as Yl,b_ as Ai,b$ as Hl,c0 as Zl,c1 as Jl,R as ko,c2 as Kl,c3 as Ql,c4 as eu,c5 as Mo,c6 as Dr,c7 as tu,c8 as iu,k as nu,c9 as Lo,ca as Po,cb as ru,cc as jn,cd as vs,ce as su,cf as Di,cg as ou,ch as au,ci as lu,cj as uu,ck as Or,cl as cu,cm as hu,Q as Ao,V as du,cn as pr,S as gr,co as hn,cp as fu,cq as pu,cr as Oi,cs as zi,ct as Wt,cu as gu,cv as mu}from"./Tile-CNT6xDI4.js";class kn extends Ha{constructor(e){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),e)if(typeof e.getSimplifiedGeometry=="function"){const t=e;this.setGeometry(t)}else{const t=e;this.setProperties(t)}}clone(){const e=new kn(this.hasProperties()?this.getProperties():null);e.setGeometryName(this.getGeometryName());const t=this.getGeometry();t&&e.setGeometry(t.clone());const i=this.getStyle();return i&&e.setStyle(i),e}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(yi(this.geometryChangeKey_),this.geometryChangeKey_=null);const e=this.getGeometry();e&&(this.geometryChangeKey_=xi(e,vt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(e){this.set(this.geometryName_,e)}setStyle(e){this.style_=e,this.styleFunction_=e?yu(e):void 0,this.changed()}setId(e){this.id_=e,this.changed()}setGeometryName(e){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=e,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function yu(n){if(typeof n=="function")return n;let e;return Array.isArray(n)?e=n:(hi(typeof n.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),e=[n]),function(){return e}}class dn extends Za{constructor(e){super(),this.geometries_=e,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(yi),this.changeEventsKeys_.length=0}listenGeometriesChange_(){const e=this.geometries_;for(let t=0,i=e.length;t<i;++t)this.changeEventsKeys_.push(xi(e[t],vt.CHANGE,this.changed,this))}clone(){const e=new dn(Nn(this.geometries_));return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<Ei(this.getExtent(),e,t))return r;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)r=s[o].closestPointXY(e,t,i,r);return r}containsXY(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)if(i[r].containsXY(e,t))return!0;return!1}computeExtent(e){Ja(e);const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)Ka(e,t[i].getExtent());return e}getGeometries(){return Nn(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let e=[];const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].getType()===this.getType()?e=e.concat(t[i].getGeometriesArrayRecursive()):e.push(t[i]);return e}getSimplifiedGeometry(e){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),e<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&e<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const t=[],i=this.geometries_;let r=!1;for(let s=0,o=i.length;s<o;++s){const a=i[s],l=a.getSimplifiedGeometry(e);t.push(l),l!==a&&(r=!0)}return r?new dn(t):(this.simplifiedGeometryMaxMinSquaredTolerance=e,this)}getType(){return"GeometryCollection"}intersectsExtent(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)if(t[i].intersectsExtent(e))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].rotate(e,t);this.changed()}scale(e,t,i){i||(i=Ii(this.getExtent()));const r=this.geometries_;for(let s=0,o=r.length;s<o;++s)r[s].scale(e,t,i);this.changed()}setGeometries(e){this.setGeometriesArray(Nn(e))}setGeometriesArray(e){this.unlistenGeometriesChange_(),this.geometries_=e,this.listenGeometriesChange_(),this.changed()}applyTransform(e){const t=this.geometries_;for(let i=0,r=t.length;i<r;++i)t[i].applyTransform(e);this.changed()}translate(e,t){const i=this.geometries_;for(let r=0,s=i.length;r<s;++r)i[r].translate(e,t);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function Nn(n){return n.map(e=>e.clone())}const xu=dn;function fn(n,e,t,i,r,s,o){let a,l;const u=(t-e)/i;if(u===1)a=e;else if(u===2)a=e,l=r;else if(u!==0){let c=n[e],h=n[e+1],d=0;const f=[0];for(let g=e+i;g<t;g+=i){const y=n[g],x=n[g+1];d+=Math.sqrt((y-c)*(y-c)+(x-h)*(x-h)),f.push(d),c=y,h=x}const p=r*d,m=Qa(f,p);m<0?(l=(p-f[-m-2])/(f[-m-1]-f[-m-2]),a=e+(-m-2)*i):a=e+m*i}o=o>1?o:2,s=s||new Array(o);for(let c=0;c<o;++c)s[c]=a===void 0?NaN:l===void 0?n[a+c]:je(n[a+c],n[a+i+c],l);return s}function mr(n,e,t,i,r,s){if(t==e)return null;let o;if(r<n[e+i-1])return s?(o=n.slice(e,e+i),o[i-1]=r,o):null;if(n[t-1]<r)return s?(o=n.slice(t-i,t),o[i-1]=r,o):null;if(r==n[e+i-1])return n.slice(e,e+i);let a=e/i,l=t/i;for(;a<l;){const d=a+l>>1;r<n[(d+1)*i-1]?l=d:a=d+1}const u=n[a*i-1];if(r==u)return n.slice((a-1)*i,(a-1)*i+i);const c=n[(a+1)*i-1],h=(r-u)/(c-u);o=[];for(let d=0;d<i-1;++d)o.push(je(n[(a-1)*i+d],n[a*i+d],h));return o.push(r),o}function _u(n,e,t,i,r,s,o){if(o)return mr(n,e,t[t.length-1],i,r,s);let a;if(r<n[i-1])return s?(a=n.slice(0,i),a[i-1]=r,a):null;if(n[n.length-1]<r)return s?(a=n.slice(n.length-i),a[i-1]=r,a):null;for(let l=0,u=t.length;l<u;++l){const c=t[l];if(e!=c){if(r<n[e+i-1])return null;if(r<=n[c-1])return mr(n,e,c,i,r,!1);e=c}}return null}function Do(n,e,t,i){let r=n[e],s=n[e+1],o=0;for(let a=e+i;a<t;a+=i){const l=n[a],u=n[a+1];o+=Math.sqrt((l-r)*(l-r)+(u-s)*(u-s)),r=l,s=u}return o}class Nt extends In{constructor(e,t){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,t!==void 0&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendCoordinate(e){ot(this.flatCoordinates,e),this.changed()}clone(){const e=new Nt(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<Ei(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(el(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),tl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,e,t,i,r))}forEachSegment(e){return il(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}getCoordinateAtM(e,t){return this.layout!="XYM"&&this.layout!="XYZM"?null:(t=t!==void 0?t:!1,mr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t))}getCoordinates(){return Ut(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(e,t){return fn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,this.stride)}getLength(){return Do(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(e){const t=[];return t.length=lo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e,t,0),new Nt(t,"XY")}getType(){return"LineString"}intersectsExtent(e){return nl(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=uo(this.flatCoordinates,0,e,this.stride),this.changed()}}class vi extends In{constructor(e,t,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(e[0]))this.setCoordinates(e,t);else if(t!==void 0&&i)this.setFlatCoordinates(t,e),this.ends_=i;else{const r=e,s=[],o=[];for(let l=0,u=r.length;l<u;++l){const c=r[l];ot(s,c.getFlatCoordinates()),o.push(s.length)}const a=r.length===0?this.getLayout():r[0].getLayout();this.setFlatCoordinates(a,s),this.ends_=o}}appendLineString(e){ot(this.flatCoordinates,e.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const e=new vi(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return e.applyProperties(this),e}closestPointXY(e,t,i,r){return r<Ei(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(rl(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),sl(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,e,t,i,r))}getCoordinateAtM(e,t,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(t=t!==void 0?t:!1,i=i!==void 0?i:!1,_u(this.flatCoordinates,0,this.ends_,this.stride,e,t,i))}getCoordinates(){return ar(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(e){return e<0||this.ends_.length<=e?null:new Nt(this.flatCoordinates.slice(e===0?0:this.ends_[e-1],this.ends_[e]),this.layout)}getLineStrings(){const e=this.flatCoordinates,t=this.ends_,i=this.layout,r=[];let s=0;for(let o=0,a=t.length;o<a;++o){const l=t[o],u=new Nt(e.slice(s,l),i);r.push(u),s=l}return r}getFlatMidpoints(){const e=[],t=this.flatCoordinates;let i=0;const r=this.ends_,s=this.stride;for(let o=0,a=r.length;o<a;++o){const l=r[o],u=fn(t,i,l,s,.5);ot(e,u),i=l}return e}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=co(this.flatCoordinates,0,this.ends_,this.stride,e,t,0,i),new vi(t,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(e){return ol(this.flatCoordinates,0,this.ends_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Mr(this.flatCoordinates,0,e,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Fi extends In{constructor(e,t){super(),t&&!Array.isArray(e[0])?this.setFlatCoordinates(t,e):this.setCoordinates(e,t)}appendPoint(e){ot(this.flatCoordinates,e.getFlatCoordinates()),this.changed()}clone(){const e=new Fi(this.flatCoordinates.slice(),this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,r){if(r<Ei(this.getExtent(),e,t))return r;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const u=al(e,t,s[a],s[a+1]);if(u<r){r=u;for(let c=0;c<o;++c)i[c]=s[a+c];i.length=o}}return r}getCoordinates(){return Ut(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(e){const t=this.flatCoordinates.length/this.stride;return e<0||t<=e?null:new Ki(this.flatCoordinates.slice(e*this.stride,(e+1)*this.stride),this.layout)}getPoints(){const e=this.flatCoordinates,t=this.layout,i=this.stride,r=[];for(let s=0,o=e.length;s<o;s+=i){const a=new Ki(e.slice(s,s+i),t);r.push(a)}return r}getType(){return"MultiPoint"}intersectsExtent(e){const t=this.flatCoordinates,i=this.stride;for(let r=0,s=t.length;r<s;r+=i){const o=t[r],a=t[r+1];if(ll(e,o,a))return!0}return!1}setCoordinates(e,t){this.setLayout(t,e,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=uo(this.flatCoordinates,0,e,this.stride),this.changed()}}function Oo(n,e,t,i){const r=[];let s=_i();for(let o=0,a=t.length;o<a;++o){const l=t[o];s=ho(n,e,l[0],i),r.push((s[0]+s[2])/2,(s[1]+s[3])/2),e=l[l.length-1]}return r}class wi extends In{constructor(e,t,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){const r=e,s=[],o=[];for(let a=0,l=r.length;a<l;++a){const u=r[a],c=s.length,h=u.getEnds();for(let d=0,f=h.length;d<f;++d)h[d]+=c;ot(s,u.getFlatCoordinates()),o.push(h)}t=r.length===0?this.getLayout():r[0].getLayout(),e=s,i=o}t!==void 0&&i?(this.setFlatCoordinates(t,e),this.endss_=i):this.setCoordinates(e,t)}appendPolygon(e){let t;if(!this.flatCoordinates)this.flatCoordinates=e.getFlatCoordinates().slice(),t=e.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;ot(this.flatCoordinates,e.getFlatCoordinates()),t=e.getEnds().slice();for(let r=0,s=t.length;r<s;++r)t[r]+=i}this.endss_.push(t),this.changed()}clone(){const e=this.endss_.length,t=new Array(e);for(let r=0;r<e;++r)t[r]=this.endss_[r].slice();const i=new wi(this.flatCoordinates.slice(),this.layout,t);return i.applyProperties(this),i}closestPointXY(e,t,i,r){return r<Ei(this.getExtent(),e,t)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ul(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),cl(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,e,t,i,r))}containsXY(e,t){return hl(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e,t)}getArea(){return dl(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(e){let t;return e!==void 0?(t=this.getOrientedFlatCoordinates().slice(),lr(t,0,this.endss_,this.stride,e)):t=this.flatCoordinates,ur(t,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const e=Oo(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=fo(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Fi(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const e=this.flatCoordinates;po(e,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=e:(this.orientedFlatCoordinates_=e.slice(),this.orientedFlatCoordinates_.length=lr(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(e){const t=[],i=[];return t.length=fl(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(e),t,0,i),new wi(t,"XY",i)}getPolygon(e){if(e<0||this.endss_.length<=e)return null;let t;if(e===0)t=0;else{const s=this.endss_[e-1];t=s[s.length-1]}const i=this.endss_[e].slice(),r=i[i.length-1];if(t!==0)for(let s=0,o=i.length;s<o;++s)i[s]-=t;return new Qi(this.flatCoordinates.slice(t,r),this.layout,i)}getPolygons(){const e=this.layout,t=this.flatCoordinates,i=this.endss_,r=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),u=l[l.length-1];if(s!==0)for(let h=0,d=l.length;h<d;++h)l[h]-=s;const c=new Qi(t.slice(s,u),e,l);r.push(c),s=u}return r}getType(){return"MultiPolygon"}intersectsExtent(e){return pl(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,e)}setCoordinates(e,t){this.setLayout(t,e,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=go(this.flatCoordinates,0,e,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const r=i[i.length-1];this.flatCoordinates.length=r.length===0?0:r[r.length-1]}this.changed()}}const ws=Ct();class _e{constructor(e,t,i,r,s,o){this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=t,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=i||null,this.properties_=s,this.squaredTolerance_,this.stride_=r,this.simplifiedGeometry_}get(e){return this.properties_[e]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?gl(this.flatCoordinates_):ho(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){const e=Ii(this.getExtent());this.flatInteriorPoints_=ml(this.flatCoordinates_,0,this.ends_,2,e,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){const e=mo(this.flatCoordinates_,this.ends_),t=Oo(this.flatCoordinates_,0,e,2);this.flatInteriorPoints_=fo(this.flatCoordinates_,0,e,2,t)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=fn(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];const e=this.flatCoordinates_;let t=0;const i=this.ends_;for(let r=0,s=i.length;r<s;++r){const o=i[r],a=fn(e,t,o,2,.5);ot(this.flatMidpoints_,a),t=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(e){return this}simplifyTransformed(e,t){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(e){e=me(e);const t=e.getExtent(),i=e.getWorldExtent();if(t&&i){const r=wt(i)/wt(t);ti(ws,i[0],i[3],r,-r,0,0,0),Zt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,ws,this.flatCoordinates_)}}applyTransform(e){e(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){var e;return new _e(this.type_,this.flatCoordinates_.slice(),(e=this.ends_)==null?void 0:e.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=yl((e,t)=>{if(e===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),t&&this.simplifiedGeometry_.applyTransform(t);const i=this.simplifiedGeometry_.getFlatCoordinates();let r;switch(this.type_){case"LineString":i.length=lo(i,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,e,i,0),r=[i.length];break;case"MultiLineString":r=[],i.length=co(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,e,i,0,r);break;case"Polygon":r=[],i.length=xl(i,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(e),i,0,r);break}return r&&(this.simplifiedGeometry_=new _e(this.type_,i,r,2,this.properties_,this.id_)),this.squaredTolerance_=e,this.simplifiedGeometry_}),this}}_e.prototype.getFlatCoordinates=_e.prototype.getOrientedFlatCoordinates;class zo{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=kn,this.supportedMediaTypes=null}getReadOptions(e,t){if(t){let i=t.dataProjection?me(t.dataProjection):this.readProjection(e);t.extent&&i&&i.getUnits()==="tile-pixels"&&(i=me(i),i.setWorldExtent(t.extent)),t={dataProjection:i,featureProjection:t.featureProjection}}return this.adaptOptions(t)}adaptOptions(e){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},e)}getType(){return Fe()}readFeature(e,t){return Fe()}readFeatures(e,t){return Fe()}readGeometry(e,t){return Fe()}readProjection(e){return Fe()}writeFeature(e,t){return Fe()}writeFeatures(e,t){return Fe()}writeGeometry(e,t){return Fe()}}function Mn(n,e,t){const i=t?me(t.featureProjection):null,r=t?me(t.dataProjection):null;let s=n;if(i&&r&&!en(i,r)){e&&(s=n.clone());const o=e?i:r,a=e?r:i;o.getUnits()==="tile-pixels"?s.transform(o,a):s.applyTransform(_l(o,a))}if(e&&t&&t.decimals!==void 0){const o=Math.pow(10,t.decimals),a=function(l){for(let u=0,c=l.length;u<c;++u)l[u]=Math.round(l[u]*o)/o;return l};s===n&&(s=n.clone()),s.applyTransform(a)}return s}const bu={Point:Ki,LineString:Nt,Polygon:Qi,MultiPoint:Fi,MultiLineString:vi,MultiPolygon:wi};function vu(n,e,t){return Array.isArray(e[0])?(po(n,0,e,t)||(n=n.slice(),lr(n,0,e,t)),n):(bl(n,0,e,t)||(n=n.slice(),vl(n,0,e,t)),n)}function Go(n,e){var s;const t=n.geometry;if(!t)return[];if(Array.isArray(t))return t.map(o=>Go({...n,geometry:o})).flat();const i=t.type==="MultiPolygon"?"Polygon":t.type;if(i==="GeometryCollection"||i==="Circle")throw new Error("Unsupported geometry type: "+i);const r=t.layout.length;return Mn(new _e(i,i==="Polygon"?vu(t.flatCoordinates,t.ends,r):t.flatCoordinates,(s=t.ends)==null?void 0:s.flat(),r,n.properties||{},n.id).enableSimplifyTransformed(),!1,e)}function zr(n,e){if(!n)return null;if(Array.isArray(n)){const i=n.map(r=>zr(r,e));return new xu(i)}const t=bu[n.type];return Mn(new t(n.flatCoordinates,n.layout,n.ends),!1,e)}class wu extends zo{constructor(){super()}getType(){return"json"}readFeature(e,t){return this.readFeatureFromObject(Gi(e),this.getReadOptions(e,t))}readFeatures(e,t){return this.readFeaturesFromObject(Gi(e),this.getReadOptions(e,t))}readFeatureFromObject(e,t){return Fe()}readFeaturesFromObject(e,t){return Fe()}readGeometry(e,t){return this.readGeometryFromObject(Gi(e),this.getReadOptions(e,t))}readGeometryFromObject(e,t){return Fe()}readProjection(e){return this.readProjectionFromObject(Gi(e))}readProjectionFromObject(e){return Fe()}writeFeature(e,t){return JSON.stringify(this.writeFeatureObject(e,t))}writeFeatureObject(e,t){return Fe()}writeFeatures(e,t){return JSON.stringify(this.writeFeaturesObject(e,t))}writeFeaturesObject(e,t){return Fe()}writeGeometry(e,t){return JSON.stringify(this.writeGeometryObject(e,t))}writeGeometryObject(e,t){return Fe()}}function Gi(n){if(typeof n=="string"){const e=JSON.parse(n);return e||null}return n!==null?n:null}class Cu extends wu{constructor(e){e=e||{},super(),this.dataProjection=me(e.dataProjection?e.dataProjection:"EPSG:4326"),e.featureProjection&&(this.defaultFeatureProjection=me(e.featureProjection)),e.featureClass&&(this.featureClass=e.featureClass),this.geometryName_=e.geometryName,this.extractGeometryName_=e.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(e,t){let i=null;e.type==="Feature"?i=e:i={type:"Feature",geometry:e,properties:null};const r=Gr(i.geometry);if(this.featureClass===_e)return Go({geometry:r,id:i.id,properties:i.properties},t);const s=new kn;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&i.geometry_name&&s.setGeometryName(i.geometry_name),s.setGeometry(zr(r,t)),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(e,t){const i=e;let r=null;if(i.type==="FeatureCollection"){const s=e;r=[];const o=s.features;for(let a=0,l=o.length;a<l;++a){const u=this.readFeatureFromObject(o[a],t);u&&r.push(u)}}else r=[this.readFeatureFromObject(e,t)];return r.flat()}readGeometryFromObject(e,t){return Su(e,t)}readProjectionFromObject(e){const t=e.crs;let i;if(t)if(t.type=="name")i=me(t.properties.name);else if(t.type==="EPSG")i=me("EPSG:"+t.properties.code);else throw new Error("Unknown SRS type");else i=this.dataProjection;return i}writeFeatureObject(e,t){t=this.adaptOptions(t);const i={type:"Feature",geometry:null,properties:null},r=e.getId();if(r!==void 0&&(i.id=r),!e.hasProperties())return i;const s=e.getProperties(),o=e.getGeometry();return o&&(i.geometry=yr(o,t),delete s[e.getGeometryName()]),ii(s)||(i.properties=s),i}writeFeaturesObject(e,t){t=this.adaptOptions(t);const i=[];for(let r=0,s=e.length;r<s;++r)i.push(this.writeFeatureObject(e[r],t));return{type:"FeatureCollection",features:i}}writeGeometryObject(e,t){return yr(e,this.adaptOptions(t))}}function Gr(n,e){if(!n)return null;let t;switch(n.type){case"Point":{t=Eu(n);break}case"LineString":{t=Iu(n);break}case"Polygon":{t=Mu(n);break}case"MultiPoint":{t=Fu(n);break}case"MultiLineString":{t=Ru(n);break}case"MultiPolygon":{t=ku(n);break}case"GeometryCollection":{t=Tu(n);break}default:throw new Error("Unsupported GeoJSON type: "+n.type)}return t}function Su(n,e){const t=Gr(n);return zr(t,e)}function Tu(n,e){return n.geometries.map(function(i){return Gr(i)})}function Eu(n){const e=n.coordinates;return{type:"Point",flatCoordinates:e,layout:si(e.length)}}function Iu(n){var i;const e=n.coordinates,t=e.flat();return{type:"LineString",flatCoordinates:t,ends:[t.length],layout:si(((i=e[0])==null?void 0:i.length)||2)}}function Ru(n){var s,o;const e=n.coordinates,t=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length)||2,i=[],r=Mr(i,0,e,t);return{type:"MultiLineString",flatCoordinates:i,ends:r,layout:si(t)}}function Fu(n){var t;const e=n.coordinates;return{type:"MultiPoint",flatCoordinates:e.flat(),layout:si(((t=e[0])==null?void 0:t.length)||2)}}function ku(n){var s,o;const e=n.coordinates,t=[],i=((o=(s=e[0])==null?void 0:s[0])==null?void 0:o[0].length)||2,r=go(t,0,e,i);return{type:"MultiPolygon",flatCoordinates:t,ends:r,layout:si(i)}}function Mu(n){var s,o;const e=n.coordinates,t=[],i=(o=(s=e[0])==null?void 0:s[0])==null?void 0:o.length,r=Mr(t,0,e,i);return{type:"Polygon",flatCoordinates:t,ends:r,layout:si(i)}}function yr(n,e){n=Mn(n,!0,e);const t=n.getType();let i;switch(t){case"Point":{i=zu(n);break}case"LineString":{i=Pu(n);break}case"Polygon":{i=Gu(n,e);break}case"MultiPoint":{i=Du(n);break}case"MultiLineString":{i=Au(n);break}case"MultiPolygon":{i=Ou(n,e);break}case"GeometryCollection":{i=Lu(n,e);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return i}function Lu(n,e){return e=Object.assign({},e),delete e.featureProjection,{type:"GeometryCollection",geometries:n.getGeometriesArray().map(function(i){return yr(i,e)})}}function Pu(n,e){return{type:"LineString",coordinates:n.getCoordinates()}}function Au(n,e){return{type:"MultiLineString",coordinates:n.getCoordinates()}}function Du(n,e){return{type:"MultiPoint",coordinates:n.getCoordinates()}}function Ou(n,e){let t;return e&&(t=e.rightHanded),{type:"MultiPolygon",coordinates:n.getCoordinates(t)}}function zu(n,e){return{type:"Point",coordinates:n.getCoordinates()}}function Gu(n,e){let t;return e&&(t=e.rightHanded),{type:"Polygon",coordinates:n.getCoordinates(t)}}const Cs=Cu,j={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},ji=[j.FILL],xt=[j.STROKE],Gt=[j.BEGIN_PATH],Ss=[j.CLOSE_PATH];class jo{drawCustom(e,t,i,r,s){}drawGeometry(e){}setStyle(e){}drawCircle(e,t,i){}drawFeature(e,t,i){}drawGeometryCollection(e,t,i){}drawLineString(e,t,i){}drawMultiLineString(e,t,i){}drawMultiPoint(e,t,i){}drawMultiPolygon(e,t,i){}drawPoint(e,t,i){}drawPolygon(e,t,i){}drawText(e,t,i){}setFillStrokeStyle(e,t){}setImageStyle(e,t){}setTextStyle(e,t){}}class ki extends jo{constructor(e,t,i,r){super(),this.tolerance=e,this.maxExtent=t,this.pixelRatio=r,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(e){const t=this.pixelRatio;return t==1?e:e.map(function(i){return i*t})}appendFlatPointCoordinates(e,t){const i=this.getBufferedMaxExtent(),r=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=e.length;a<l;a+=t)r[0]=e[a],r[1]=e[a+1],tn(i,r)&&(s[o++]=r[0],s[o++]=r[1]);return o}appendFlatLineCoordinates(e,t,i,r,s,o){const a=this.coordinates;let l=a.length;const u=this.getBufferedMaxExtent();o&&(t+=r);let c=e[t],h=e[t+1];const d=this.tmpCoordinate_;let f=!0,p,m,g;for(p=t+r;p<i;p+=r)d[0]=e[p],d[1]=e[p+1],g=wl(u,d),g!==m?(f&&(a[l++]=c,a[l++]=h,f=!1),a[l++]=d[0],a[l++]=d[1]):g===Cl.INTERSECTING?(a[l++]=d[0],a[l++]=d[1],f=!1):f=!0,c=d[0],h=d[1],m=g;return(s&&f||p===t+r)&&(a[l++]=c,a[l++]=h),l}drawCustomCoordinates_(e,t,i,r,s){for(let o=0,a=i.length;o<a;++o){const l=i[o],u=this.appendFlatLineCoordinates(e,t,l,r,!1,!1);s.push(u),t=l}return t}drawCustom(e,t,i,r,s){this.beginGeometry(e,t,s);const o=e.getType(),a=e.getStride(),l=this.coordinates.length;let u,c,h,d,f;switch(o){case"MultiPolygon":u=e.getOrientedFlatCoordinates(),d=[];const p=e.getEndss();f=0;for(let m=0,g=p.length;m<g;++m){const y=[];f=this.drawCustomCoordinates_(u,f,p[m],a,y),d.push(y)}this.instructions.push([j.CUSTOM,l,d,e,i,ur,s]),this.hitDetectionInstructions.push([j.CUSTOM,l,d,e,r||i,ur,s]);break;case"Polygon":case"MultiLineString":h=[],u=o=="Polygon"?e.getOrientedFlatCoordinates():e.getFlatCoordinates(),f=this.drawCustomCoordinates_(u,0,e.getEnds(),a,h),this.instructions.push([j.CUSTOM,l,h,e,i,ar,s]),this.hitDetectionInstructions.push([j.CUSTOM,l,h,e,r||i,ar,s]);break;case"LineString":case"Circle":u=e.getFlatCoordinates(),c=this.appendFlatLineCoordinates(u,0,u.length,a,!1,!1),this.instructions.push([j.CUSTOM,l,c,e,i,Ut,s]),this.hitDetectionInstructions.push([j.CUSTOM,l,c,e,r||i,Ut,s]);break;case"MultiPoint":u=e.getFlatCoordinates(),c=this.appendFlatPointCoordinates(u,a),c>l&&(this.instructions.push([j.CUSTOM,l,c,e,i,Ut,s]),this.hitDetectionInstructions.push([j.CUSTOM,l,c,e,r||i,Ut,s]));break;case"Point":u=e.getFlatCoordinates(),this.coordinates.push(u[0],u[1]),c=this.coordinates.length,this.instructions.push([j.CUSTOM,l,c,e,i,void 0,s]),this.hitDetectionInstructions.push([j.CUSTOM,l,c,e,r||i,void 0,s]);break}this.endGeometry(t)}beginGeometry(e,t,i){this.beginGeometryInstruction1_=[j.BEGIN_GEOMETRY,t,0,e,i],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[j.BEGIN_GEOMETRY,t,0,e,i],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const e=this.hitDetectionInstructions;e.reverse();let t;const i=e.length;let r,s,o=-1;for(t=0;t<i;++t)r=e[t],s=r[0],s==j.END_GEOMETRY?o=t:s==j.BEGIN_GEOMETRY&&(r[2]=t,Sl(this.hitDetectionInstructions,o,t),o=-1)}setFillStrokeStyle(e,t){const i=this.state;if(e){const r=e.getColor();i.fillPatternScale=r&&typeof r=="object"&&"src"in r?this.pixelRatio:1,i.fillStyle=yt(r||Ne)}else i.fillStyle=void 0;if(t){const r=t.getColor();i.strokeStyle=yt(r||nn);const s=t.getLineCap();i.lineCap=s!==void 0?s:rn;const o=t.getLineDash();i.lineDash=o?o.slice():at;const a=t.getLineDashOffset();i.lineDashOffset=a||lt;const l=t.getLineJoin();i.lineJoin=l!==void 0?l:sn;const u=t.getWidth();i.lineWidth=u!==void 0?u:on;const c=t.getMiterLimit();i.miterLimit=c!==void 0?c:an,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(e){const t=e.fillStyle,i=[j.SET_FILL_STYLE,t];return typeof t!="string"&&i.push(e.fillPatternScale),i}applyStroke(e){this.instructions.push(this.createStroke(e))}createStroke(e){return[j.SET_STROKE_STYLE,e.strokeStyle,e.lineWidth*this.pixelRatio,e.lineCap,e.lineJoin,e.miterLimit,this.applyPixelRatio(e.lineDash),e.lineDashOffset*this.pixelRatio]}updateFillStyle(e,t){const i=e.fillStyle;(typeof i!="string"||e.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(t.call(this,e)),e.currentFillStyle=i)}updateStrokeStyle(e,t){const i=e.strokeStyle,r=e.lineCap,s=e.lineDash,o=e.lineDashOffset,a=e.lineJoin,l=e.lineWidth,u=e.miterLimit;(e.currentStrokeStyle!=i||e.currentLineCap!=r||s!=e.currentLineDash&&!Rn(e.currentLineDash,s)||e.currentLineDashOffset!=o||e.currentLineJoin!=a||e.currentLineWidth!=l||e.currentMiterLimit!=u)&&(i!==void 0&&t.call(this,e),e.currentStrokeStyle=i,e.currentLineCap=r,e.currentLineDash=s,e.currentLineDashOffset=o,e.currentLineJoin=a,e.currentLineWidth=l,e.currentMiterLimit=u)}endGeometry(e){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const t=[j.END_GEOMETRY,e];this.instructions.push(t),this.hitDetectionInstructions.push(t)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Tl(this.maxExtent),this.maxLineWidth>0)){const e=this.resolution*(this.maxLineWidth+1)/2;_t(this.bufferedMaxExtent_,e,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class ju extends ki{constructor(e,t,i,r){super(e,t,i,r),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(e,t,i){if(!this.image_||this.maxExtent&&!tn(this.maxExtent,e.getFlatCoordinates()))return;this.beginGeometry(e,t,i);const r=e.getFlatCoordinates(),s=e.getStride(),o=this.coordinates.length,a=this.appendFlatPointCoordinates(r,s);this.instructions.push([j.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([j.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}drawMultiPoint(e,t,i){if(!this.image_)return;this.beginGeometry(e,t,i);const r=e.getFlatCoordinates(),s=[];for(let l=0,u=r.length;l<u;l+=e.getStride())(!this.maxExtent||tn(this.maxExtent,r.slice(l,l+2)))&&s.push(r[l],r[l+1]);const o=this.coordinates.length,a=this.appendFlatPointCoordinates(s,2);this.instructions.push([j.DRAW_IMAGE,o,a,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([j.DRAW_IMAGE,o,a,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(t)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(e,t){const i=e.getAnchor(),r=e.getSize(),s=e.getOrigin();this.imagePixelRatio_=e.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=e.getHitDetectionImage(),this.image_=e.getImage(this.pixelRatio),this.height_=r[1],this.opacity_=e.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=e.getRotateWithView(),this.rotation_=e.getRotation(),this.scale_=e.getScaleArray(),this.width_=r[0],this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const Nu=ju;class Wu extends ki{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinates_(e,t,i,r){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(e,t,i,r,!1,!1),a=[j.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(e,t,i){const r=this.state,s=r.strokeStyle,o=r.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,at,lt],Gt);const a=e.getFlatCoordinates(),l=e.getStride();this.drawFlatCoordinates_(a,0,a.length,l),this.hitDetectionInstructions.push(xt),this.endGeometry(t)}drawMultiLineString(e,t,i){const r=this.state,s=r.strokeStyle,o=r.lineWidth;if(s===void 0||o===void 0)return;this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(e,t,i),this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,at,lt],Gt);const a=e.getEnds(),l=e.getFlatCoordinates(),u=e.getStride();let c=0;for(let h=0,d=a.length;h<d;++h)c=this.drawFlatCoordinates_(l,c,a[h],u);this.hitDetectionInstructions.push(xt),this.endGeometry(t)}finish(){const e=this.state;return e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&this.instructions.push(xt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(e){e.lastStroke!=null&&e.lastStroke!=this.coordinates.length&&(this.instructions.push(xt),e.lastStroke=this.coordinates.length),e.lastStroke=0,super.applyStroke(e),this.instructions.push(Gt)}}const Bu=Wu;class $u extends ki{constructor(e,t,i,r){super(e,t,i,r)}drawFlatCoordinatess_(e,t,i,r){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=i.length;this.instructions.push(Gt),this.hitDetectionInstructions.push(Gt);for(let u=0;u<l;++u){const c=i[u],h=this.coordinates.length,d=this.appendFlatLineCoordinates(e,t,c,r,!0,!a),f=[j.MOVE_TO_LINE_TO,h,d];this.instructions.push(f),this.hitDetectionInstructions.push(f),a&&(this.instructions.push(Ss),this.hitDetectionInstructions.push(Ss)),t=c}return o&&(this.instructions.push(ji),this.hitDetectionInstructions.push(ji)),a&&(this.instructions.push(xt),this.hitDetectionInstructions.push(xt)),t}drawCircle(e,t,i){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_FILL_STYLE,Ne]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,at,lt]);const a=e.getFlatCoordinates(),l=e.getStride(),u=this.coordinates.length;this.appendFlatLineCoordinates(a,0,a.length,l,!1,!1);const c=[j.CIRCLE,u];this.instructions.push(Gt,c),this.hitDetectionInstructions.push(Gt,c),r.fillStyle!==void 0&&(this.instructions.push(ji),this.hitDetectionInstructions.push(ji)),r.strokeStyle!==void 0&&(this.instructions.push(xt),this.hitDetectionInstructions.push(xt)),this.endGeometry(t)}drawPolygon(e,t,i){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_FILL_STYLE,Ne]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,at,lt]);const a=e.getEnds(),l=e.getOrientedFlatCoordinates(),u=e.getStride();this.drawFlatCoordinatess_(l,0,a,u),this.endGeometry(t)}drawMultiPolygon(e,t,i){const r=this.state,s=r.fillStyle,o=r.strokeStyle;if(s===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(e,t,i),r.fillStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_FILL_STYLE,Ne]),r.strokeStyle!==void 0&&this.hitDetectionInstructions.push([j.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,at,lt]);const a=e.getEndss(),l=e.getOrientedFlatCoordinates(),u=e.getStride();let c=0;for(let h=0,d=a.length;h<d;++h)c=this.drawFlatCoordinatess_(l,c,a[h],u);this.endGeometry(t)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const e=this.tolerance;if(e!==0){const t=this.coordinates;for(let i=0,r=t.length;i<r;++i)t[i]=El(t[i],e)}return super.finish()}setFillStrokeStyles_(){const e=this.state;e.fillStyle!==void 0&&this.updateFillStyle(e,this.createFill),e.strokeStyle!==void 0&&this.updateStrokeStyle(e,this.applyStroke)}}const Ts=$u;function qu(n,e,t,i,r){const s=[];let o=t,a=0,l=e.slice(t,2);for(;a<n&&o+r<i;){const[u,c]=l.slice(-2),h=e[o+r],d=e[o+r+1],f=Math.sqrt((h-u)*(h-u)+(d-c)*(d-c));if(a+=f,a>=n){const p=(n-a+f)/f,m=je(u,h,p),g=je(c,d,p);l.push(m,g),s.push(l),l=[m,g],a==n&&(o+=r),a=0}else if(a<n)l.push(e[o+r],e[o+r+1]),o+=r;else{const p=f-a,m=je(u,h,p/f),g=je(c,d,p/f);l.push(m,g),s.push(l),l=[m,g],a=0,o+=r}}return a>0&&s.push(l),s}function Vu(n,e,t,i,r){let s=t,o=t,a=0,l=0,u=t,c,h,d,f,p,m,g,y,x,_;for(h=t;h<i;h+=r){const v=e[h],b=e[h+1];p!==void 0&&(x=v-p,_=b-m,f=Math.sqrt(x*x+_*_),g!==void 0&&(l+=d,c=Math.acos((g*x+y*_)/(d*f)),c>n&&(l>a&&(a=l,s=u,o=h),l=0,u=h-r)),d=f,g=x,y=_),p=v,m=b}return l+=f,l>a?[u,h]:[s,o]}const pn={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Xu extends ki{constructor(e,t,i,r){super(e,t,i,r),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[Ne]={fillStyle:Ne},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){const e=super.finish();return e.textStates=this.textStates,e.fillStates=this.fillStates,e.strokeStates=this.strokeStates,e}drawText(e,t,i){const r=this.textFillState_,s=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!r&&!s)return;const a=this.coordinates;let l=a.length;const u=e.getType();let c=null,h=e.getStride();if(o.placement==="line"&&(u=="LineString"||u=="MultiLineString"||u=="Polygon"||u=="MultiPolygon")){if(!be(this.maxExtent,e.getExtent()))return;let d;if(c=e.getFlatCoordinates(),u=="LineString")d=[c.length];else if(u=="MultiLineString")d=e.getEnds();else if(u=="Polygon")d=e.getEnds().slice(0,1);else if(u=="MultiPolygon"){const g=e.getEndss();d=[];for(let y=0,x=g.length;y<x;++y)d.push(g[y][0])}this.beginGeometry(e,t,i);const f=o.repeat,p=f?void 0:o.textAlign;let m=0;for(let g=0,y=d.length;g<y;++g){let x;f?x=qu(f*this.resolution,c,m,d[g],h):x=[c.slice(m,d[g])];for(let _=0,v=x.length;_<v;++_){const b=x[_];let E=0,T=b.length;if(p==null){const L=Vu(o.maxAngle,b,0,b.length,2);E=L[0],T=L[1]}for(let L=E;L<T;L+=h)a.push(b[L],b[L+1]);const I=a.length;m=d[g],this.drawChars_(l,I),l=I}}this.endGeometry(t)}else{let d=o.overflow?null:[];switch(u){case"Point":case"MultiPoint":c=e.getFlatCoordinates();break;case"LineString":c=e.getFlatMidpoint();break;case"Circle":c=e.getCenter();break;case"MultiLineString":c=e.getFlatMidpoints(),h=2;break;case"Polygon":c=e.getFlatInteriorPoint(),o.overflow||d.push(c[2]/this.resolution),h=3;break;case"MultiPolygon":const x=e.getFlatInteriorPoints();c=[];for(let _=0,v=x.length;_<v;_+=3)o.overflow||d.push(x[_+2]/this.resolution),c.push(x[_],x[_+1]);if(c.length===0)return;h=2;break}const f=this.appendFlatPointCoordinates(c,h);if(f===l)return;if(d&&(f-l)/2!==c.length/h){let x=l/2;d=d.filter((_,v)=>{const b=a[(x+v)*2]===c[v*h]&&a[(x+v)*2+1]===c[v*h+1];return b||--x,b})}this.saveTextStates_(),(o.backgroundFill||o.backgroundStroke)&&(this.setFillStrokeStyle(o.backgroundFill,o.backgroundStroke),o.backgroundFill&&this.updateFillStyle(this.state,this.createFill),o.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(e,t,i);let p=o.padding;if(p!=zt&&(o.scale[0]<0||o.scale[1]<0)){let x=o.padding[0],_=o.padding[1],v=o.padding[2],b=o.padding[3];o.scale[0]<0&&(_=-_,b=-b),o.scale[1]<0&&(x=-x,v=-v),p=[x,_,v,b]}const m=this.pixelRatio;this.instructions.push([j.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,p==zt?zt:p.map(function(x){return x*m}),!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]);const g=1/m,y=this.state.fillStyle;o.backgroundFill&&(this.state.fillStyle=Ne,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([j.DRAW_IMAGE,l,f,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[g,g],NaN,this.declutterMode_,this.declutterImageWithText_,p,!!o.backgroundFill,!!o.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?Ne:this.fillKey_,this.textOffsetX_,this.textOffsetY_,d]),o.backgroundFill&&(this.state.fillStyle=y,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(t)}}saveTextStates_(){const e=this.textStrokeState_,t=this.textState_,i=this.textFillState_,r=this.strokeKey_;e&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:e.strokeStyle,lineCap:e.lineCap,lineDashOffset:e.lineDashOffset,lineWidth:e.lineWidth,lineJoin:e.lineJoin,miterLimit:e.miterLimit,lineDash:e.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:t.font,textAlign:t.textAlign||bi,justify:t.justify,textBaseline:t.textBaseline||ln,scale:t.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(e,t){const i=this.textStrokeState_,r=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,u=pn[r.textBaseline],c=this.textOffsetY_*l,h=this.text_,d=i?i.lineWidth*Math.abs(r.scale[0])/2:0;this.instructions.push([j.DRAW_CHARS,e,t,u,r.overflow,a,r.maxAngle,l,c,s,d*l,h,o,1,this.declutterMode_]),this.hitDetectionInstructions.push([j.DRAW_CHARS,e,t,u,r.overflow,a&&Ne,r.maxAngle,l,c,s,d*l,h,o,1/l,this.declutterMode_])}setTextStyle(e,t){let i,r,s;if(!e)this.text_="";else{const o=e.getFill();o?(r=this.textFillState_,r||(r={},this.textFillState_=r),r.fillStyle=yt(o.getColor()||Ne)):(r=null,this.textFillState_=r);const a=e.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const p=a.getLineDash(),m=a.getLineDashOffset(),g=a.getWidth(),y=a.getMiterLimit();s.lineCap=a.getLineCap()||rn,s.lineDash=p?p.slice():at,s.lineDashOffset=m===void 0?lt:m,s.lineJoin=a.getLineJoin()||sn,s.lineWidth=g===void 0?on:g,s.miterLimit=y===void 0?an:y,s.strokeStyle=yt(a.getColor()||nn)}i=this.textState_;const l=e.getFont()||yo;xo(l);const u=e.getScaleArray();i.overflow=e.getOverflow(),i.font=l,i.maxAngle=e.getMaxAngle(),i.placement=e.getPlacement(),i.textAlign=e.getTextAlign(),i.repeat=e.getRepeat(),i.justify=e.getJustify(),i.textBaseline=e.getTextBaseline()||ln,i.backgroundFill=e.getBackgroundFill(),i.backgroundStroke=e.getBackgroundStroke(),i.padding=e.getPadding()||zt,i.scale=u===void 0?[1,1]:u;const c=e.getOffsetX(),h=e.getOffsetY(),d=e.getRotateWithView(),f=e.getRotation();this.text_=e.getText()||"",this.textOffsetX_=c===void 0?0:c,this.textOffsetY_=h===void 0?0:h,this.textRotateWithView_=d===void 0?!1:d,this.textRotation_=f===void 0?0:f,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Y(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.repeat||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=r&&r.fillStyle?typeof r.fillStyle=="string"?r.fillStyle:"|"+Y(r.fillStyle):""}this.declutterMode_=e.getDeclutterMode(),this.declutterImageWithText_=t}}const Uu={Circle:Ts,Default:ki,Image:Nu,LineString:Bu,Polygon:Ts,Text:Xu};class No{constructor(e,t,i,r){this.tolerance_=e,this.maxExtent_=t,this.pixelRatio_=r,this.resolution_=i,this.buildersByZIndex_={}}finish(){const e={};for(const t in this.buildersByZIndex_){e[t]=e[t]||{};const i=this.buildersByZIndex_[t];for(const r in i){const s=i[r].finish();e[t][r]=s}}return e}getBuilder(e,t){const i=e!==void 0?e.toString():"0";let r=this.buildersByZIndex_[i];r===void 0&&(r={},this.buildersByZIndex_[i]=r);let s=r[t];if(s===void 0){const o=Uu[t];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),r[t]=s}return s}}function Yu(n,e,t,i,r,s,o,a,l,u,c,h){let d=n[e],f=n[e+1],p=0,m=0,g=0,y=0;function x(){p=d,m=f,e+=i,d=n[e],f=n[e+1],y+=g,g=Math.sqrt((d-p)*(d-p)+(f-m)*(f-m))}do x();while(e<t-i&&y+g<s);let _=g===0?0:(s-y)/g;const v=je(p,d,_),b=je(m,f,_),E=e-i,T=y,I=s+a*l(u,r,c);for(;e<t-i&&y+g<I;)x();_=g===0?0:(I-y)/g;const L=je(p,d,_),D=je(m,f,_);let F;if(h){const k=[v,b,L,D];Il(k,0,4,2,h,k,k),F=k[0]>k[2]}else F=v>L;const C=Math.PI,O=[],R=E+i===e;e=E,g=0,y=T,d=n[e],f=n[e+1];let w;if(R){x(),w=Math.atan2(f-m,d-p),F&&(w+=w>0?-C:C);const k=(L+v)/2,G=(D+b)/2;return O[0]=[k,G,(I-s)/2,w,r],O}r=r.replace(/\n/g," ");for(let k=0,G=r.length;k<G;){x();let N=Math.atan2(f-m,d-p);if(F&&(N+=N>0?-C:C),w!==void 0){let P=N-w;if(P+=P>C?-2*C:P<-C?2*C:0,Math.abs(P)>o)return null}w=N;const ee=k;let S=0;for(;k<G;++k){const P=F?G-k-1:k,de=a*l(u,r[P],c);if(e+i<t&&y+g<s+S+de/2)break;S+=de}if(k===ee)continue;const H=F?r.substring(G-ee,G-k):r.substring(ee,k);_=g===0?0:(s+S/2-y)/g;const te=je(p,d,_),le=je(m,f,_);O.push([te,le,S/2,N,H]),s+=S}return O}const Bt=_i(),ht=[],tt=[],it=[],dt=[];function Es(n){return n[3].declutterBox}const Is=new RegExp("[-----]");function Wn(n,e){return e==="start"?e=Is.test(n)?"right":"left":e==="end"&&(e=Is.test(n)?"left":"right"),pn[e]}function Hu(n,e,t){return t>0&&n.push(`
`,""),n.push(e,""),n}class Zu{constructor(e,t,i,r,s){this.overlaps=i,this.pixelRatio=t,this.resolution=e,this.alignAndScaleFill_,this.instructions=r.instructions,this.coordinates=r.coordinates,this.coordinateCache_={},this.renderedTransform_=Ct(),this.hitDetectionInstructions=r.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=r.fillStates||{},this.strokeStates=r.strokeStates||{},this.textStates=r.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=s?new _o:null}getZIndexContext(){return this.zIndexContext_}createLabel(e,t,i,r){const s=e+t+i+r;if(this.labels_[s])return this.labels_[s];const o=r?this.strokeStates[r]:null,a=i?this.fillStates[i]:null,l=this.textStates[t],u=this.pixelRatio,c=[l.scale[0]*u,l.scale[1]*u],h=Array.isArray(e),d=l.justify?pn[l.justify]:Wn(Array.isArray(e)?e[0]:e,l.textAlign||bi),f=r&&o.lineWidth?o.lineWidth:0,p=h?e:e.split(`
`).reduce(Hu,[]),{width:m,height:g,widths:y,heights:x,lineWidths:_}=Rl(l,p),v=m+f,b=[],E=(v+2)*c[0],T=(g+f)*c[1],I={width:E<0?Math.floor(E):Math.ceil(E),height:T<0?Math.floor(T):Math.ceil(T),contextInstructions:b};(c[0]!=1||c[1]!=1)&&b.push("scale",c),r&&(b.push("strokeStyle",o.strokeStyle),b.push("lineWidth",f),b.push("lineCap",o.lineCap),b.push("lineJoin",o.lineJoin),b.push("miterLimit",o.miterLimit),b.push("setLineDash",[o.lineDash]),b.push("lineDashOffset",o.lineDashOffset)),i&&b.push("fillStyle",a.fillStyle),b.push("textBaseline","middle"),b.push("textAlign","center");const L=.5-d;let D=d*v+L*f;const F=[],C=[];let O=0,R=0,w=0,k=0,G;for(let N=0,ee=p.length;N<ee;N+=2){const S=p[N];if(S===`
`){R+=O,O=0,D=d*v+L*f,++k;continue}const H=p[N+1]||l.font;H!==G&&(r&&F.push("font",H),i&&C.push("font",H),G=H),O=Math.max(O,x[w]);const te=[S,D+L*y[w]+d*(y[w]-_[k]),.5*(f+O)+R];D+=y[w],r&&F.push("strokeText",te),i&&C.push("fillText",te),++w}return Array.prototype.push.apply(b,F),Array.prototype.push.apply(b,C),this.labels_[s]=I,I}replayTextBackground_(e,t,i,r,s,o,a){e.beginPath(),e.moveTo.apply(e,t),e.lineTo.apply(e,i),e.lineTo.apply(e,r),e.lineTo.apply(e,s),e.lineTo.apply(e,t),o&&(this.alignAndScaleFill_=o[2],this.fill_(e)),a&&(this.setStrokeStyle_(e,a),e.stroke())}calculateImageOrLabelDimensions_(e,t,i,r,s,o,a,l,u,c,h,d,f,p,m,g){a*=d[0],l*=d[1];let y=i-a,x=r-l;const _=s+u>e?e-u:s,v=o+c>t?t-c:o,b=p[3]+_*d[0]+p[1],E=p[0]+v*d[1]+p[2],T=y-p[3],I=x-p[0];(m||h!==0)&&(ht[0]=T,dt[0]=T,ht[1]=I,tt[1]=I,tt[0]=T+b,it[0]=tt[0],it[1]=I+E,dt[1]=it[1]);let L;return h!==0?(L=ti(Ct(),i,r,1,1,h,-i,-r),gt(L,ht),gt(L,tt),gt(L,it),gt(L,dt),cr(Math.min(ht[0],tt[0],it[0],dt[0]),Math.min(ht[1],tt[1],it[1],dt[1]),Math.max(ht[0],tt[0],it[0],dt[0]),Math.max(ht[1],tt[1],it[1],dt[1]),Bt)):cr(Math.min(T,T+b),Math.min(I,I+E),Math.max(T,T+b),Math.max(I,I+E),Bt),f&&(y=Math.round(y),x=Math.round(x)),{drawImageX:y,drawImageY:x,drawImageW:_,drawImageH:v,originX:u,originY:c,declutterBox:{minX:Bt[0],minY:Bt[1],maxX:Bt[2],maxY:Bt[3],value:g},canvasTransform:L,scale:d}}replayImageOrLabel_(e,t,i,r,s,o,a){const l=!!(o||a),u=r.declutterBox,c=a?a[2]*r.scale[0]/2:0;return u.minX-c<=t[0]&&u.maxX+c>=0&&u.minY-c<=t[1]&&u.maxY+c>=0&&(l&&this.replayTextBackground_(e,ht,tt,it,dt,o,a),Fl(e,r.canvasTransform,s,i,r.originX,r.originY,r.drawImageW,r.drawImageH,r.drawImageX,r.drawImageY,r.scale)),!0}fill_(e){const t=this.alignAndScaleFill_;if(t){const i=gt(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;e.save(),e.translate(i[0]%r,i[1]%r),t!==1&&e.scale(t,t),e.rotate(this.viewRotation_)}e.fill(),t&&e.restore()}setStrokeStyle_(e,t){e.strokeStyle=t[1],e.lineWidth=t[2],e.lineCap=t[3],e.lineJoin=t[4],e.miterLimit=t[5],e.lineDashOffset=t[7],e.setLineDash(t[6])}drawLabelWithPointPlacement_(e,t,i,r){const s=this.textStates[t],o=this.createLabel(e,t,r,i),a=this.strokeStates[i],l=this.pixelRatio,u=Wn(Array.isArray(e)?e[0]:e,s.textAlign||bi),c=pn[s.textBaseline||ln],h=a&&a.lineWidth?a.lineWidth:0,d=o.width/l-2*s.scale[0],f=u*d+2*(.5-u)*h,p=c*o.height/l+2*(.5-c)*h;return{label:o,anchorX:f,anchorY:p}}execute_(e,t,i,r,s,o,a,l){const u=this.zIndexContext_;let c;this.pixelCoordinates_&&Rn(i,this.renderedTransform_)?c=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),c=Zt(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),kl(this.renderedTransform_,i));let h=0;const d=r.length;let f=0,p,m,g,y,x,_,v,b,E,T,I,L,D,F=0,C=0,O=null,R=null;const w=this.coordinateCache_,k=this.viewRotation_,G=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,N={context:e,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:k},ee=this.instructions!=r||this.overlaps?0:200;let S,H,te,le;for(;h<d;){const P=r[h];switch(P[0]){case j.BEGIN_GEOMETRY:S=P[1],le=P[3],S.getGeometry()?a!==void 0&&!be(a,le.getExtent())?h=P[2]+1:++h:h=P[2],u&&(u.zIndex=P[4]);break;case j.BEGIN_PATH:F>ee&&(this.fill_(e),F=0),C>ee&&(e.stroke(),C=0),!F&&!C&&(e.beginPath(),x=NaN,_=NaN),++h;break;case j.CIRCLE:f=P[1];const we=c[f],Le=c[f+1],fe=c[f+2],ke=c[f+3],A=fe-we,Ze=ke-Le,It=Math.sqrt(A*A+Ze*Ze);e.moveTo(we+It,Le),e.arc(we,Le,It,0,2*Math.PI,!0),++h;break;case j.CLOSE_PATH:e.closePath(),++h;break;case j.CUSTOM:f=P[1],p=P[2];const X=P[3],Li=P[4],ct=P[5];N.geometry=X,N.feature=S,h in w||(w[h]=[]);const ce=w[h];ct?ct(c,f,p,2,ce):(ce[0]=c[f],ce[1]=c[f+1],ce.length=2),u&&(u.zIndex=P[6]),Li(ce,N),++h;break;case j.DRAW_IMAGE:f=P[1],p=P[2],E=P[3],m=P[4],g=P[5];let Rt=P[6];const pe=P[7],Ft=P[8],kt=P[9],$e=P[10];let Je=P[11];const ui=P[12];let K=P[13];y=P[14]||"declutter";const Z=P[15];if(!E&&P.length>=20){T=P[19],I=P[20],L=P[21],D=P[22];const Oe=this.drawLabelWithPointPlacement_(T,I,L,D);E=Oe.label,P[3]=E;const Pt=P[23];m=(Oe.anchorX-Pt)*this.pixelRatio,P[4]=m;const ze=P[24];g=(Oe.anchorY-ze)*this.pixelRatio,P[5]=g,Rt=E.height,P[6]=Rt,K=E.width,P[13]=K}let J;P.length>25&&(J=P[25]);let ie,q,V;P.length>17?(ie=P[16],q=P[17],V=P[18]):(ie=zt,q=!1,V=!1),$e&&G?Je+=k:!$e&&!G&&(Je-=k);let ae=0;for(;f<p;f+=2){if(J&&J[ae++]<K/this.pixelRatio)continue;const Oe=this.calculateImageOrLabelDimensions_(E.width,E.height,c[f],c[f+1],K,Rt,m,g,Ft,kt,Je,ui,s,ie,q||V,S),Pt=[e,t,E,Oe,pe,q?O:null,V?R:null];if(l){let ze,Xe,Ge;if(Z){const ue=p-f;if(!Z[ue]){Z[ue]={args:Pt,declutterMode:y};continue}const Re=Z[ue];ze=Re.args,Xe=Re.declutterMode,delete Z[ue],Ge=Es(ze)}let Ke,Qe;if(ze&&(Xe!=="declutter"||!l.collides(Ge))&&(Ke=!0),(y!=="declutter"||!l.collides(Oe.declutterBox))&&(Qe=!0),Xe==="declutter"&&y==="declutter"){const ue=Ke&&Qe;Ke=ue,Qe=ue}Ke&&(Xe!=="none"&&l.insert(Ge),this.replayImageOrLabel_.apply(this,ze)),Qe&&(y!=="none"&&l.insert(Oe.declutterBox),this.replayImageOrLabel_.apply(this,Pt))}else this.replayImageOrLabel_.apply(this,Pt)}++h;break;case j.DRAW_CHARS:const se=P[1],Te=P[2],ye=P[3],xe=P[4];D=P[5];const Ce=P[6],ne=P[7],Ee=P[8];L=P[9];const Se=P[10];T=P[11],I=P[12];const Ie=[P[13],P[13]];y=P[14]||"declutter";const he=this.textStates[I],qe=he.font,Mt=[he.scale[0]*ne,he.scale[1]*ne];let Lt;qe in this.widths_?Lt=this.widths_[qe]:(Lt={},this.widths_[qe]=Lt);const Pi=Do(c,se,Te,2),gs=Math.abs(Mt[0])*ms(qe,T,Lt);if(xe||gs<=Pi){const Oe=this.textStates[I].textAlign,Pt=(Pi-gs)*Wn(T,Oe),ze=Yu(c,se,Te,2,T,Pt,Ce,Math.abs(Mt[0]),ms,qe,Lt,G?0:this.viewRotation_);e:if(ze){const Xe=[];let Ge,Ke,Qe,ue,Re;if(L)for(Ge=0,Ke=ze.length;Ge<Ke;++Ge){Re=ze[Ge],Qe=Re[4],ue=this.createLabel(Qe,I,"",L),m=Re[2]+(Mt[0]<0?-Se:Se),g=ye*ue.height+(.5-ye)*2*Se*Mt[1]/Mt[0]-Ee;const et=this.calculateImageOrLabelDimensions_(ue.width,ue.height,Re[0],Re[1],ue.width,ue.height,m,g,0,0,Re[3],Ie,!1,zt,!1,S);if(l&&y==="declutter"&&l.collides(et.declutterBox))break e;Xe.push([e,t,ue,et,1,null,null])}if(D)for(Ge=0,Ke=ze.length;Ge<Ke;++Ge){Re=ze[Ge],Qe=Re[4],ue=this.createLabel(Qe,I,D,""),m=Re[2],g=ye*ue.height-Ee;const et=this.calculateImageOrLabelDimensions_(ue.width,ue.height,Re[0],Re[1],ue.width,ue.height,m,g,0,0,Re[3],Ie,!1,zt,!1,S);if(l&&y==="declutter"&&l.collides(et.declutterBox))break e;Xe.push([e,t,ue,et,1,null,null])}l&&y!=="none"&&l.load(Xe.map(Es));for(let et=0,Ya=Xe.length;et<Ya;++et)this.replayImageOrLabel_.apply(this,Xe[et])}}++h;break;case j.END_GEOMETRY:if(o!==void 0){S=P[1];const Oe=o(S,le);if(Oe)return Oe}++h;break;case j.FILL:ee?F++:this.fill_(e),++h;break;case j.MOVE_TO_LINE_TO:for(f=P[1],p=P[2],H=c[f],te=c[f+1],v=H+.5|0,b=te+.5|0,(v!==x||b!==_)&&(e.moveTo(H,te),x=v,_=b),f+=2;f<p;f+=2)H=c[f],te=c[f+1],v=H+.5|0,b=te+.5|0,(f==p-2||v!==x||b!==_)&&(e.lineTo(H,te),x=v,_=b);++h;break;case j.SET_FILL_STYLE:O=P,this.alignAndScaleFill_=P[2],F&&(this.fill_(e),F=0,C&&(e.stroke(),C=0)),e.fillStyle=P[1],++h;break;case j.SET_STROKE_STYLE:R=P,C&&(e.stroke(),C=0),this.setStrokeStyle_(e,P),++h;break;case j.STROKE:ee?C++:e.stroke(),++h;break;default:++h;break}}F&&this.fill_(e),C&&e.stroke()}execute(e,t,i,r,s,o){this.viewRotation_=r,this.execute_(e,t,i,this.instructions,s,void 0,void 0,o)}executeHitDetection(e,t,i,r,s){return this.viewRotation_=i,this.execute_(e,[e.canvas.width,e.canvas.height],t,this.hitDetectionInstructions,!0,r,s)}}const di=["Polygon","Circle","LineString","Image","Text","Default"],gn=["Image","Text"],Ju=di.filter(n=>!gn.includes(n));class Wo{constructor(e,t,i,r,s,o,a){this.maxExtent_=e,this.overlaps_=r,this.pixelRatio_=i,this.resolution_=t,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ct(),this.renderedContext_=null,this.deferredZIndexContexts_=[],this.createExecutors_(s,a)}clip(e,t){const i=this.getClipCoords(t);e.beginPath(),e.moveTo(i[0],i[1]),e.lineTo(i[2],i[3]),e.lineTo(i[4],i[5]),e.lineTo(i[6],i[7]),e.clip()}createExecutors_(e,t){for(const i in e){let r=this.executorsByZIndex_[i];r===void 0&&(r={},this.executorsByZIndex_[i]=r);const s=e[i];for(const o in s){const a=s[o];r[o]=new Zu(this.resolution_,this.pixelRatio_,this.overlaps_,a,t)}}}hasExecutors(e){for(const t in this.executorsByZIndex_){const i=this.executorsByZIndex_[t];for(let r=0,s=e.length;r<s;++r)if(e[r]in i)return!0}return!1}forEachFeatureAtCoordinate(e,t,i,r,s,o){r=Math.round(r);const a=r*2+1,l=ti(this.hitDetectionTransform_,r+.5,r+.5,1/t,-1/t,-i,-e[0],-e[1]),u=!this.hitDetectionContext_;u&&(this.hitDetectionContext_=St(a,a,void 0,{willReadFrequently:!0}));const c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):u||c.clearRect(0,0,a,a);let h;this.renderBuffer_!==void 0&&(h=_i(),Ml(h,e),_t(h,t*(this.renderBuffer_+r),h));const d=Ku(r);let f;function p(b,E){const T=c.getImageData(0,0,a,a).data;for(let I=0,L=d.length;I<L;I++)if(T[d[I]]>0){if(!o||f!=="Image"&&f!=="Text"||o.includes(b)){const D=(d[I]-3)/4,F=r-D%a,C=r-(D/a|0),O=s(b,E,F*F+C*C);if(O)return O}c.clearRect(0,0,a,a);break}}const m=Object.keys(this.executorsByZIndex_).map(Number);m.sort(un);let g,y,x,_,v;for(g=m.length-1;g>=0;--g){const b=m[g].toString();for(x=this.executorsByZIndex_[b],y=di.length-1;y>=0;--y)if(f=di[y],_=x[f],_!==void 0&&(v=_.executeHitDetection(c,l,i,p,h),v))return v}}getClipCoords(e){const t=this.maxExtent_;if(!t)return null;const i=t[0],r=t[1],s=t[2],o=t[3],a=[i,r,i,o,s,o,s,r];return Zt(a,0,8,2,e,a),a}isEmpty(){return ii(this.executorsByZIndex_)}execute(e,t,i,r,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(un),o=o||di;let u,c,h,d,f,p;for(a&&l.reverse(),u=0,c=l.length;u<c;++u){const m=l[u].toString();for(f=this.executorsByZIndex_[m],h=0,d=o.length;h<d;++h){const g=o[h];if(p=f[g],p!==void 0){const y=a===null?void 0:p.getZIndexContext(),x=y?y.getContext():e,_=this.maxExtent_&&g!=="Image"&&g!=="Text";if(_&&(x.save(),this.clip(x,i)),p.execute(x,t,i,r,s,a),_&&x.restore(),y){y.offset();const v=l[u];this.deferredZIndexContexts_[v]||(this.deferredZIndexContexts_[v]=[]),this.deferredZIndexContexts_[v].push(y)}}}}this.renderedContext_=e}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){this.deferredZIndexContexts_.forEach(e=>{e.forEach(t=>{t.draw(this.renderedContext_),t.clear()})})}}const Bn={};function Ku(n){if(Bn[n]!==void 0)return Bn[n];const e=n*2+1,t=n*n,i=new Array(t+1);for(let s=0;s<=n;++s)for(let o=0;o<=n;++o){const a=s*s+o*o;if(a>t)break;let l=i[a];l||(l=[],i[a]=l),l.push(((n+s)*e+(n+o))*4+3),s>0&&l.push(((n-s)*e+(n+o))*4+3),o>0&&(l.push(((n+s)*e+(n-o))*4+3),s>0&&l.push(((n-s)*e+(n-o))*4+3))}const r=[];for(let s=0,o=i.length;s<o;++s)i[s]&&r.push(...i[s]);return Bn[n]=r,r}class Qu extends jo{constructor(e,t,i,r,s,o,a){super(),this.context_=e,this.pixelRatio_=t,this.extent_=i,this.transform_=r,this.transformRotation_=r?Ll(Math.atan2(r[1],r[0]),10):0,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Ct()}drawImages_(e,t,i,r){if(!this.image_)return;const s=Zt(e,t,i,r,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let u=this.imageRotation_;this.transformRotation_===0&&(u-=this.viewRotation_),this.imageRotateWithView_&&(u+=this.viewRotation_);for(let c=0,h=s.length;c<h;c+=2){const d=s[c]-this.imageAnchorX_,f=s[c+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const p=d+this.imageAnchorX_,m=f+this.imageAnchorY_;ti(a,p,m,1,1,u,-p,-m),o.save(),o.transform.apply(o,a),o.translate(p,m),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.restore()}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,d,f,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(e,t,i,r){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=Zt(e,t,i,r,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.transformRotation_===0&&(a-=this.viewRotation_),this.textRotateWithView_&&(a+=this.viewRotation_);t<i;t+=r){const l=s[t]+this.textOffsetX_,u=s[t+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.save(),o.translate(l-this.textOffsetX_,u-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.restore()):(this.textStrokeState_&&o.strokeText(this.text_,l,u),this.textFillState_&&o.fillText(this.text_,l,u))}}moveToLineTo_(e,t,i,r,s){const o=this.context_,a=Zt(e,t,i,r,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let u=2;u<l;u+=2)o.lineTo(a[u],a[u+1]);return s&&o.closePath(),i}drawRings_(e,t,i,r){for(let s=0,o=i.length;s<o;++s)t=this.moveToLineTo_(e,t,i[s],r,!0);return t}drawCircle(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!be(this.extent_,e.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=Pl(e,this.transform_,this.pixelCoordinates_),i=t[2]-t[0],r=t[3]-t[1],s=Math.sqrt(i*i+r*r),o=this.context_;o.beginPath(),o.arc(t[0],t[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(e.getCenter(),0,2,2)}}setStyle(e){this.setFillStrokeStyle(e.getFill(),e.getStroke()),this.setImageStyle(e.getImage()),this.setTextStyle(e.getText())}setTransform(e){this.transform_=e}drawGeometry(e){switch(e.getType()){case"Point":this.drawPoint(e);break;case"LineString":this.drawLineString(e);break;case"Polygon":this.drawPolygon(e);break;case"MultiPoint":this.drawMultiPoint(e);break;case"MultiLineString":this.drawMultiLineString(e);break;case"MultiPolygon":this.drawMultiPolygon(e);break;case"GeometryCollection":this.drawGeometryCollection(e);break;case"Circle":this.drawCircle(e);break}}drawFeature(e,t){const i=t.getGeometryFunction()(e);i&&(this.setStyle(t),this.drawGeometry(i))}drawGeometryCollection(e){const t=e.getGeometriesArray();for(let i=0,r=t.length;i<r;++i)this.drawGeometry(t[i])}drawPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawMultiPoint(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getFlatCoordinates(),i=e.getStride();this.image_&&this.drawImages_(t,0,t.length,i),this.text_!==""&&this.drawText_(t,0,t.length,i)}drawLineString(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!be(this.extent_,e.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getFlatCoordinates();t.beginPath(),this.moveToLineTo_(i,0,i.length,e.getStride(),!1),t.stroke()}if(this.text_!==""){const t=e.getFlatMidpoint();this.drawText_(t,0,2,2)}}}drawMultiLineString(e){this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const t=e.getExtent();if(be(this.extent_,t)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,r=e.getFlatCoordinates();let s=0;const o=e.getEnds(),a=e.getStride();i.beginPath();for(let l=0,u=o.length;l<u;++l)s=this.moveToLineTo_(r,s,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=e.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!be(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_;t.beginPath(),this.drawRings_(e.getOrientedFlatCoordinates(),0,e.getEnds(),e.getStride()),this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoint();this.drawText_(t,0,2,2)}}}drawMultiPolygon(e){if(this.squaredTolerance_&&(e=e.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!be(this.extent_,e.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const t=this.context_,i=e.getOrientedFlatCoordinates();let r=0;const s=e.getEndss(),o=e.getStride();t.beginPath();for(let a=0,l=s.length;a<l;++a){const u=s[a];r=this.drawRings_(i,r,u,o)}this.fillState_&&t.fill(),this.strokeState_&&t.stroke()}if(this.text_!==""){const t=e.getFlatInteriorPoints();this.drawText_(t,0,t.length,2)}}}setContextFillState_(e){const t=this.context_,i=this.contextFillState_;i?i.fillStyle!=e.fillStyle&&(i.fillStyle=e.fillStyle,t.fillStyle=e.fillStyle):(t.fillStyle=e.fillStyle,this.contextFillState_={fillStyle:e.fillStyle})}setContextStrokeState_(e){const t=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=e.lineCap&&(i.lineCap=e.lineCap,t.lineCap=e.lineCap),Rn(i.lineDash,e.lineDash)||t.setLineDash(i.lineDash=e.lineDash),i.lineDashOffset!=e.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset,t.lineDashOffset=e.lineDashOffset),i.lineJoin!=e.lineJoin&&(i.lineJoin=e.lineJoin,t.lineJoin=e.lineJoin),i.lineWidth!=e.lineWidth&&(i.lineWidth=e.lineWidth,t.lineWidth=e.lineWidth),i.miterLimit!=e.miterLimit&&(i.miterLimit=e.miterLimit,t.miterLimit=e.miterLimit),i.strokeStyle!=e.strokeStyle&&(i.strokeStyle=e.strokeStyle,t.strokeStyle=e.strokeStyle)):(t.lineCap=e.lineCap,t.setLineDash(e.lineDash),t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.miterLimit=e.miterLimit,t.strokeStyle=e.strokeStyle,this.contextStrokeState_={lineCap:e.lineCap,lineDash:e.lineDash,lineDashOffset:e.lineDashOffset,lineJoin:e.lineJoin,lineWidth:e.lineWidth,miterLimit:e.miterLimit,strokeStyle:e.strokeStyle})}setContextTextState_(e){const t=this.context_,i=this.contextTextState_,r=e.textAlign?e.textAlign:bi;i?(i.font!=e.font&&(i.font=e.font,t.font=e.font),i.textAlign!=r&&(i.textAlign=r,t.textAlign=r),i.textBaseline!=e.textBaseline&&(i.textBaseline=e.textBaseline,t.textBaseline=e.textBaseline)):(t.font=e.font,t.textAlign=r,t.textBaseline=e.textBaseline,this.contextTextState_={font:e.font,textAlign:r,textBaseline:e.textBaseline})}setFillStrokeStyle(e,t){if(!e)this.fillState_=null;else{const i=e.getColor();this.fillState_={fillStyle:yt(i||Ne)}}if(!t)this.strokeState_=null;else{const i=t.getColor(),r=t.getLineCap(),s=t.getLineDash(),o=t.getLineDashOffset(),a=t.getLineJoin(),l=t.getWidth(),u=t.getMiterLimit(),c=s||at;this.strokeState_={lineCap:r!==void 0?r:rn,lineDash:this.pixelRatio_===1?c:c.map(h=>h*this.pixelRatio_),lineDashOffset:(o||lt)*this.pixelRatio_,lineJoin:a!==void 0?a:sn,lineWidth:(l!==void 0?l:on)*this.pixelRatio_,miterLimit:u!==void 0?u:an,strokeStyle:yt(i||nn)}}}setImageStyle(e){let t;if(!e||!(t=e.getSize())){this.image_=null;return}const i=e.getPixelRatio(this.pixelRatio_),r=e.getAnchor(),s=e.getOrigin();this.image_=e.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*i,this.imageAnchorY_=r[1]*i,this.imageHeight_=t[1]*i,this.imageOpacity_=e.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=e.getRotateWithView(),this.imageRotation_=e.getRotation();const o=e.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=t[0]*i}setTextStyle(e){if(!e)this.text_="";else{const t=e.getFill();if(!t)this.textFillState_=null;else{const f=t.getColor();this.textFillState_={fillStyle:yt(f||Ne)}}const i=e.getStroke();if(!i)this.textStrokeState_=null;else{const f=i.getColor(),p=i.getLineCap(),m=i.getLineDash(),g=i.getLineDashOffset(),y=i.getLineJoin(),x=i.getWidth(),_=i.getMiterLimit();this.textStrokeState_={lineCap:p!==void 0?p:rn,lineDash:m||at,lineDashOffset:g||lt,lineJoin:y!==void 0?y:sn,lineWidth:x!==void 0?x:on,miterLimit:_!==void 0?_:an,strokeStyle:yt(f||nn)}}const r=e.getFont(),s=e.getOffsetX(),o=e.getOffsetY(),a=e.getRotateWithView(),l=e.getRotation(),u=e.getScaleArray(),c=e.getText(),h=e.getTextAlign(),d=e.getTextBaseline();this.textState_={font:r!==void 0?r:yo,textAlign:h!==void 0?h:bi,textBaseline:d!==void 0?d:ln},this.text_=c!==void 0?Array.isArray(c)?c.reduce((f,p,m)=>f+=m%2?" ":p,""):c:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*u[0],this.pixelRatio_*u[1]]}}}const ec=Qu,Pe=.5;function Bo(n,e,t,i,r,s,o,a,l){const u=l?hr(r,l):r,c=n[0]*Pe,h=n[1]*Pe,d=St(c,h);d.imageSmoothingEnabled=!1;const f=d.canvas,p=new ec(d,Pe,r,null,o,a,l?Lr(cn(),l):null),m=t.length,g=Math.floor((256*256*256-1)/m),y={};for(let _=1;_<=m;++_){const v=t[_-1],b=v.getStyleFunction()||i;if(!b)continue;let E=b(v,s);if(!E)continue;Array.isArray(E)||(E=[E]);const I=(_*g).toString(16).padStart(7,"#00000");for(let L=0,D=E.length;L<D;++L){const F=E[L],C=F.getGeometryFunction()(v);if(!C||!be(u,C.getExtent()))continue;const O=F.clone(),R=O.getFill();R&&R.setColor(I);const w=O.getStroke();w&&(w.setColor(I),w.setLineDash(null)),O.setText(void 0);const k=F.getImage();if(k){const S=k.getImageSize();if(!S)continue;const H=St(S[0],S[1],void 0,{alpha:!1}),te=H.canvas;H.fillStyle=I,H.fillRect(0,0,te.width,te.height),O.setImage(new dr({img:te,anchor:k.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:k.getOrigin(),opacity:1,size:k.getSize(),scale:k.getScale(),rotation:k.getRotation(),rotateWithView:k.getRotateWithView()}))}const G=O.getZIndex()||0;let N=y[G];N||(N={},y[G]=N,N.Polygon=[],N.Circle=[],N.LineString=[],N.Point=[]);const ee=C.getType();if(ee==="GeometryCollection"){const S=C.getGeometriesArrayRecursive();for(let H=0,te=S.length;H<te;++H){const le=S[H];N[le.getType().replace("Multi","")].push(le,O)}}else N[ee.replace("Multi","")].push(C,O)}}const x=Object.keys(y).map(Number).sort(un);for(let _=0,v=x.length;_<v;++_){const b=y[x[_]];for(const E in b){const T=b[E];for(let I=0,L=T.length;I<L;I+=2){p.setStyle(T[I+1]);for(let D=0,F=e.length;D<F;++D)p.setTransform(e[D]),p.drawGeometry(T[I])}}}return d.getImageData(0,0,f.width,f.height)}function $o(n,e,t){const i=[];if(t){const r=Math.floor(Math.round(n[0])*Pe),s=Math.floor(Math.round(n[1])*Pe),o=(ys(r,0,t.width-1)+ys(s,0,t.height-1)*t.width)*4,a=t.data[o],l=t.data[o+1],c=t.data[o+2]+256*(l+256*a),h=Math.floor((256*256*256-1)/e.length);c&&c%h===0&&i.push(e[c/h-1])}return i}const tc=.5,qo={Point:uc,LineString:oc,Polygon:hc,MultiPoint:cc,MultiLineString:ac,MultiPolygon:lc,GeometryCollection:sc,Circle:nc};function ic(n,e){return parseInt(Y(n),10)-parseInt(Y(e),10)}function xr(n,e){const t=Vo(n,e);return t*t}function Vo(n,e){return tc*n/e}function nc(n,e,t,i){const r=t.getFill(),s=t.getStroke();if(r||s){const a=n.getBuilder(t.getZIndex(),"Circle");a.setFillStrokeStyle(r,s),a.drawCircle(e,i)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i)}}function mn(n,e,t,i,r,s,o,a){const l=[],u=t.getImage();if(u){let d=!0;const f=u.getImageState();f==re.LOADED||f==re.ERROR?d=!1:f==re.IDLE&&u.load(),d&&l.push(u.ready())}const c=t.getFill();c&&c.loading()&&l.push(c.ready());const h=l.length>0;return h&&Promise.all(l).then(()=>r(null)),rc(n,e,t,i,s,o,a),h}function rc(n,e,t,i,r,s,o){const a=t.getGeometryFunction()(e);if(!a)return;const l=a.simplifyTransformed(i,r);if(t.getRenderer())Xo(n,l,t,e,o);else{const c=qo[l.getType()];c(n,l,t,e,o,s)}}function Xo(n,e,t,i,r){if(e.getType()=="GeometryCollection"){const o=e.getGeometries();for(let a=0,l=o.length;a<l;++a)Xo(n,o[a],t,i,r);return}n.getBuilder(t.getZIndex(),"Default").drawCustom(e,i,t.getRenderer(),t.getHitDetectionRenderer(),r)}function sc(n,e,t,i,r,s){const o=e.getGeometriesArray();let a,l;for(a=0,l=o.length;a<l;++a){const u=qo[o[a].getType()];u(n,o[a],t,i,r,s)}}function oc(n,e,t,i,r){const s=t.getStroke();if(s){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(e,i,r)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,r)}}function ac(n,e,t,i,r){const s=t.getStroke();if(s){const a=n.getBuilder(t.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(e,i,r)}const o=t.getText();if(o&&o.getText()){const a=n.getBuilder(t.getZIndex(),"Text");a.setTextStyle(o),a.drawText(e,i,r)}}function lc(n,e,t,i,r){const s=t.getFill(),o=t.getStroke();if(o||s){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(e,i,r)}const a=t.getText();if(a&&a.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,r)}}function uc(n,e,t,i,r,s){const o=t.getImage(),a=t.getText(),l=a&&a.getText(),u=s&&o&&l?{}:void 0;if(o){if(o.getImageState()!=re.LOADED)return;const c=n.getBuilder(t.getZIndex(),"Image");c.setImageStyle(o,u),c.drawPoint(e,i,r)}if(l){const c=n.getBuilder(t.getZIndex(),"Text");c.setTextStyle(a,u),c.drawText(e,i,r)}}function cc(n,e,t,i,r,s){const o=t.getImage(),a=o&&o.getOpacity()!==0,l=t.getText(),u=l&&l.getText(),c=s&&a&&u?{}:void 0;if(a){if(o.getImageState()!=re.LOADED)return;const h=n.getBuilder(t.getZIndex(),"Image");h.setImageStyle(o,c),h.drawMultiPoint(e,i,r)}if(u){const h=n.getBuilder(t.getZIndex(),"Text");h.setTextStyle(l,c),h.drawText(e,i,r)}}function hc(n,e,t,i,r){const s=t.getFill(),o=t.getStroke();if(s||o){const l=n.getBuilder(t.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(e,i,r)}const a=t.getText();if(a&&a.getText()){const l=n.getBuilder(t.getZIndex(),"Text");l.setTextStyle(a),l.drawText(e,i,r)}}class dc extends bo{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=_i(),this.wrappedRenderedExtent_=_i(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedPixelRatio_=1,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(e,t,i){const r=t.extent,s=t.viewState,o=s.center,a=s.resolution,l=s.projection,u=s.rotation,c=l.getExtent(),h=this.getLayer().getSource(),d=this.getLayer().getDeclutter(),f=t.pixelRatio,p=t.viewHints,m=!(p[We.ANIMATING]||p[We.INTERACTING]),g=this.compositionContext_,y=Math.round(t.size[0]*f),x=Math.round(t.size[1]*f),_=h.getWrapX()&&l.canWrapX(),v=_?Ye(c):null,b=_?Math.ceil((r[2]-c[2])/v)+1:1;let E=_?Math.floor((r[0]-c[0])/v):0;do{const T=this.getRenderTransform(o,a,u,f,y,x,E*v);e.execute(g,[g.canvas.width,g.canvas.height],T,u,m,i===void 0?di:i?gn:Ju,i?d&&t.declutter[d]:void 0)}while(++E<b)}setupCompositionContext_(){if(this.opacity_!==1){const e=St(this.context.canvas.width,this.context.canvas.height,xs);this.compositionContext_=e}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const e=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=e,vo(this.compositionContext_),xs.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(e){this.getLayer().getDeclutter()&&(this.setupCompositionContext_(),this.renderWorlds(this.replayGroup_,e,!0),this.releaseCompositionContext_())}renderDeferredInternal(e){this.replayGroup_.renderDeferred()}renderFrame(e,t){const i=e.pixelRatio,r=e.layerStatesArray[e.layerIndex];Al(this.pixelTransform,1/i,1/i),wo(this.inversePixelTransform,this.pixelTransform);const s=Co(this.pixelTransform);this.useContainer(t,s,this.getBackground(e));const o=this.context,a=o.canvas,l=this.replayGroup_;let u=l&&!l.isEmpty();if(!u&&!(this.getLayer().hasListener(_s.PRERENDER)||this.getLayer().hasListener(_s.POSTRENDER)))return null;const c=Math.round(e.size[0]*i),h=Math.round(e.size[1]*i);a.width!=c||a.height!=h?(a.width=c,a.height=h,a.style.transform!==s&&(a.style.transform=s)):this.containerReused||o.clearRect(0,0,c,h),this.preRender(o,e);const d=e.viewState,f=d.projection;this.opacity_=r.opacity,this.setupCompositionContext_();let p=!1;if(u&&r.extent&&this.clipping){const m=fr(r.extent,f);u=be(m,e.extent),p=u&&!st(m,e.extent),p&&this.clipUnrotated(this.compositionContext_,e,m)}return u&&this.renderWorlds(l,e,this.getLayer().getDeclutter()?!1:void 0),p&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,e),this.renderedRotation_!==d.rotation&&(this.renderedRotation_=d.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(e){return new Promise(t=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];gt(this.pixelTransform,i);const r=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,u=this.getLayer(),c=[],h=i[0]*Pe,d=i[1]*Pe;c.push(this.getRenderTransform(r,s,o,Pe,h,d,0).slice());const f=u.getSource(),p=a.getExtent();if(f.getWrapX()&&a.canWrapX()&&!st(p,l)){let g=l[0];const y=Ye(p);let x=0,_;for(;g<p[0];)--x,_=y*x,c.push(this.getRenderTransform(r,s,o,Pe,h,d,_).slice()),g+=y;for(x=0,g=l[2];g>p[2];)++x,_=y*x,c.push(this.getRenderTransform(r,s,o,Pe,h,d,_).slice()),g-=y}const m=cn();this.hitDetectionImageData_=Bo(i,c,this.renderedFeatures_,u.getStyleFunction(),l,s,o,xr(s,this.renderedPixelRatio_),m?a:null)}t($o(e,this.renderedFeatures_,this.hitDetectionImageData_))})}forEachFeatureAtCoordinate(e,t,i,r,s){if(!this.replayGroup_)return;const o=t.viewState.resolution,a=t.viewState.rotation,l=this.getLayer(),u={},c=function(p,m,g){const y=Y(p),x=u[y];if(x){if(x!==!0&&g<x.distanceSq){if(g===0)return u[y]=!0,s.splice(s.lastIndexOf(x),1),r(p,l,m);x.geometry=m,x.distanceSq=g}}else{if(g===0)return u[y]=!0,r(p,l,m);s.push(u[y]={feature:p,layer:l,geometry:m,distanceSq:g,callback:r})}};let h;const d=[this.replayGroup_],f=this.getLayer().getDeclutter();return d.some(p=>h=p.forEachFeatureAtCoordinate(e,o,a,i,c,f&&t.declutter[f]?t.declutter[f].all().map(m=>m.value):null)),h}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}prepareFrame(e){const t=this.getLayer(),i=t.getSource();if(!i)return!1;const r=e.viewHints[We.ANIMATING],s=e.viewHints[We.INTERACTING],o=t.getUpdateWhileAnimating(),a=t.getUpdateWhileInteracting();if(this.ready&&!o&&r||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=e.extent,u=e.viewState,c=u.projection,h=u.resolution,d=e.pixelRatio,f=t.getRevision(),p=t.getRenderBuffer();let m=t.getRenderOrder();m===void 0&&(m=ic);const g=u.center.slice(),y=_t(l,p*h),x=y.slice(),_=[y.slice()],v=c.getExtent();if(i.getWrapX()&&c.canWrapX()&&!st(v,e.extent)){const w=Ye(v),k=Math.max(Ye(y)/2,w);y[0]=v[0]-k,y[2]=v[2]+k,So(g,c);const G=Dl(_[0],c);G[0]<v[0]&&G[2]<v[2]?_.push([G[0]+w,G[1],G[2]+w,G[3]]):G[0]>v[0]&&G[2]>v[2]&&_.push([G[0]-w,G[1],G[2]-w,G[3]])}if(this.ready&&this.renderedResolution_==h&&this.renderedRevision_==f&&this.renderedRenderOrder_==m&&st(this.wrappedRenderedExtent_,y))return Rn(this.renderedExtent_,x)||(this.hitDetectionImageData_=null,this.renderedExtent_=x),this.renderedCenter_=g,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const b=new No(Vo(h,d),y,h,d),E=cn();let T;if(E){for(let w=0,k=_.length;w<k;++w){const G=_[w],N=hr(G,c);i.loadFeatures(N,Ol(h,c),E)}T=Lr(E,c)}else for(let w=0,k=_.length;w<k;++w)i.loadFeatures(_[w],h,c);const I=xr(h,d);let L=!0;const D=(w,k)=>{let G;const N=w.getStyleFunction()||t.getStyleFunction();if(N&&(G=N(w,h)),G){const ee=this.renderFeature(w,I,G,b,T,this.getLayer().getDeclutter(),k);L=L&&!ee}},F=hr(y,c),C=i.getFeaturesInExtent(F);m&&C.sort(m);for(let w=0,k=C.length;w<k;++w)D(C[w],w);this.renderedFeatures_=C,this.ready=L;const O=b.finish(),R=new Wo(y,h,d,i.getOverlaps(),O,t.getRenderBuffer(),!!e.declutter);return this.renderedResolution_=h,this.renderedRevision_=f,this.renderedRenderOrder_=m,this.renderedExtent_=x,this.wrappedRenderedExtent_=y,this.renderedCenter_=g,this.renderedProjection_=c,this.renderedPixelRatio_=d,this.replayGroup_=R,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(e,t,i,r,s,o,a){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let u=0,c=i.length;u<c;++u)l=mn(r,e,i[u],t,this.boundHandleStyleImageChange_,s,o,a)||l;else l=mn(r,e,i,t,this.boundHandleStyleImageChange_,s,o,a);return l}}class jr extends To{constructor(e){super(e)}createRenderer(){return new dc(this)}}class Rs{constructor(e){this.rbush_=new zl(e),this.items_={}}insert(e,t){const i={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3],value:t};this.rbush_.insert(i),this.items_[Y(t)]=i}load(e,t){const i=new Array(t.length);for(let r=0,s=t.length;r<s;r++){const o=e[r],a=t[r],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[r]=l,this.items_[Y(a)]=l}this.rbush_.load(i)}remove(e){const t=Y(e),i=this.items_[t];return delete this.items_[t],this.rbush_.remove(i)!==null}update(e,t){const i=this.items_[Y(t)],r=[i.minX,i.minY,i.maxX,i.maxY];ni(r,e)||(this.remove(t),this.insert(e,t))}getAll(){return this.rbush_.all().map(function(t){return t.value})}getInExtent(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this.rbush_.search(t).map(function(r){return r.value})}forEach(e){return this.forEach_(this.getAll(),e)}forEachInExtent(e,t){return this.forEach_(this.getInExtent(e),t)}forEach_(e,t){let i;for(let r=0,s=e.length;r<s;r++)if(i=t(e[r]),i)return i;return i}isEmpty(){return ii(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(e){const t=this.rbush_.toJSON();return cr(t.minX,t.minY,t.maxX,t.maxY,e)}concat(e){this.rbush_.load(e.rbush_.all());for(const t in e.items_)this.items_[t]=e.items_[t]}}const Ve={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function fc(n,e){return[[-1/0,-1/0,1/0,1/0]]}function pc(n,e){return[n]}let gc=!1;function Uo(n,e,t,i,r,s,o){const a=new XMLHttpRequest;a.open("GET",typeof n=="function"?n(t,i,r):n,!0),e.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=gc,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const u=e.getType();let c;u=="json"?c=JSON.parse(a.responseText):u=="text"?c=a.responseText:u=="xml"?(c=a.responseXML,c||(c=new DOMParser().parseFromString(a.responseText,"application/xml"))):u=="arraybuffer"&&(c=a.response),c?s(e.readFeatures(c,{extent:t,featureProjection:r}),e.readProjection(c)):o()}else o()},a.onerror=o,a.send()}function Fs(n,e){return function(t,i,r,s,o){const a=this;Uo(n,e,t,i,r,function(l,u){a.addFeatures(l),s!==void 0&&s(l)},o||Eo)}}class ft extends Pr{constructor(e,t,i){super(e),this.feature=t,this.features=i}}class Hi extends Ri{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:e.wrapX!==void 0?e.wrapX:!0}),this.on,this.once,this.un,this.loader_=Eo,this.format_=e.format,this.overlaps_=e.overlaps===void 0?!0:e.overlaps,this.url_=e.url,e.loader!==void 0?this.loader_=e.loader:this.url_!==void 0&&(hi(this.format_,"`format` must be set when `url` is set"),this.loader_=Fs(this.url_,this.format_)),this.strategy_=e.strategy!==void 0?e.strategy:fc;const t=e.useSpatialIndex!==void 0?e.useSpatialIndex:!0;this.featuresRtree_=t?new Rs:null,this.loadedExtentsRtree_=new Rs,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,r;Array.isArray(e.features)?r=e.features:e.features&&(i=e.features,r=i.getArray()),!t&&i===void 0&&(i=new Gl(r)),r!==void 0&&this.addFeaturesInternal(r),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(e){this.addFeatureInternal(e),this.changed()}addFeatureInternal(e){const t=Y(e);if(!this.addToIndex_(t,e)){this.featuresCollection_&&this.featuresCollection_.remove(e);return}this.setupChangeEvents_(t,e);const i=e.getGeometry();if(i){const r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,e)}else this.nullGeometryFeatures_[t]=e;this.dispatchEvent(new ft(Ve.ADDFEATURE,e))}setupChangeEvents_(e,t){t instanceof _e||(this.featureChangeKeys_[e]=[xi(t,vt.CHANGE,this.handleFeatureChange_,this),xi(t,jl.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(e,t){let i=!0;if(t.getId()!==void 0){const r=String(t.getId());if(!(r in this.idIndex_))this.idIndex_[r]=t;else if(t instanceof _e){const s=this.idIndex_[r];s instanceof _e?Array.isArray(s)?s.push(t):this.idIndex_[r]=[s,t]:i=!1}else i=!1}return i&&(hi(!(e in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[e]=t),i}addFeatures(e){this.addFeaturesInternal(e),this.changed()}addFeaturesInternal(e){const t=[],i=[],r=[];for(let s=0,o=e.length;s<o;s++){const a=e[s],l=Y(a);this.addToIndex_(l,a)&&i.push(a)}for(let s=0,o=i.length;s<o;s++){const a=i[s],l=Y(a);this.setupChangeEvents_(l,a);const u=a.getGeometry();if(u){const c=u.getExtent();t.push(c),r.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(t,r),this.hasListener(Ve.ADDFEATURE))for(let s=0,o=i.length;s<o;s++)this.dispatchEvent(new ft(Ve.ADDFEATURE,i[s]))}bindFeaturesCollection_(e){let t=!1;this.addEventListener(Ve.ADDFEATURE,function(i){t||(t=!0,e.push(i.feature),t=!1)}),this.addEventListener(Ve.REMOVEFEATURE,function(i){t||(t=!0,e.remove(i.feature),t=!1)}),e.addEventListener(bs.ADD,i=>{t||(t=!0,this.addFeature(i.element),t=!1)}),e.addEventListener(bs.REMOVE,i=>{t||(t=!0,this.removeFeature(i.element),t=!1)}),this.featuresCollection_=e}clear(e){if(e){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(yi);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=r=>{this.removeFeatureInternal(r)};this.featuresRtree_.forEach(i);for(const r in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[r])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const t=new ft(Ve.CLEAR);this.dispatchEvent(t),this.changed()}forEachFeature(e){if(this.featuresRtree_)return this.featuresRtree_.forEach(e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureAtCoordinateDirect(e,t){const i=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(i,function(r){const s=r.getGeometry();if(s instanceof _e||s.intersectsCoordinate(e))return t(r)})}forEachFeatureInExtent(e,t){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(e,t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureIntersectingExtent(e,t){return this.forEachFeatureInExtent(e,function(i){const r=i.getGeometry();if(r instanceof _e||r.intersectsExtent(e)){const s=t(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let e;return this.featuresCollection_?e=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(e=this.featuresRtree_.getAll(),ii(this.nullGeometryFeatures_)||ot(e,Object.values(this.nullGeometryFeatures_))),e}getFeaturesAtCoordinate(e){const t=[];return this.forEachFeatureAtCoordinateDirect(e,function(i){t.push(i)}),t}getFeaturesInExtent(e,t){if(this.featuresRtree_){if(!(t&&t.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(e);const r=Nl(e,t);return[].concat(...r.map(s=>this.featuresRtree_.getInExtent(s)))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(e,t){const i=e[0],r=e[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return t=t||Wl,this.featuresRtree_.forEachInExtent(l,function(u){if(t(u)){const c=u.getGeometry(),h=a;if(a=c instanceof _e?0:c.closestPointXY(i,r,o,a),a<h){s=u;const d=Math.sqrt(a);l[0]=i-d,l[1]=r-d,l[2]=i+d,l[3]=r+d}}}),s}getExtent(e){return this.featuresRtree_.getExtent(e)}getFeatureById(e){const t=this.idIndex_[e.toString()];return t!==void 0?t:null}getFeatureByUid(e){const t=this.uidIndex_[e];return t!==void 0?t:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(e){const t=e.target,i=Y(t),r=t.getGeometry();if(!r)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(t),this.nullGeometryFeatures_[i]=t);else{const o=r.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,t)):this.featuresRtree_&&this.featuresRtree_.update(o,t)}const s=t.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==t&&(this.removeFromIdIndex_(t),this.idIndex_[o]=t)}else this.removeFromIdIndex_(t),this.uidIndex_[i]=t;this.changed(),this.dispatchEvent(new ft(Ve.CHANGEFEATURE,t))}hasFeature(e){const t=e.getId();return t!==void 0?t in this.idIndex_:Y(e)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&ii(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(e,t,i){const r=this.loadedExtentsRtree_,s=this.strategy_(e,t,i);for(let o=0,a=s.length;o<a;++o){const l=s[o];r.forEachInExtent(l,function(c){return st(c.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ft(Ve.FEATURESLOADSTART)),this.loader_.call(this,l,t,i,c=>{--this.loadingExtentsCount_,this.dispatchEvent(new ft(Ve.FEATURESLOADEND,void 0,c))},()=>{--this.loadingExtentsCount_,this.dispatchEvent(new ft(Ve.FEATURESLOADERROR))}),r.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(e){const t=this.loadedExtentsRtree_;let i;t.forEachInExtent(e,function(r){if(ni(r.extent,e))return i=r,!0}),i&&t.remove(i)}removeFeature(e){if(!e)return;const t=Y(e);t in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[t]:this.featuresRtree_&&this.featuresRtree_.remove(e),this.removeFeatureInternal(e)&&this.changed()}removeFeatureInternal(e){const t=Y(e),i=this.featureChangeKeys_[t];if(!i)return;i.forEach(yi),delete this.featureChangeKeys_[t];const r=e.getId();return r!==void 0&&delete this.idIndex_[r.toString()],delete this.uidIndex_[t],this.dispatchEvent(new ft(Ve.REMOVEFEATURE,e)),e}removeFromIdIndex_(e){let t=!1;for(const i in this.idIndex_){const r=this.idIndex_[i];if(e instanceof _e&&Array.isArray(r)&&r.includes(e))r.splice(r.indexOf(e),1);else if(this.idIndex_[i]===e){delete this.idIndex_[i],t=!0;break}}return t}setLoader(e){this.loader_=e}setUrl(e){hi(this.format_,"`format` must be set when `url` is set"),this.url_=e,this.setLoader(Fs(e,this.format_))}}class mc extends Ar{constructor(e,t,i,r,s){const o=s!==void 0?re.IDLE:re.LOADED;super(e,t,i,o),this.loader_=s!==void 0?s:null,this.canvas_=r,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=re.ERROR):this.state=re.LOADED,this.changed()}load(){this.state==re.IDLE&&(this.state=re.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const ks=[];class yc extends Io{constructor(e,t,i,r){super(e,t,{transition:0}),this.context_={},this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=r.bind(void 0,this),this.wrappedTileCoord=i}getContext(e){const t=Y(e);return t in this.context_||(this.context_[t]=St(1,1,ks)),this.context_[t]}hasContext(e){return Y(e)in this.context_}getImage(e){return this.hasContext(e)?this.getContext(e).canvas:null}getReplayState(e){const t=Y(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){for(const e in this.context_){const t=this.context_[e];vo(t),ks.push(t.canvas),delete this.context_[e]}super.release()}}let Yo=class extends Io{constructor(e,t,i,r,s,o){super(e,t,o),this.extent=null,this.format_=r,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=s,this.url_=i,this.key=i}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==Q.IDLE&&(this.setState(Q.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(Q.ERROR)}setFeatures(e){this.features_=e,this.setState(Q.LOADED)}setLoader(e){this.loader_=e}};class xc extends Ro{constructor(e){e=e||{},super(e)}}class _c extends bo{constructor(e){super(e),this.image_=null}getImage(){return this.image_?this.image_.getImage():null}prepareFrame(e){const t=e.layerStatesArray[e.layerIndex],i=e.pixelRatio,r=e.viewState,s=r.resolution,o=this.getLayer().getSource(),a=e.viewHints;let l=e.extent;if(t.extent!==void 0&&(l=Fn(l,fr(t.extent,r.projection))),!a[We.ANIMATING]&&!a[We.INTERACTING]&&!Fo(l))if(o){const u=r.projection,c=o.getImage(l,s,i,u);c&&(this.loadImage(c)?this.image_=c:c.getState()===re.EMPTY&&(this.image_=null))}else this.image_=null;return!!this.image_}getData(e){const t=this.frameState;if(!t)return null;const i=this.getLayer(),r=gt(t.pixelToCoordinateTransform,e.slice()),s=i.getExtent();if(s&&!tn(s,r))return null;const o=this.image_.getExtent(),a=this.image_.getImage(),l=Ye(o),u=Math.floor(a.width*((r[0]-o[0])/l));if(u<0||u>=a.width)return null;const c=wt(o),h=Math.floor(a.height*((o[3]-r[1])/c));return h<0||h>=a.height?null:this.getImageData(a,u,h)}renderFrame(e,t){const i=this.image_,r=i.getExtent(),s=i.getResolution(),[o,a]=Array.isArray(s)?s:[s,s],l=i.getPixelRatio(),u=e.layerStatesArray[e.layerIndex],c=e.pixelRatio,h=e.viewState,d=h.center,f=h.resolution,p=c*o/(f*l),m=c*a/(f*l),g=e.extent,y=h.resolution,x=h.rotation,_=Math.round(Ye(g)/y*c),v=Math.round(wt(g)/y*c);ti(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,x,-_/2,-v/2),wo(this.inversePixelTransform,this.pixelTransform);const b=Co(this.pixelTransform);this.useContainer(t,b,this.getBackground(e));const E=this.getRenderContext(e),T=this.context.canvas;T.width!=_||T.height!=v?(T.width=_,T.height=v):this.containerReused||E.clearRect(0,0,_,v);let I=!1,L=!0;if(u.extent){const R=fr(u.extent,h.projection);L=be(R,e.extent),I=L&&!st(R,e.extent),I&&this.clipUnrotated(E,e,R)}const D=i.getImage(),F=ti(this.tempTransform,_/2,v/2,p,m,0,l*(r[0]-d[0])/o,l*(d[1]-r[3])/a);this.renderedResolution=a*c/l;const C=D.width*F[0],O=D.height*F[3];if(this.getLayer().getSource().getInterpolate()||(E.imageSmoothingEnabled=!1),this.preRender(E,e),L&&C>=.5&&O>=.5){const R=F[4],w=F[5],k=u.opacity;k!==1&&(E.save(),E.globalAlpha=k),E.drawImage(D,0,0,+D.width,+D.height,R,w,C,O),k!==1&&E.restore()}return this.postRender(this.context,e),I&&E.restore(),E.imageSmoothingEnabled=!0,b!==T.style.transform&&(T.style.transform=b),this.container}}class bc extends xc{constructor(e){super(e)}createRenderer(){return new _c(this)}getData(e){return super.getData(e)}}const Ho=bc;var Nr={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */Nr.read=function(n,e,t,i,r){var s,o,a=r*8-i-1,l=(1<<a)-1,u=l>>1,c=-7,h=t?r-1:0,d=t?-1:1,f=n[e+h];for(h+=d,s=f&(1<<-c)-1,f>>=-c,c+=a;c>0;s=s*256+n[e+h],h+=d,c-=8);for(o=s&(1<<-c)-1,s>>=-c,c+=i;c>0;o=o*256+n[e+h],h+=d,c-=8);if(s===0)s=1-u;else{if(s===l)return o?NaN:(f?-1:1)*(1/0);o=o+Math.pow(2,i),s=s-u}return(f?-1:1)*o*Math.pow(2,s-i)};Nr.write=function(n,e,t,i,r,s){var o,a,l,u=s*8-r-1,c=(1<<u)-1,h=c>>1,d=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:s-1,p=i?1:-1,m=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=c):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+h>=1?e+=d/l:e+=d*Math.pow(2,1-h),e*l>=2&&(o++,l/=2),o+h>=c?(a=0,o=c):o+h>=1?(a=(e*l-1)*Math.pow(2,r),o=o+h):(a=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;n[t+f]=a&255,f+=p,a/=256,r-=8);for(o=o<<r|a,u+=r;u>0;n[t+f]=o&255,f+=p,o/=256,u-=8);n[t+f-p]|=m*128};var vc=U,Ni=Nr;function U(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0),this.pos=0,this.type=0,this.length=this.buf.length}U.Varint=0;U.Fixed64=1;U.Bytes=2;U.Fixed32=5;var _r=65536*65536,Ms=1/_r,wc=12,Zo=typeof TextDecoder>"u"?null:new TextDecoder("utf8");U.prototype={destroy:function(){this.buf=null},readFields:function(n,e,t){for(t=t||this.length;this.pos<t;){var i=this.readVarint(),r=i>>3,s=this.pos;this.type=i&7,n(r,e,this),this.pos===s&&this.skip(i)}return e},readMessage:function(n,e){return this.readFields(n,e,this.readVarint()+this.pos)},readFixed32:function(){var n=Wi(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=Ps(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=Wi(this.buf,this.pos)+Wi(this.buf,this.pos+4)*_r;return this.pos+=8,n},readSFixed64:function(){var n=Wi(this.buf,this.pos)+Ps(this.buf,this.pos+4)*_r;return this.pos+=8,n},readFloat:function(){var n=Ni.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=Ni.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var e=this.buf,t,i;return i=e[this.pos++],t=i&127,i<128||(i=e[this.pos++],t|=(i&127)<<7,i<128)||(i=e[this.pos++],t|=(i&127)<<14,i<128)||(i=e[this.pos++],t|=(i&127)<<21,i<128)?t:(i=e[this.pos],t|=(i&15)<<28,Cc(t,n,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2===1?(n+1)/-2:n/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var n=this.readVarint()+this.pos,e=this.pos;return this.pos=n,n-e>=wc&&Zo?zc(this.buf,e,n):Oc(this.buf,e,n)},readBytes:function(){var n=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,n);return this.pos=n,e},readPackedVarint:function(n,e){if(this.type!==U.Bytes)return n.push(this.readVarint(e));var t=nt(this);for(n=n||[];this.pos<t;)n.push(this.readVarint(e));return n},readPackedSVarint:function(n){if(this.type!==U.Bytes)return n.push(this.readSVarint());var e=nt(this);for(n=n||[];this.pos<e;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){if(this.type!==U.Bytes)return n.push(this.readBoolean());var e=nt(this);for(n=n||[];this.pos<e;)n.push(this.readBoolean());return n},readPackedFloat:function(n){if(this.type!==U.Bytes)return n.push(this.readFloat());var e=nt(this);for(n=n||[];this.pos<e;)n.push(this.readFloat());return n},readPackedDouble:function(n){if(this.type!==U.Bytes)return n.push(this.readDouble());var e=nt(this);for(n=n||[];this.pos<e;)n.push(this.readDouble());return n},readPackedFixed32:function(n){if(this.type!==U.Bytes)return n.push(this.readFixed32());var e=nt(this);for(n=n||[];this.pos<e;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){if(this.type!==U.Bytes)return n.push(this.readSFixed32());var e=nt(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){if(this.type!==U.Bytes)return n.push(this.readFixed64());var e=nt(this);for(n=n||[];this.pos<e;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){if(this.type!==U.Bytes)return n.push(this.readSFixed64());var e=nt(this);for(n=n||[];this.pos<e;)n.push(this.readSFixed64());return n},skip:function(n){var e=n&7;if(e===U.Varint)for(;this.buf[this.pos++]>127;);else if(e===U.Bytes)this.pos=this.readVarint()+this.pos;else if(e===U.Fixed32)this.pos+=4;else if(e===U.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(n,e){this.writeVarint(n<<3|e)},realloc:function(n){for(var e=this.length||16;e<this.pos+n;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4),qt(this.buf,n,this.pos),this.pos+=4},writeSFixed32:function(n){this.realloc(4),qt(this.buf,n,this.pos),this.pos+=4},writeFixed64:function(n){this.realloc(8),qt(this.buf,n&-1,this.pos),qt(this.buf,Math.floor(n*Ms),this.pos+4),this.pos+=8},writeSFixed64:function(n){this.realloc(8),qt(this.buf,n&-1,this.pos),qt(this.buf,Math.floor(n*Ms),this.pos+4),this.pos+=8},writeVarint:function(n){if(n=+n||0,n>268435455||n<0){Sc(n,this);return}this.realloc(4),this.buf[this.pos++]=n&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=(n>>>=7)&127|(n>127?128:0),!(n<=127)&&(this.buf[this.pos++]=n>>>7&127)))},writeSVarint:function(n){this.writeVarint(n<0?-n*2-1:n*2)},writeBoolean:function(n){this.writeVarint(!!n)},writeString:function(n){n=String(n),this.realloc(n.length*4),this.pos++;var e=this.pos;this.pos=Gc(this.buf,n,this.pos);var t=this.pos-e;t>=128&&Ls(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(n){this.realloc(4),Ni.write(this.buf,n,this.pos,!0,23,4),this.pos+=4},writeDouble:function(n){this.realloc(8),Ni.write(this.buf,n,this.pos,!0,52,8),this.pos+=8},writeBytes:function(n){var e=n.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,e){this.pos++;var t=this.pos;n(e,this);var i=this.pos-t;i>=128&&Ls(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeMessage:function(n,e,t){this.writeTag(n,U.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(n,e){e.length&&this.writeMessage(n,Ic,e)},writePackedSVarint:function(n,e){e.length&&this.writeMessage(n,Rc,e)},writePackedBoolean:function(n,e){e.length&&this.writeMessage(n,Mc,e)},writePackedFloat:function(n,e){e.length&&this.writeMessage(n,Fc,e)},writePackedDouble:function(n,e){e.length&&this.writeMessage(n,kc,e)},writePackedFixed32:function(n,e){e.length&&this.writeMessage(n,Lc,e)},writePackedSFixed32:function(n,e){e.length&&this.writeMessage(n,Pc,e)},writePackedFixed64:function(n,e){e.length&&this.writeMessage(n,Ac,e)},writePackedSFixed64:function(n,e){e.length&&this.writeMessage(n,Dc,e)},writeBytesField:function(n,e){this.writeTag(n,U.Bytes),this.writeBytes(e)},writeFixed32Field:function(n,e){this.writeTag(n,U.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(n,e){this.writeTag(n,U.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(n,e){this.writeTag(n,U.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(n,e){this.writeTag(n,U.Fixed64),this.writeSFixed64(e)},writeVarintField:function(n,e){this.writeTag(n,U.Varint),this.writeVarint(e)},writeSVarintField:function(n,e){this.writeTag(n,U.Varint),this.writeSVarint(e)},writeStringField:function(n,e){this.writeTag(n,U.Bytes),this.writeString(e)},writeFloatField:function(n,e){this.writeTag(n,U.Fixed32),this.writeFloat(e)},writeDoubleField:function(n,e){this.writeTag(n,U.Fixed64),this.writeDouble(e)},writeBooleanField:function(n,e){this.writeVarintField(n,!!e)}};function Cc(n,e,t){var i=t.buf,r,s;if(s=i[t.pos++],r=(s&112)>>4,s<128||(s=i[t.pos++],r|=(s&127)<<3,s<128)||(s=i[t.pos++],r|=(s&127)<<10,s<128)||(s=i[t.pos++],r|=(s&127)<<17,s<128)||(s=i[t.pos++],r|=(s&127)<<24,s<128)||(s=i[t.pos++],r|=(s&1)<<31,s<128))return $t(n,r,e);throw new Error("Expected varint not more than 10 bytes")}function nt(n){return n.type===U.Bytes?n.readVarint()+n.pos:n.pos+1}function $t(n,e,t){return t?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function Sc(n,e){var t,i;if(n>=0?(t=n%4294967296|0,i=n/4294967296|0):(t=~(-n%4294967296),i=~(-n/4294967296),t^4294967295?t=t+1|0:(t=0,i=i+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Tc(t,i,e),Ec(i,e)}function Tc(n,e,t){t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos]=n&127}function Ec(n,e){var t=(n&7)<<4;e.buf[e.pos++]|=t|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function Ls(n,e,t){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(i);for(var r=t.pos-1;r>=n;r--)t.buf[r+i]=t.buf[r]}function Ic(n,e){for(var t=0;t<n.length;t++)e.writeVarint(n[t])}function Rc(n,e){for(var t=0;t<n.length;t++)e.writeSVarint(n[t])}function Fc(n,e){for(var t=0;t<n.length;t++)e.writeFloat(n[t])}function kc(n,e){for(var t=0;t<n.length;t++)e.writeDouble(n[t])}function Mc(n,e){for(var t=0;t<n.length;t++)e.writeBoolean(n[t])}function Lc(n,e){for(var t=0;t<n.length;t++)e.writeFixed32(n[t])}function Pc(n,e){for(var t=0;t<n.length;t++)e.writeSFixed32(n[t])}function Ac(n,e){for(var t=0;t<n.length;t++)e.writeFixed64(n[t])}function Dc(n,e){for(var t=0;t<n.length;t++)e.writeSFixed64(n[t])}function Wi(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+n[e+3]*16777216}function qt(n,e,t){n[t]=e,n[t+1]=e>>>8,n[t+2]=e>>>16,n[t+3]=e>>>24}function Ps(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16)+(n[e+3]<<24)}function Oc(n,e,t){for(var i="",r=e;r<t;){var s=n[r],o=null,a=s>239?4:s>223?3:s>191?2:1;if(r+a>t)break;var l,u,c;a===1?s<128&&(o=s):a===2?(l=n[r+1],(l&192)===128&&(o=(s&31)<<6|l&63,o<=127&&(o=null))):a===3?(l=n[r+1],u=n[r+2],(l&192)===128&&(u&192)===128&&(o=(s&15)<<12|(l&63)<<6|u&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(l=n[r+1],u=n[r+2],c=n[r+3],(l&192)===128&&(u&192)===128&&(c&192)===128&&(o=(s&15)<<18|(l&63)<<12|(u&63)<<6|c&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),i+=String.fromCharCode(o),r+=a}return i}function zc(n,e,t){return Zo.decode(n.subarray(e,t))}function Gc(n,e,t){for(var i=0,r,s;i<e.length;i++){if(r=e.charCodeAt(i),r>55295&&r<57344)if(s)if(r<56320){n[t++]=239,n[t++]=191,n[t++]=189,s=r;continue}else r=s-55296<<10|r-56320|65536,s=null;else{r>56319||i+1===e.length?(n[t++]=239,n[t++]=191,n[t++]=189):s=r;continue}else s&&(n[t++]=239,n[t++]=191,n[t++]=189,s=null);r<128?n[t++]=r:(r<2048?n[t++]=r>>6|192:(r<65536?n[t++]=r>>12|224:(n[t++]=r>>18|240,n[t++]=r>>12&63|128),n[t++]=r>>6&63|128),n[t++]=r&63|128)}return t}const jc=Bl(vc);class Nc extends zo{constructor(e){super(),e=e||{},this.dataProjection=new $l({code:"",units:"tile-pixels"}),this.featureClass_=e.featureClass?e.featureClass:_e,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,i,r){e.pos=t.geometry;const s=e.readVarint()+e.pos;let o=1,a=0,l=0,u=0,c=0,h=0;for(;e.pos<s;){if(!a){const d=e.readVarint();o=d&7,a=d>>3}if(a--,o===1||o===2)l+=e.readSVarint(),u+=e.readSVarint(),o===1&&c>h&&(r.push(c),h=c),i.push(l,u),c+=2;else if(o===7)c>h&&(i.push(i[h],i[h+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>h&&(r.push(c),h=c)}createFeature_(e,t,i){const r=t.type;if(r===0)return null;let s;const o=t.properties;let a;this.idProperty_?(a=o[this.idProperty_],delete o[this.idProperty_]):a=t.id,o[this.layerName_]=t.layer.name;const l=[],u=[];this.readRawGeometry_(e,t,l,u);const c=Vc(r,u.length);if(this.featureClass_===_e)s=new this.featureClass_(c,l,u,2,o,a),s.transform(i.dataProjection);else{let h;if(c=="Polygon"){const p=mo(l,u);h=p.length>1?new wi(l,"XY",p):new Qi(l,"XY",u)}else h=c==="Point"?new Ki(l,"XY"):c==="LineString"?new Nt(l,"XY"):c==="MultiPoint"?new Fi(l,"XY"):c==="MultiLineString"?new vi(l,"XY",u):null;const d=this.featureClass_;s=new d,this.geometryName_&&s.setGeometryName(this.geometryName_);const f=Mn(h,!1,i);s.setGeometry(f),a!==void 0&&s.setId(a),s.setProperties(o,!0)}return s}getType(){return"arraybuffer"}readFeatures(e,t){const i=this.layers_;t=this.adaptOptions(t);const r=me(t.dataProjection);r.setWorldExtent(t.extent),t.dataProjection=r;const s=new jc(e),o=s.readFields(Wc,{}),a=[];for(const l in o){if(i&&!i.includes(l))continue;const u=o[l],c=u?[0,0,u.extent,u.extent]:null;r.setExtent(c);for(let h=0,d=u.length;h<d;++h){const f=qc(s,u,h),p=this.createFeature_(s,f,t);p!==null&&a.push(p)}}return a}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}}function Wc(n,e,t){if(n===3){const i={keys:[],values:[],features:[]},r=t.readVarint()+t.pos;t.readFields(Bc,i,r),i.length=i.features.length,i.length&&(e[i.name]=i)}}function Bc(n,e,t){if(n===15)e.version=t.readVarint();else if(n===1)e.name=t.readString();else if(n===5)e.extent=t.readVarint();else if(n===2)e.features.push(t.pos);else if(n===3)e.keys.push(t.readString());else if(n===4){let i=null;const r=t.readVarint()+t.pos;for(;t.pos<r;)n=t.readVarint()>>3,i=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null;e.values.push(i)}}function $c(n,e,t){if(n==1)e.id=t.readVarint();else if(n==2){const i=t.readVarint()+t.pos;for(;t.pos<i;){const r=e.layer.keys[t.readVarint()],s=e.layer.values[t.readVarint()];e.properties[r]=s}}else n==3?e.type=t.readVarint():n==4&&(e.geometry=t.pos)}function qc(n,e,t){n.pos=e.features[t];const i=n.readVarint()+n.pos,r={layer:e,type:0,properties:{}};return n.readFields($c,r,i),r}function Vc(n,e){let t;return n===1?t=e===1?"Point":"MultiPoint":n===2?t=e===1?"LineString":"MultiLineString":n===3&&(t="Polygon"),t}function br(n){return Array.isArray(n)?Math.min(...n):n}class Xc extends Ar{constructor(e,t,i,r,s,o,a){let l=e.getExtent();l&&e.canWrapX()&&(l=l.slice(),l[0]=-1/0,l[2]=1/0);let u=t.getExtent();u&&t.canWrapX()&&(u=u.slice(),u[0]=-1/0,u[2]=1/0);const c=u?Fn(i,u):i,h=Ii(c),d=ql(e,t,h,r),f=Ul,p=new Vl(e,t,c,l,d*f,r),m=p.calculateSourceExtent(),g=Fo(m)?null:o(m,d,s),y=g?re.IDLE:re.EMPTY,x=g?g.getPixelRatio():1;super(i,r,x,y),this.targetProj_=t,this.maxSourceExtent_=l,this.triangulation_=p,this.targetResolution_=r,this.targetExtent_=i,this.sourceImage_=g,this.sourcePixelRatio_=x,this.interpolate_=a,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==re.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const e=this.sourceImage_.getState();if(e==re.LOADED){const t=Ye(this.targetExtent_)/this.targetResolution_,i=wt(this.targetExtent_)/this.targetResolution_;this.canvas_=Xl(t,i,this.sourcePixelRatio_,br(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=e,this.changed()}load(){if(this.state==re.IDLE){this.state=re.LOADING,this.changed();const e=this.sourceImage_.getState();e==re.LOADED||e==re.ERROR?this.reproject_():(this.sourceListenerKey_=xi(this.sourceImage_,vt.CHANGE,function(t){const i=this.sourceImage_.getState();(i==re.LOADED||i==re.ERROR)&&(this.unlistenSource_(),this.reproject_())},this),this.sourceImage_.load())}}unlistenSource_(){yi(this.sourceListenerKey_),this.sourceListenerKey_=null}}const Bi=4,$n={IMAGELOADSTART:"imageloadstart",IMAGELOADEND:"imageloadend",IMAGELOADERROR:"imageloaderror"};class Uc extends Pr{constructor(e,t){super(e),this.image=t}}class Jo extends Ri{constructor(e){super({attributions:e.attributions,projection:e.projection,state:e.state,interpolate:e.interpolate!==void 0?e.interpolate:!0}),this.on,this.once,this.un,this.loader=e.loader||null,this.resolutions_=e.resolutions!==void 0?e.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=e.loader?e.loader.length===0:!1,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(e){this.resolutions_=e}findNearestResolution(e){const t=this.getResolutions();if(t){const i=Yl(t,e,0);e=t[i]}return e}getImage(e,t,i,r){const s=this.getProjection();if(!s||!r||en(s,r))return s&&(r=s),this.getImageInternal(e,t,i,r);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&en(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==t&&ni(this.reprojectedImage_.getExtent(),e))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new Xc(s,r,e,t,i,(o,a,l)=>this.getImageInternal(o,a,l,s),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(e,t,i,r){if(this.loader){const s=Yc(e,t,i,1),o=this.findNearestResolution(t);if(this.image&&(this.static_||this.wantedProjection_===r&&(this.wantedExtent_&&st(this.wantedExtent_,s)||st(this.image.getExtent(),s))&&(this.wantedResolution_&&br(this.wantedResolution_)===o||br(this.image.getResolution())===o)))return this.image;this.wantedProjection_=r,this.wantedExtent_=s,this.wantedResolution_=o,this.image=new Ar(s,o,i,this.loader),this.image.addEventListener(vt.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(e){const t=e.target;let i;switch(t.getState()){case re.LOADING:this.loading=!0,i=$n.IMAGELOADSTART;break;case re.LOADED:this.loading=!1,i=$n.IMAGELOADEND;break;case re.ERROR:this.loading=!1,i=$n.IMAGELOADERROR;break;default:return}this.hasListener(i)&&this.dispatchEvent(new Uc(i,t))}}function Yc(n,e,t,i){const r=e/t,s=Ii(n),o=Ai(Ye(n)/r,Bi),a=Ai(wt(n)/r,Bi),l=Ai((i-1)*o/2,Bi),u=o+2*l,c=Ai((i-1)*a/2,Bi),h=a+2*c;return Hl(s,r,0,[u,h])}let Ko=!0;try{new ImageData(10,10)}catch{Ko=!1}let qn;function Hc(n,e,t){if(Ko)return new ImageData(n,e,t);qn||(qn=document.createElement("canvas").getContext("2d"));const i=qn.createImageData(e,t);return i.data.set(n),i}function Qo(n){let e=!0;try{new ImageData(10,10)}catch{e=!1}function t(i,r,s){return e?new ImageData(i,r,s):{data:i,width:r,height:s}}return function(i){const r=i.buffers,s=i.meta,o=i.imageOps,a=i.width,l=i.height,u=r.length,c=r[0].byteLength;if(o){const p=new Array(u);for(let g=0;g<u;++g)p[g]=t(new Uint8ClampedArray(r[g]),a,l);return n(p,s).data.buffer}const h=new Uint8ClampedArray(c),d=new Array(u),f=new Array(u);for(let p=0;p<u;++p)d[p]=new Uint8ClampedArray(r[p]),f[p]=[0,0,0,0];for(let p=0;p<c;p+=4){for(let g=0;g<u;++g){const y=d[g];f[g][0]=y[p],f[g][1]=y[p+1],f[g][2]=y[p+2],f[g][3]=y[p+3]}const m=n(f,s);h[p]=m[0],h[p+1]=m[1],h[p+2]=m[2],h[p+3]=m[3]}return h.buffer}}function Zc(n,e){const i=Object.keys(n.lib||{}).map(function(s){return"const "+s+" = "+n.lib[s].toString()+";"}).concat(["const __minion__ = ("+Qo.toString()+")(",n.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),r=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(i.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(i,{type:"text/javascript"})));return r.addEventListener("message",e),r}function Jc(n,e){const t=Qo(n.operation);let i=!1;return{postMessage:function(r){setTimeout(function(){i||e({data:{buffer:t(r),meta:r.meta}})},0)},terminate:function(){i=!0}}}class Kc extends Kl{constructor(e){super(),this._imageOps=!!e.imageOps;let t;e.threads===0?t=0:this._imageOps?t=1:t=e.threads||1;const i=new Array(t);if(t)for(let r=0;r<t;++r)i[r]=Zc(e,this._onWorkerMessage.bind(this,r));else i[0]=Jc(e,this._onWorkerMessage.bind(this,0));this._workers=i,this._queue=[],this._maxQueueLength=e.queue||1/0,this._running=0,this._dataLookup={},this._job=null}process(e,t,i){this._enqueue({inputs:e,meta:t,callback:i}),this._dispatch()}_enqueue(e){for(this._queue.push(e);this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)}_dispatch(){if(this._running||this._queue.length===0)return;const e=this._queue.shift();this._job=e;const t=e.inputs[0].width,i=e.inputs[0].height,r=e.inputs.map(function(l){return l.data.buffer}),s=this._workers.length;if(this._running=s,s===1){this._workers[0].postMessage({buffers:r,meta:e.meta,imageOps:this._imageOps,width:t,height:i},r);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let l=0;l<s;++l){const u=l*a,c=[];for(let h=0,d=r.length;h<d;++h)c.push(r[h].slice(u,u+a));this._workers[l].postMessage({buffers:c,meta:e.meta,imageOps:this._imageOps,width:t,height:i},c)}}_onWorkerMessage(e,t){this.disposed||(this._dataLookup[e]=t.data,--this._running,this._running===0&&this._resolveJob())}_resolveJob(){const e=this._job,t=this._workers.length;let i,r;if(t===1)i=new Uint8ClampedArray(this._dataLookup[0].buffer),r=this._dataLookup[0].meta;else{const s=e.inputs[0].data.length;i=new Uint8ClampedArray(s),r=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const l=this._dataLookup[a].buffer,u=a*o;i.set(new Uint8ClampedArray(l),u),r[a]=this._dataLookup[a].meta}}this._job=null,this._dataLookup={},e.callback(null,Hc(i,e.inputs[0].width,e.inputs[0].height),r),this._dispatch()}disposeInternal(){for(let e=0;e<this._workers.length;++e)this._workers[e].terminate();this._workers.length=0}}const As={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class Ds extends Pr{constructor(e,t,i){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=i}}class ea extends Jo{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=th(e.sources);const t=this.changed.bind(this);for(let i=0,r=this.layers_.length;i<r;++i)this.layers_[i].addEventListener(vt.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new Zl(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Ct(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:eh(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Ct(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:Y(this),renderTargets:{}},this.setAttributions(function(i){const r=[];for(let s=0,o=e.sources.length;s<o;++s){const a=e.sources[s],l=a instanceof Ri?a:a.getSource();if(!l)continue;const u=l.getAttributions();if(typeof u=="function"){const c=u(i);r.push.apply(r,c)}}return r.length!==0?r:null}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new Kc({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,i){const r=Object.assign({},this.frameState_);r.viewState=Object.assign({},r.viewState);const s=Ii(e);r.size[0]=Math.ceil(Ye(e)/t),r.size[1]=Math.ceil(wt(e)/t),r.extent=[s[0]-r.size[0]*t/2,s[1]-r.size[1]*t/2,s[0]+r.size[0]*t/2,s[1]+r.size[1]*t/2],r.time=Date.now();const o=r.viewState;return o.center=s,o.projection=i,o.resolution=t,r}allSourcesReady_(){let e=!0,t;for(let i=0,r=this.layers_.length;i<r;++i)if(t=this.layers_[i].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,i,r){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,r);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!ni(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,i=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=Qc(this.layers_[s],e);if(o)i[s]=o;else return}const r={};this.dispatchEvent(new Ds(As.BEFOREOPERATIONS,e,r)),this.processor_.process(i,r,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,i,r){if(t||!i)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!ni(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const l=Math.round(Ye(s)/o),u=Math.round(wt(s)/o);a=St(l,u),this.renderedImageCanvas_=new mc(s,o,1,a.canvas)}a.putImageData(i,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new Ds(As.AFTEROPERATIONS,e,r))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let i=0,r=this.layers_.length;i<r&&(t=this.layers_[i].getSource().getResolutions(e),!t);++i);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}ea.prototype.dispose;let At=null;function Qc(n,e){const t=n.getRenderer();if(!t)throw new Error("Unsupported layer type: "+n);if(!t.prepareFrame(e))return null;const i=e.size[0],r=e.size[1];if(i===0||r===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===i&&o.height===r)return o.getContext("2d").getImageData(0,0,i,r)}if(!At)At=St(i,r,void 0,{willReadFrequently:!0});else{const a=At.canvas;a.width!==i||a.height!==r?At=St(i,r,void 0,{willReadFrequently:!0}):At.clearRect(0,0,i,r)}return At.drawImage(o,0,0,i,r),At.getImageData(0,0,i,r)}function eh(n){return n.map(function(e){return e.getLayerState()})}function th(n){const e=n.length,t=new Array(e);for(let i=0;i<e;++i)t[i]=ih(n[i]);return t}function ih(n){let e;return n instanceof Ri?n instanceof Jl?e=new ko({source:n}):n instanceof Jo&&(e=new Ho({source:n})):e=n,e}function nh(n,e,t,i){const r=document.createElement("script"),s="olc_"+Y(e);function o(){delete window[s],r.parentNode.removeChild(r)}r.async=!0,r.src=n+(n.includes("?")?"&":"?")+(i||"callback")+"="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(l){clearTimeout(a),o(),e(l)},document.head.appendChild(r)}class rh extends Ql{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:me("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)nh(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let i;try{i=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=me("EPSG:4326"),i=this.getProjection();let r;if(e.bounds!==void 0){const u=Lr(t,i);r=eu(e.bounds,u)}const s=Mo(i),o=e.minzoom||0,a=e.maxzoom||22,l=Dr({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=l,this.tileUrlFunction=tu(e.tiles,l),e.attribution&&!this.getAttributions()){const u=r!==void 0?r:s;this.setAttributions(function(c){return be(u,c.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}const ta=rh,sh={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},Os={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};class oh extends iu{constructor(e){super(e),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=Ct(),this.tileClipContexts_=null}prepareTile(e,t,i){let r;const s=e.getState();return(s===Q.LOADED||s===Q.ERROR)&&(this.updateExecutorGroup_(e,t,i),this.tileImageNeedsRender_(e)&&(r=!0)),r}getTile(e,t,i,r){const s=r.pixelRatio,o=r.viewState,a=o.resolution,l=o.projection,u=this.getLayer(),c=u.getSource().getTile(e,t,i,s,l),h=r.viewHints,d=!(h[We.ANIMATING]||h[We.INTERACTING]);return(d||!c.wantedResolution)&&(c.wantedResolution=a),this.prepareTile(c,s,l)&&(d||Date.now()-r.time<8)&&u.getRenderMode()!=="vector"&&this.renderTileImage_(c,r),super.getTile(e,t,i,r)}isDrawableTile(e){const t=this.getLayer();return super.isDrawableTile(e)&&(t.getRenderMode()==="vector"?Y(t)in e.executorGroups:e.hasContext(t))}getTileImage(e){return e.getImage(this.getLayer())}prepareFrame(e){const t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,i){var g;const r=this.getLayer(),s=r.getRevision(),o=r.getRenderOrder()||null,a=e.wantedResolution,l=e.getReplayState(r);if(!l.dirty&&l.renderedResolution===a&&l.renderedRevision==s&&l.renderedRenderOrder==o)return;const u=r.getSource(),c=!!r.getDeclutter(),h=u.getTileGrid(),f=u.getTileGridForProjection(i).getTileCoordExtent(e.wrappedTileCoord),p=u.getSourceTiles(t,i,e),m=Y(r);delete e.hitDetectionImageData[m],e.executorGroups[m]=[],l.dirty=!1;for(let y=0,x=p.length;y<x;++y){const _=p[y];if(_.getState()!=Q.LOADED)continue;const v=_.tileCoord,b=h.getTileCoordExtent(v),E=Fn(f,b),T=_t(E,r.getRenderBuffer()*a,this.tmpExtent),I=ni(b,E)?null:T,L=new No(0,E,a,t),D=xr(a,t),F=function(k,G){let N;const ee=k.getStyleFunction()||r.getStyleFunction();if(ee&&(N=ee(k,a)),N){const S=this.renderFeature(k,D,N,L,c,G);l.dirty=l.dirty||S}},C=_.getFeatures();o&&o!==l.renderedRenderOrder&&C.sort(o);for(let k=0,G=C.length;k<G;++k){const N=C[k];(!I||be(I,N.getGeometry().getExtent()))&&F.call(this,N,k)}const O=L.finish(),R=r.getRenderMode()!=="vector"&&c&&p.length===1?null:E,w=new Wo(R,a,t,u.getOverlaps(),O,r.getRenderBuffer(),!!((g=this.frameState)!=null&&g.declutter));e.executorGroups[m].push(w)}l.renderedRevision=s,l.renderedRenderOrder=o,l.renderedResolution=a}forEachFeatureAtCoordinate(e,t,i,r,s){const o=t.viewState.resolution,a=t.viewState.rotation;i=i??0;const l=this.getLayer(),c=l.getSource().getTileGridForProjection(t.viewState.projection),h=nu([e]);_t(h,o*i,h);const d={},f=function(g,y,x){let _=g.getId();_===void 0&&(_=Y(g));const v=d[_];if(v){if(v!==!0&&x<v.distanceSq){if(x===0)return d[_]=!0,s.splice(s.lastIndexOf(v),1),r(g,l,y);v.geometry=y,v.distanceSq=x}}else{if(x===0)return d[_]=!0,r(g,l,y);s.push(d[_]={feature:g,layer:l,geometry:y,distanceSq:x,callback:r})}},p=this.renderedTiles;let m;for(let g=0,y=p.length;!m&&g<y;++g){const x=p[g],_=c.getTileCoordExtent(x.wrappedTileCoord);if(!be(_,h))continue;const v=Y(l),b=[x.executorGroups[v]],E=l.getDeclutter();b.some(T=>{const I=E?t.declutter[E].all().map(L=>L.value):null;for(let L=0,D=T.length;L<D;++L)if(m=T[L].forEachFeatureAtCoordinate(e,o,a,i,f,I),m)return!0})}return m}getFeatures(e){return new Promise((t,i)=>{const r=this.getLayer(),s=Y(r),o=r.getSource(),a=this.renderedProjection,l=a.getExtent(),u=this.renderedResolution,c=o.getTileGridForProjection(a),h=gt(this.renderedPixelToCoordinateTransform_,e.slice()),d=c.getTileCoordForCoordAndResolution(h,u);let f;for(let _=0,v=this.renderedTiles.length;_<v;++_)if(d.toString()===this.renderedTiles[_].tileCoord.toString()){if(f=this.renderedTiles[_],f.getState()===Q.LOADED){const b=c.getTileCoordExtent(f.tileCoord);o.getWrapX()&&a.canWrapX()&&!st(l,b)&&So(h,a);break}f=void 0}if(!f||f.loadingSourceTiles>0){t([]);return}const p=c.getTileCoordExtent(f.wrappedTileCoord),m=Lo(p),g=[(h[0]-m[0])/u,(m[1]-h[1])/u],y=f.getSourceTiles().reduce(function(_,v){return _.concat(v.getFeatures())},[]);let x=f.hitDetectionImageData[s];if(!x){const _=Po(c.getTileSize(c.getZForResolution(u,o.zDirection))),v=this.renderedRotation_,b=[this.getRenderTransform(c.getTileCoordCenter(f.wrappedTileCoord),u,0,Pe,_[0]*Pe,_[1]*Pe,0)];x=Bo(_,b,y,r.getStyleFunction(),c.getTileCoordExtent(f.wrappedTileCoord),f.getReplayState(r).renderedResolution,v),f.hitDetectionImageData[s]=x}t($o(g,y,x))})}handleFontsChanged(){const e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){const i=this.context,r=i.globalAlpha;i.globalAlpha=t.opacity;const s=e.viewHints,o=!(s[We.ANIMATING]||s[We.INTERACTING]),a=this.renderedTiles;for(let l=0,u=a.length;l<u;++l){const c=a[l],h=c.executorGroups[Y(this.getLayer())],d=this.getLayer().getDeclutter();if(h)for(let f=h.length-1;f>=0;--f)h[f].execute(this.context,[this.context.canvas.width,this.context.canvas.height],this.getTileRenderTransform(c,e),e.viewState.rotation,o,gn,d?e.declutter[d]:void 0)}i.globalAlpha=r}renderDeferredInternal(e){const i=this.renderedTiles.reduce((o,a,l)=>(a.executorGroups[Y(this.getLayer())].forEach(u=>o.push({executorGroup:u,index:l})),o),[]),r=i.map(({executorGroup:o})=>o.getDeferredZIndexContexts());r.map(o=>Object.keys(o)).flat().sort(un).map(Number).forEach(o=>{r.forEach((a,l)=>{a[o]&&a[o].forEach(u=>{const{executorGroup:c,index:h}=i[l],d=c.getRenderedContext(),f=d.globalAlpha;d.globalAlpha=this.renderedOpacity_;const p=this.tileClipContexts_[h];p&&p.draw(d),u.draw(d),p&&d.restore(),d.globalAlpha=f,u.clear()})})})}getTileRenderTransform(e,t){const i=t.pixelRatio,r=t.viewState,s=r.center,o=r.resolution,a=r.rotation,l=t.size,u=Math.round(l[0]*i),c=Math.round(l[1]*i),d=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),f=e.tileCoord,p=d.getTileCoordExtent(e.wrappedTileCoord),m=d.getTileCoordExtent(f,this.tmpExtent)[0]-p[0];return ru(jn(this.inversePixelTransform.slice(),1/i,1/i),this.getRenderTransform(s,o,a,i,u,c,m))}postRender(e,t){const i=t.viewHints,r=!(i[We.ANIMATING]||i[We.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;const s=this.getLayer(),o=s.getRenderMode(),a=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;const l=s.getDeclutter(),u=l?Os[o].filter(v=>!gn.includes(v)):Os[o],c=t.viewState,h=c.rotation,d=s.getSource(),p=d.getTileGridForProjection(c.projection).getZForResolution(c.resolution,d.zDirection),m=this.renderedTiles,g=[],y=[],x=[];let _=!0;for(let v=m.length-1;v>=0;--v){const b=m[v];_=_&&!b.getReplayState(s).dirty;const E=b.executorGroups[Y(s)].filter(O=>O.hasExecutors(u));if(E.length===0)continue;const T=this.getTileRenderTransform(b,t),I=b.tileCoord[0];let L=!1;const D=E[0].getClipCoords(T);let F=e,C;if(D){l&&(C=new _o,F=C.getContext());for(let O=0,R=g.length;O<R;++O)if(p!==I&&I<y[O]){const w=g[O];be([D[0],D[3],D[4],D[7]],[w[0],w[3],w[4],w[7]])&&(L||(F.save(),L=!0),F.beginPath(),F.moveTo(D[0],D[1]),F.lineTo(D[2],D[3]),F.lineTo(D[4],D[5]),F.lineTo(D[6],D[7]),F.moveTo(w[6],w[7]),F.lineTo(w[4],w[5]),F.lineTo(w[2],w[3]),F.lineTo(w[0],w[1]),F.clip())}g.push(D),y.push(I)}for(let O=0,R=E.length;O<R;++O)E[O].execute(e,[e.canvas.width,e.canvas.height],T,h,r,u);L&&(F===e?F.restore():x[v]=C)}e.globalAlpha=a,this.ready=_,this.tileClipContexts_=x,super.postRender(e,t)}renderFeature(e,t,i,r,s,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,u=i.length;l<u;++l)a=mn(r,e,i[l],t,this.boundHandleStyleImageChange_,void 0,s,o)||a;else a=mn(r,e,i,t,this.boundHandleStyleImageChange_,void 0,s,o);return a}tileImageNeedsRender_(e){const t=this.getLayer();if(t.getRenderMode()==="vector")return!1;const i=e.getReplayState(t),r=t.getRevision(),s=e.wantedResolution;return i.renderedTileResolution!==s||i.renderedTileRevision!==r}renderTileImage_(e,t){const i=this.getLayer(),r=e.getReplayState(i),s=i.getRevision(),o=e.executorGroups[Y(i)];r.renderedTileRevision=s;const a=e.wrappedTileCoord,l=a[0],u=i.getSource();let c=t.pixelRatio;const d=t.viewState.projection,f=u.getTileGridForProjection(d),p=f.getResolution(e.tileCoord[0]),m=t.pixelRatio/e.wantedResolution*p,g=f.getResolution(l),y=e.getContext(i);c=Math.round(Math.max(c,m/c));const x=u.getTilePixelSize(l,c,d);y.canvas.width=x[0],y.canvas.height=x[1];const _=c/m;if(_!==1){const T=vs(this.tmpTransform_);jn(T,_,_),y.setTransform.apply(y,T)}const v=f.getTileCoordExtent(a,this.tmpExtent),b=m/g,E=vs(this.tmpTransform_);jn(E,b,-b),su(E,-v[0],-v[3]);for(let T=0,I=o.length;T<I;++T)o[T].execute(y,[y.canvas.width*_,y.canvas.height*_],E,0,!0,sh[i.getRenderMode()],null);r.renderedTileResolution=e.wantedResolution}}class fi extends To{constructor(e){e=e||{};const t=Object.assign({},e);delete t.preload,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un;const i=e.renderMode||"hybrid";hi(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new oh(this)}getFeatures(e){return super.getFeatures(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(Di.PRELOAD)}getUseInterimTilesOnError(){return this.get(Di.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(Di.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(Di.USE_INTERIM_TILES_ON_ERROR,e)}}class ia extends ou{constructor(e){const t=e.projection||"EPSG:3857",i=e.extent||Mo(t),r=e.tileGrid||Dr({extent:i,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,opaque:!1,projection:t,state:e.state,tileGrid:r,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:na,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.sourceTileCache=new au(this.tileCache.highWaterMark),this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:Yo,this.tileGrids_={}}getFeaturesInExtent(e){const t=[],i=this.tileCache;if(i.getCount()===0)return t;const r=lu(i.peekFirstKey())[0],s=this.tileGrid;return i.forEach(function(o){if(o.tileCoord[0]!==r||o.getState()!==Q.LOADED)return;const a=o.getSourceTiles();for(let l=0,u=a.length;l<u;++l){const c=a[l],h=c.tileCoord;if(be(e,s.getTileCoordExtent(h))){const d=c.getFeatures();if(d)for(let f=0,p=d.length;f<p;++f){const m=d[f],g=m.getGeometry();be(e,g.getExtent())&&t.push(m)}}}}),t}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(e,t){const i=this.getTileCacheForProjection(e),r=Object.keys(t).reduce((s,o)=>{const a=uu(o),l=i.peek(a);if(l){const u=l.sourceTiles;for(let c=0,h=u.length;c<h;++c)s[u[c].getKey()]=!0}return s},{});super.expireCache(e,t),this.sourceTileCache.expireCache(r)}getSourceTiles(e,t,i){if(i.getState()===Q.IDLE){i.setState(Q.LOADING);const r=i.wrappedTileCoord,s=this.getTileGridForProjection(t),o=s.getTileCoordExtent(r),a=r[0],l=s.getResolution(a);_t(o,-l,o);const u=this.tileGrid,c=u.getExtent();c&&Fn(o,c,o);const h=u.getZForResolution(l,this.zDirection);u.forEachTileCoord(o,h,d=>{const f=this.tileUrlFunction(d,e,t),p=this.sourceTileCache.containsKey(f)?this.sourceTileCache.get(f):new this.tileClass(d,f?Q.IDLE:Q.EMPTY,f,this.format_,this.tileLoadFunction);i.sourceTiles.push(p);const m=p.getState();if(m<Q.LOADED){const g=y=>{this.handleTileChange(y);const x=p.getState();if(x===Q.LOADED||x===Q.ERROR){const _=p.getKey();_ in i.errorTileKeys?p.getState()===Q.LOADED&&delete i.errorTileKeys[_]:i.loadingSourceTiles--,x===Q.ERROR?i.errorTileKeys[_]=!0:p.removeEventListener(vt.CHANGE,g),i.loadingSourceTiles===0&&i.setState(ii(i.errorTileKeys)?Q.LOADED:Q.ERROR)}};p.addEventListener(vt.CHANGE,g),i.loadingSourceTiles++}m===Q.IDLE&&(p.extent=u.getTileCoordExtent(d),p.projection=t,p.resolution=u.getResolution(d[0]),this.sourceTileCache.set(f,p),p.load())}),i.loadingSourceTiles||i.setState(i.sourceTiles.some(d=>d.getState()===Q.ERROR)?Q.ERROR:Q.LOADED)}return i.sourceTiles}getTile(e,t,i,r,s){const o=cu(e,t,i),a=this.getKey();let l;if(this.tileCache.containsKey(o)&&(l=this.tileCache.get(o),l.key===a))return l;const u=[e,t,i];let c=this.getTileCoordForTileUrlFunction(u,s);const h=this.getTileGrid().getExtent(),d=this.getTileGridForProjection(s);if(c&&h){const m=d.getTileCoordExtent(c);_t(m,-d.getResolution(e),m),be(h,m)||(c=null)}let f=!0;if(c!==null){const m=this.tileGrid,g=d.getResolution(e),y=m.getZForResolution(g,1),x=d.getTileCoordExtent(c);_t(x,-g,x),m.forEachTileCoord(x,y,_=>{f=f&&!this.tileUrlFunction(_,r,s)})}const p=new yc(u,f?Q.EMPTY:Q.IDLE,c,this.getSourceTiles.bind(this,r,s));return p.key=a,l?(p.interimTile=l,p.refreshInterimChain(),this.tileCache.replace(o,p)):this.tileCache.set(o,p),p}getTileGridForProjection(e){const t=e.getCode();let i=this.tileGrids_[t];if(!i){const r=this.tileGrid,s=r.getResolutions().slice(),o=s.map(function(u,c){return r.getOrigin(c)}),a=s.map(function(u,c){return r.getTileSize(c)}),l=hu+1;for(let u=s.length;u<l;++u)s.push(s[u-1]/2),o.push(o[u-1]),a.push(a[u-1]);i=new Or({extent:r.getExtent(),origins:o,resolutions:s,tileSizes:a}),this.tileGrids_[t]=i}return i}getTilePixelRatio(e){return e}getTilePixelSize(e,t,i){const r=this.getTileGridForProjection(i),s=Po(r.getTileSize(e),this.tmpSize);return[Math.round(s[0]*t),Math.round(s[1]*t)]}updateCacheSize(e,t){super.updateCacheSize(e*2,t),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(t).highWaterMark}}function na(n,e){n.setLoader(function(t,i,r){Uo(e,n.getFormat(),t,i,r,n.onLoad.bind(n),n.onError.bind(n))})}function ra(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ah={},sa,zs={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function pi(n){return n=Math.round(n),n<0?0:n>255?255:n}function Gs(n){return n<0?0:n>1?1:n}function Vn(n){return n[n.length-1]==="%"?pi(parseFloat(n)/100*255):pi(parseInt(n))}function $i(n){return n[n.length-1]==="%"?Gs(parseFloat(n)/100):Gs(parseFloat(n))}function Xn(n,e,t){return t<0?t+=1:t>1&&(t-=1),t*6<1?n+(e-n)*t*6:t*2<1?e:t*3<2?n+(e-n)*(2/3-t)*6:n}function lh(n){var e=n.replace(/ /g,"").toLowerCase();if(e in zs)return zs[e].slice();if(e[0]==="#"){if(e.length===4){var t=parseInt(e.substr(1),16);return t>=0&&t<=4095?[(t&3840)>>4|(t&3840)>>8,t&240|(t&240)>>4,t&15|(t&15)<<4,1]:null}else if(e.length===7){var t=parseInt(e.substr(1),16);return t>=0&&t<=16777215?[(t&16711680)>>16,(t&65280)>>8,t&255,1]:null}return null}var i=e.indexOf("("),r=e.indexOf(")");if(i!==-1&&r+1===e.length){var s=e.substr(0,i),o=e.substr(i+1,r-(i+1)).split(","),a=1;switch(s){case"rgba":if(o.length!==4)return null;a=$i(o.pop());case"rgb":return o.length!==3?null:[Vn(o[0]),Vn(o[1]),Vn(o[2]),a];case"hsla":if(o.length!==4)return null;a=$i(o.pop());case"hsl":if(o.length!==3)return null;var l=(parseFloat(o[0])%360+360)%360/360,u=$i(o[1]),c=$i(o[2]),h=c<=.5?c*(u+1):c+u-c*u,d=c*2-h;return[pi(Xn(d,h,l+1/3)*255),pi(Xn(d,h,l)*255),pi(Xn(d,h,l-1/3)*255),a];default:return null}}return null}try{sa=ah.parseCSSColor=lh}catch{}class Me{constructor(e,t,i,r=1){this.r=e,this.g=t,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof Me)return e;if(typeof e!="string")return;const t=sa(e);if(t)return new Me(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}toString(){const[e,t,i,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(i)},${r})`}toArray(){const{r:e,g:t,b:i,a:r}=this;return r===0?[0,0,0,0]:[e*255/r,t*255/r,i*255/r,r]}toArray01(){const{r:e,g:t,b:i,a:r}=this;return r===0?[0,0,0,0]:[e/r,t/r,i/r,r]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:i,a:r}=this;return[e,t,i,r]}}Me.black=new Me(0,0,0,1);Me.white=new Me(1,1,1,1);Me.transparent=new Me(0,0,0,0);Me.red=new Me(1,0,0,1);Me.blue=new Me(0,0,1,1);var De=Me;function Ci(n){return typeof n=="object"?["literal",n]:n}function uh(n,e){let t=n.stops;if(!t)return ch(n,e);const i=t&&typeof t[0][0]=="object",r=i||n.property!==void 0,s=i||!r;return t=t.map(o=>!r&&e.tokens&&typeof o[1]=="string"?[o[0],ph(o[1])]:[o[0],Ci(o[1])]),i?hh(n,e,t):s?fh(n,e,t):vr(n,e,t)}function ch(n,e){const t=["get",n.property];if(n.default===void 0)return e.type==="string"?["string",t]:t;if(e.type==="enum")return["match",t,Object.keys(e.values),t,n.default];{const i=[e.type==="color"?"to-color":e.type,t,Ci(n.default)];return e.type==="array"&&i.splice(1,0,e.value,e.length||null),i}}function Wr(n){switch(n.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function hh(n,e,t){const i={},r={},s=[];for(let a=0;a<t.length;a++){const l=t[a],u=l[0].zoom;i[u]===void 0&&(i[u]={zoom:u,type:n.type,property:n.property,default:n.default},r[u]=[],s.push(u)),r[u].push([l[0].value,l[1]])}if($r({},e)==="exponential"){const a=[Wr(n),["linear"],["zoom"]];for(const l of s){const u=vr(i[l],e,r[l]);Jt(a,l,u,!1)}return a}else{const a=["step",["zoom"]];for(const l of s){const u=vr(i[l],e,r[l]);Jt(a,l,u,!0)}return Br(a),a}}function dh(n,e){if(n!==void 0)return n;if(e!==void 0)return e}function js(n,e){const t=Ci(dh(n.default,e.default));return t===void 0&&e.type==="resolvedImage"?"":t}function vr(n,e,t){const i=$r(n,e),r=["get",n.property];if(i==="categorical"&&typeof t[0][0]=="boolean"){const s=["case"];for(const o of t)s.push(["==",r,o[0]],o[1]);return s.push(js(n,e)),s}else if(i==="categorical"){const s=["match",r];for(const o of t)Jt(s,o[0],o[1],!1);return s.push(js(n,e)),s}else if(i==="interval"){const s=["step",["number",r]];for(const o of t)Jt(s,o[0],o[1],!0);return Br(s),n.default===void 0?s:["case",["==",["typeof",r],"number"],s,Ci(n.default)]}else if(i==="exponential"){const s=n.base!==void 0?n.base:1,o=[Wr(n),s===1?["linear"]:["exponential",s],["number",r]];for(const a of t)Jt(o,a[0],a[1],!1);return n.default===void 0?o:["case",["==",["typeof",r],"number"],o,Ci(n.default)]}else throw new Error(`Unknown property function type ${i}`)}function fh(n,e,t,i=["zoom"]){const r=$r(n,e);let s,o=!1;if(r==="interval")s=["step",i],o=!0;else if(r==="exponential"){const a=n.base!==void 0?n.base:1;s=[Wr(n),a===1?["linear"]:["exponential",a],i]}else throw new Error(`Unknown zoom function type "${r}"`);for(const a of t)Jt(s,a[0],a[1],o);return Br(s),s}function Br(n){n[0]==="step"&&n.length===3&&(n.push(0),n.push(n[3]))}function Jt(n,e,t,i){n.length>3&&e===n[n.length-2]||(i&&n.length===2||n.push(e),n.push(t))}function $r(n,e){return n.type?n.type:e.expression.interpolated?"exponential":"interval"}function ph(n){const e=["concat"],t=/{([^{}]+)}/g;let i=0;for(let r=t.exec(n);r!==null;r=t.exec(n)){const s=n.slice(i,t.lastIndex-r[0].length);i=t.lastIndex,s.length>0&&e.push(s),e.push(["get",r[1]])}if(e.length===1)return n;if(i<n.length)e.push(n.slice(i));else if(e.length===2)return["to-string",e[1]];return e}class gh extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var Ue=gh;class qr{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[i,r]of t)this.bindings[i]=r}concat(e){return new qr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return this.bindings[e]?!0:this.parent?this.parent.has(e):!1}}var mh=qr;const Ln={kind:"null"},M={kind:"number"},$={kind:"string"},W={kind:"boolean"},ut={kind:"color"},Kt={kind:"object"},B={kind:"value"},yh={kind:"error"},Pn={kind:"collator"},An={kind:"formatted"},Mi={kind:"resolvedImage"};function Be(n,e){return{kind:"array",itemType:n,N:e}}function oe(n){if(n.kind==="array"){const e=oe(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}else return n.kind}const xh=[Ln,M,$,W,ut,An,Kt,Be(B),Mi];function Si(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Si(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const t of xh)if(!Si(t,e))return null}}return`Expected ${oe(n)} but found ${oe(e)} instead.`}function Vr(n,e){return e.some(t=>t.kind===n.kind)}function Ti(n,e){return e.some(t=>t==="null"?n===null:t==="array"?Array.isArray(n):t==="object"?n&&!Array.isArray(n)&&typeof n=="object":t===typeof n)}class Xr{constructor(e,t,i){e?this.sensitivity=t?"variant":"case":this.sensitivity=t?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wr{constructor(e,t,i,r,s){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=i,this.fontStack=r,this.textColor=s}}class He{constructor(e){this.sections=e}static fromString(e){return new He([new wr(e,null,null,null,null)])}isEmpty(){return this.sections.length===0?!0:!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof He?e:He.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const i={};t.fontStack&&(i["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(i["font-scale"]=t.scale),t.textColor&&(i["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(i)}return e}}class Et{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Et({name:e,available:!1}):null}serialize(){return["image",this.name]}}function oa(n,e,t,i){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255?typeof i>"u"||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[n,e,t,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[n,e,t,i]:[n,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function yn(n){if(n===null)return!0;if(typeof n=="string")return!0;if(typeof n=="boolean")return!0;if(typeof n=="number")return!0;if(n instanceof De)return!0;if(n instanceof Xr)return!0;if(n instanceof He)return!0;if(n instanceof Et)return!0;if(Array.isArray(n)){for(const e of n)if(!yn(e))return!1;return!0}else if(typeof n=="object"){for(const e in n)if(!yn(n[e]))return!1;return!0}else return!1}function ge(n){if(n===null)return Ln;if(typeof n=="string")return $;if(typeof n=="boolean")return W;if(typeof n=="number")return M;if(n instanceof De)return ut;if(n instanceof Xr)return Pn;if(n instanceof He)return An;if(n instanceof Et)return Mi;if(Array.isArray(n)){const e=n.length;let t;for(const i of n){const r=ge(i);if(!t)t=r;else{if(t===r)continue;t=B;break}}return Be(t||B,e)}else return Kt}function gi(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof De||n instanceof He||n instanceof Et?n.toString():JSON.stringify(n)}class Ur{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(e.length!==2)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!yn(e[1]))return t.error("invalid value");const i=e[1];let r=ge(i);const s=t.expectedType;return r.kind==="array"&&r.N===0&&s&&s.kind==="array"&&(typeof s.N!="number"||s.N===0)&&(r=s),new Ur(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof De?["rgba"].concat(this.value.toArray()):this.value instanceof He?this.value.serialize():this.value}}var xn=Ur;class _h{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}var ve=_h;const Un={string:$,number:M,boolean:W,object:Kt};class Yr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let i=1,r;const s=e[0];if(s==="array"){let a;if(e.length>2){const u=e[1];if(typeof u!="string"||!(u in Un)||u==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);a=Un[u],i++}else a=B;let l;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],i++}r=Be(a,l)}else r=Un[s];const o=[];for(;i<e.length;i++){const a=t.parse(e[i],i,B);if(!a)return null;o.push(a)}return new Yr(r,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const i=this.args[t].evaluate(e);if(Si(this.type,ge(i))){if(t===this.args.length-1)throw new ve(`Expected value to be of type ${oe(this.type)}, but found ${oe(ge(i))} instead.`)}else return i}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if(e.kind==="array"){const i=e.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){t.push(i.kind);const r=e.N;(typeof r=="number"||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map(i=>i.serialize()))}}var rt=Yr;class Dn{constructor(e){this.type=An,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&typeof i=="object")return t.error("First argument must be an image or text section.");const r=[];let s=!1;for(let o=1;o<=e.length-1;++o){const a=e[o];if(s&&typeof a=="object"&&!Array.isArray(a)){s=!1;let l=null;if(a["font-scale"]&&(l=t.parse(a["font-scale"],1,M),!l))return null;let u=null;if(a["text-font"]&&(u=t.parse(a["text-font"],1,Be($)),!u))return null;let c=null;if(a["text-color"]&&(c=t.parse(a["text-color"],1,ut),!c))return null;const h=r[r.length-1];h.scale=l,h.font=u,h.textColor=c}else{const l=t.parse(e[o],1,B);if(!l)return null;const u=l.type.kind;if(u!=="string"&&u!=="value"&&u!=="null"&&u!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,r.push({content:l,scale:null,font:null,textColor:null})}}return new Dn(r)}evaluate(e){const t=i=>{const r=i.content.evaluate(e);return ge(r)===Mi?new wr("",r,null,null,null):new wr(gi(r),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)};return new He(this.sections.map(t))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const i={};t.scale&&(i["font-scale"]=t.scale.serialize()),t.font&&(i["text-font"]=t.font.serialize()),t.textColor&&(i["text-color"]=t.textColor.serialize()),e.push(i)}return e}}class On{constructor(e){this.type=Mi,this.input=e}static parse(e,t){if(e.length!==2)return t.error("Expected two arguments.");const i=t.parse(e[1],1,$);return i?new On(i):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),i=Et.fromString(t);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(t)>-1),i}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const bh={"to-boolean":W,"to-color":ut,"to-number":M,"to-string":$};class Hr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const i=e[0];if((i==="to-boolean"||i==="to-string")&&e.length!==2)return t.error("Expected one argument.");const r=bh[i],s=[];for(let o=1;o<e.length;o++){const a=t.parse(e[o],o,B);if(!a)return null;s.push(a)}return new Hr(r,s)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let t,i;for(const r of this.args){if(t=r.evaluate(e),i=null,t instanceof De)return t;if(typeof t=="string"){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(t.length<3||t.length>4?i=`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:i=oa(t[0],t[1],t[2],t[3]),!i))return new De(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ve(i||`Could not parse color from value '${typeof t=="string"?t:String(JSON.stringify(t))}'`)}else if(this.type.kind==="number"){let t=null;for(const i of this.args){if(t=i.evaluate(e),t===null)return 0;const r=Number(t);if(!isNaN(r))return r}throw new ve(`Could not convert ${JSON.stringify(t)} to number.`)}else return this.type.kind==="formatted"?He.fromString(gi(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Et.fromString(gi(this.args[0].evaluate(e))):gi(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Dn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new On(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Yt=Hr;const vh=["Unknown","Point","LineString","Polygon"];class wh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:r}=this.featureTileCoord,s=i*t-e[0],o=r*t-e[1],a=this.featureDistanceData.bearing[0],l=this.featureDistanceData.bearing[1];return a*s+l*o}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=De.parse(e)),t}}var aa=wh;class Ht{constructor(e,t,i,r){this.name=e,this.type=t,this._evaluate=i,this.args=r}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const i=e[0],r=Ht.definitions[i];if(!r)return t.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,a=o.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,c]of a){l=new da(t.registry,t.path,null,t.scope);const h=[];let d=!1;for(let f=1;f<e.length;f++){const p=e[f],m=Array.isArray(u)?u[f-1]:u.type,g=l.parse(p,1+h.length,m);if(!g){d=!0;break}h.push(g)}if(!d){if(Array.isArray(u)&&u.length!==h.length){l.error(`Expected ${u.length} arguments, but found ${h.length} instead.`);continue}for(let f=0;f<h.length;f++){const p=Array.isArray(u)?u[f]:u.type,m=h[f];l.concat(f+1).checkSubtype(p,m.type)}if(l.errors.length===0)return new Ht(i,s,c,h)}}if(a.length===1)t.errors.push(...l.errors);else{const c=(a.length?a:o).map(([d])=>Ch(d)).join(" | "),h=[];for(let d=1;d<e.length;d++){const f=t.parse(e[d],1+h.length);if(!f)return null;h.push(oe(f.type))}t.error(`Expected arguments of type ${c}, but found (${h.join(", ")}) instead.`)}return null}static register(e,t){Ht.definitions=t;for(const i in t)e[i]=Ht}}function Ch(n){return Array.isArray(n)?`(${n.map(oe).join(", ")})`:`(${oe(n.type)}...)`}var oi=Ht;class zn{constructor(e,t,i){this.type=Pn,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(e.length!==2)return t.error("Expected one argument.");const i=e[1];if(typeof i!="object"||Array.isArray(i))return t.error("Collator options argument must be an object.");const r=t.parse(i["case-sensitive"]===void 0?!1:i["case-sensitive"],1,W);if(!r)return null;const s=t.parse(i["diacritic-sensitive"]===void 0?!1:i["diacritic-sensitive"],1,W);if(!s)return null;let o=null;return i.locale&&(o=t.parse(i.locale,1,$),!o)?null:new zn(r,s,o)}evaluate(e){return new Xr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const bt=8192;function Zr(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Sh(n){return(180+n)/360}function Th(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function _n(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Eh(n,e){const t=Sh(n[0]),i=Th(n[1]),r=Math.pow(2,e.z);return[Math.round(t*r*bt),Math.round(i*r*bt)]}function Ih(n,e,t){const i=n[0]-e[0],r=n[1]-e[1],s=n[0]-t[0],o=n[1]-t[1];return i*o-s*r===0&&i*s<=0&&r*o<=0}function Rh(n,e,t){return e[1]>n[1]!=t[1]>n[1]&&n[0]<(t[0]-e[0])*(n[1]-e[1])/(t[1]-e[1])+e[0]}function Jr(n,e){let t=!1;for(let i=0,r=e.length;i<r;i++){const s=e[i];for(let o=0,a=s.length;o<a-1;o++){if(Ih(n,s[o],s[o+1]))return!1;Rh(n,s[o],s[o+1])&&(t=!t)}}return t}function Fh(n,e){for(let t=0;t<e.length;t++)if(Jr(n,e[t]))return!0;return!1}function kh(n,e){return n[0]*e[1]-n[1]*e[0]}function Ns(n,e,t,i){const r=n[0]-t[0],s=n[1]-t[1],o=e[0]-t[0],a=e[1]-t[1],l=i[0]-t[0],u=i[1]-t[1],c=r*u-l*s,h=o*u-l*a;return c>0&&h<0||c<0&&h>0}function Mh(n,e,t,i){const r=[e[0]-n[0],e[1]-n[1]],s=[i[0]-t[0],i[1]-t[1]];return kh(s,r)===0?!1:!!(Ns(n,e,t,i)&&Ns(t,i,n,e))}function Lh(n,e,t){for(const i of t)for(let r=0;r<i.length-1;++r)if(Mh(n,e,i[r],i[r+1]))return!0;return!1}function la(n,e){for(let t=0;t<n.length;++t)if(!Jr(n[t],e))return!1;for(let t=0;t<n.length-1;++t)if(Lh(n[t],n[t+1],e))return!1;return!0}function Ph(n,e){for(let t=0;t<e.length;t++)if(la(n,e[t]))return!0;return!1}function Kr(n,e,t){const i=[];for(let r=0;r<n.length;r++){const s=[];for(let o=0;o<n[r].length;o++){const a=Eh(n[r][o],t);Zr(e,a),s.push(a)}i.push(s)}return i}function ua(n,e,t){const i=[];for(let r=0;r<n.length;r++){const s=Kr(n[r],e,t);i.push(s)}return i}function ca(n,e,t,i){if(n[0]<t[0]||n[0]>t[2]){const r=i*.5;let s=n[0]-t[0]>r?-i:t[0]-n[0]>r?i:0;s===0&&(s=n[0]-t[2]>r?-i:t[2]-n[0]>r?i:0),n[0]+=s}Zr(e,n)}function Ah(n){n[0]=n[1]=1/0,n[2]=n[3]=-1/0}function Ws(n,e,t,i){const r=Math.pow(2,i.z)*bt,s=[i.x*bt,i.y*bt],o=[];if(!n)return o;for(const a of n)for(const l of a){const u=[l.x+s[0],l.y+s[1]];ca(u,e,t,r),o.push(u)}return o}function Bs(n,e,t,i){const r=Math.pow(2,i.z)*bt,s=[i.x*bt,i.y*bt],o=[];if(!n)return o;for(const a of n){const l=[];for(const u of a){const c=[u.x+s[0],u.y+s[1]];Zr(e,c),l.push(c)}o.push(l)}if(e[2]-e[0]<=r/2){Ah(e);for(const a of o)for(const l of a)ca(l,e,t,r)}return o}function Dh(n,e){const t=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=n.canonicalID();if(!r)return!1;if(e.type==="Polygon"){const s=Kr(e.coordinates,i,r),o=Ws(n.geometry(),t,i,r);if(!_n(t,i))return!1;for(const a of o)if(!Jr(a,s))return!1}if(e.type==="MultiPolygon"){const s=ua(e.coordinates,i,r),o=Ws(n.geometry(),t,i,r);if(!_n(t,i))return!1;for(const a of o)if(!Fh(a,s))return!1}return!0}function Oh(n,e){const t=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=n.canonicalID();if(!r)return!1;if(e.type==="Polygon"){const s=Kr(e.coordinates,i,r),o=Bs(n.geometry(),t,i,r);if(!_n(t,i))return!1;for(const a of o)if(!la(a,s))return!1}if(e.type==="MultiPolygon"){const s=ua(e.coordinates,i,r),o=Bs(n.geometry(),t,i,r);if(!_n(t,i))return!1;for(const a of o)if(!Ph(a,s))return!1}return!0}class mi{constructor(e,t){this.type=W,this.geojson=e,this.geometries=t}static parse(e,t){if(e.length!==2)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(yn(e[1])){const i=e[1];if(i.type==="FeatureCollection")for(let r=0;r<i.features.length;++r){const s=i.features[r].geometry.type;if(s==="Polygon"||s==="MultiPolygon")return new mi(i,i.features[r].geometry)}else if(i.type==="Feature"){const r=i.geometry.type;if(r==="Polygon"||r==="MultiPolygon")return new mi(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new mi(i,i)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return Dh(e,this.geometries);if(e.geometryType()==="LineString")return Oh(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Qr=mi;function Gn(n){if(n instanceof oi){if(n.name==="get"&&n.args.length===1)return!1;if(n.name==="feature-state")return!1;if(n.name==="has"&&n.args.length===1)return!1;if(n.name==="properties"||n.name==="geometry-type"||n.name==="id")return!1;if(/^filter-/.test(n.name))return!1}if(n instanceof Qr)return!1;let e=!0;return n.eachChild(t=>{e&&!Gn(t)&&(e=!1)}),e}function es(n){if(n instanceof oi&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(t=>{e&&!es(t)&&(e=!1)}),e}function ts(n,e){if(n instanceof oi&&e.indexOf(n.name)>=0)return!1;let t=!0;return n.eachChild(i=>{t&&!ts(i,e)&&(t=!1)}),t}class is{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");const i=e[1];return t.scope.has(i)?new is(i,t.scope.get(i)):t.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var ha=is;class ns{constructor(e,t=[],i,r=new mh,s=[]){this.registry=e,this.path=t,this.key=t.map(o=>`[${o}]`).join(""),this.scope=r,this.errors=s,this.expectedType=i}parse(e,t,i,r,s={}){return t?this.concat(t,i,r)._parse(e,s):this._parse(e,s)}_parse(e,t){(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number")&&(e=["literal",e]);function i(r,s,o){return o==="assert"?new rt(s,[r]):o==="coerce"?new Yt(s,[r]):r}if(Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=e[0];if(typeof r!="string")return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[r];if(s){let o=s.parse(e,this);if(!o)return null;if(this.expectedType){const a=this.expectedType,l=o.type;if((a.kind==="string"||a.kind==="number"||a.kind==="boolean"||a.kind==="object"||a.kind==="array")&&l.kind==="value")o=i(o,a,t.typeAnnotation||"assert");else if((a.kind==="color"||a.kind==="formatted"||a.kind==="resolvedImage")&&(l.kind==="value"||l.kind==="string"))o=i(o,a,t.typeAnnotation||"coerce");else if(this.checkSubtype(a,l))return null}if(!(o instanceof xn)&&o.type.kind!=="resolvedImage"&&Cr(o)){const a=new aa;try{o=new xn(o.type,o.evaluate(a))}catch(l){return this.error(l.message),null}}return o}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}else return typeof e>"u"?this.error("'undefined' value invalid. Use null instead."):typeof e=="object"?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof e} instead.`)}concat(e,t,i){const r=typeof e=="number"?this.path.concat(e):this.path,s=i?this.scope.concat(i):this.scope;return new ns(this.registry,r,t||null,s,this.errors)}error(e,...t){const i=`${this.key}${t.map(r=>`[${r}]`).join("")}`;this.errors.push(new Ue(i,e))}checkSubtype(e,t){const i=Si(e,t);return i&&this.error(i),i}}var da=ns;function Cr(n){if(n instanceof ha)return Cr(n.boundExpression);if(n instanceof oi&&n.name==="error")return!1;if(n instanceof zn)return!1;if(n instanceof Qr)return!1;const e=n instanceof Yt||n instanceof rt;let t=!0;return n.eachChild(i=>{e?t=t&&Cr(i):t=t&&i instanceof xn}),t?Gn(n)&&ts(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]):!1}function fa(n,e){const t=n.length-1;let i=0,r=t,s=0,o,a;for(;i<=r;)if(s=Math.floor((i+r)/2),o=n[s],a=n[s+1],o<=e){if(s===t||e<a)return s;i=s+1}else if(o>e)r=s-1;else throw new ve("Input is not a number.");return 0}class rs{constructor(e,t,i){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[r,s]of i)this.labels.push(r),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");const i=t.parse(e[1],1,M);if(!i)return null;const r=[];let s=null;t.expectedType&&t.expectedType.kind!=="value"&&(s=t.expectedType);for(let o=1;o<e.length;o+=2){const a=o===1?-1/0:e[o],l=e[o+1],u=o,c=o+1;if(typeof a!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=a)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const h=t.parse(l,c,s);if(!h)return null;s=s||h.type,r.push([a,h])}return new rs(s,i,r)}evaluate(e){const t=this.labels,i=this.outputs;if(t.length===1)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const s=t.length;if(r>=t[s-1])return i[s-1].evaluate(e);const o=fa(t,r);return i[o].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var pa=rs,zh=ai;function ai(n,e,t,i){this.cx=3*n,this.bx=3*(t-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=i,this.p2x=t,this.p2y=i}ai.prototype.sampleCurveX=function(n){return((this.ax*n+this.bx)*n+this.cx)*n};ai.prototype.sampleCurveY=function(n){return((this.ay*n+this.by)*n+this.cy)*n};ai.prototype.sampleCurveDerivativeX=function(n){return(3*this.ax*n+2*this.bx)*n+this.cx};ai.prototype.solveCurveX=function(n,e){typeof e>"u"&&(e=1e-6);var t,i,r,s,o;for(r=n,o=0;o<8;o++){if(s=this.sampleCurveX(r)-n,Math.abs(s)<e)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r=r-s/a}if(t=0,i=1,r=n,r<t)return t;if(r>i)return i;for(;t<i;){if(s=this.sampleCurveX(r),Math.abs(s-n)<e)return r;n>s?t=r:i=r,r=(i-t)*.5+t}return r};ai.prototype.solve=function(n,e){return this.sampleCurveY(this.solveCurveX(n,e))};var Gh=ra(zh);function Ae(n,e,t){return n*(1-t)+e*t}function jh(n,e,t){return new De(Ae(n.r,e.r,t),Ae(n.g,e.g,t),Ae(n.b,e.b,t),Ae(n.a,e.a,t))}function Nh(n,e,t){return n.map((i,r)=>Ae(i,e[r],t))}var Wh=Object.freeze({__proto__:null,number:Ae,color:jh,array:Nh});const ga=.95047,ma=1,ya=1.08883,xa=4/29,Qt=6/29,_a=3*Qt*Qt,Bh=Qt*Qt*Qt,$h=Math.PI/180,qh=180/Math.PI;function Yn(n){return n>Bh?Math.pow(n,1/3):n/_a+xa}function Hn(n){return n>Qt?n*n*n:_a*(n-xa)}function Zn(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function Jn(n){return n/=255,n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function ba(n){const e=Jn(n.r),t=Jn(n.g),i=Jn(n.b),r=Yn((.4124564*e+.3575761*t+.1804375*i)/ga),s=Yn((.2126729*e+.7151522*t+.072175*i)/ma),o=Yn((.0193339*e+.119192*t+.9503041*i)/ya);return{l:116*s-16,a:500*(r-s),b:200*(s-o),alpha:n.a}}function va(n){let e=(n.l+16)/116,t=isNaN(n.a)?e:e+n.a/500,i=isNaN(n.b)?e:e-n.b/200;return e=ma*Hn(e),t=ga*Hn(t),i=ya*Hn(i),new De(Zn(3.2404542*t-1.5371385*e-.4985314*i),Zn(-.969266*t+1.8760108*e+.041556*i),Zn(.0556434*t-.2040259*e+1.0572252*i),n.alpha)}function Vh(n,e,t){return{l:Ae(n.l,e.l,t),a:Ae(n.a,e.a,t),b:Ae(n.b,e.b,t),alpha:Ae(n.alpha,e.alpha,t)}}function Xh(n){const{l:e,a:t,b:i}=ba(n),r=Math.atan2(i,t)*qh;return{h:r<0?r+360:r,c:Math.sqrt(t*t+i*i),l:e,alpha:n.a}}function Uh(n){const e=n.h*$h,t=n.c,i=n.l;return va({l:i,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:n.alpha})}function Yh(n,e,t){const i=e-n;return n+t*(i>180||i<-180?i-360*Math.round(i/360):i)}function Hh(n,e,t){return{h:Yh(n.h,e.h,t),c:Ae(n.c,e.c,t),l:Ae(n.l,e.l,t),alpha:Ae(n.alpha,e.alpha,t)}}const qi={forward:ba,reverse:va,interpolate:Vh},Vi={forward:Xh,reverse:Uh,interpolate:Hh};class bn{constructor(e,t,i,r,s){this.type=e,this.operator=t,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(const[o,a]of s)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,i,r){let s=0;if(e.name==="exponential")s=Kn(t,e.base,i,r);else if(e.name==="linear")s=Kn(t,1,i,r);else if(e.name==="cubic-bezier"){const o=e.controlPoints;s=new Gh(o[0],o[1],o[2],o[3]).solve(Kn(t,1,i,r))}return s}static parse(e,t){let[i,r,s,...o]=e;if(!Array.isArray(r)||r.length===0)return t.error("Expected an interpolation type expression.",1);if(r[0]==="linear")r={name:"linear"};else if(r[0]==="exponential"){const u=r[1];if(typeof u!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:u}}else if(r[0]==="cubic-bezier"){const u=r.slice(1);if(u.length!==4||u.some(c=>typeof c!="number"||c<0||c>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:u}}else return t.error(`Unknown interpolation type ${String(r[0])}`,1,0);if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!==0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,M),!s)return null;const a=[];let l=null;i==="interpolate-hcl"||i==="interpolate-lab"?l=ut:t.expectedType&&t.expectedType.kind!=="value"&&(l=t.expectedType);for(let u=0;u<o.length;u+=2){const c=o[u],h=o[u+1],d=u+3,f=u+4;if(typeof c!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',d);if(a.length&&a[a.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',d);const p=t.parse(h,f,l);if(!p)return null;l=l||p.type,a.push([c,p])}return l.kind!=="number"&&l.kind!=="color"&&!(l.kind==="array"&&l.itemType.kind==="number"&&typeof l.N=="number")?t.error(`Type ${oe(l)} is not interpolatable.`):new bn(l,i,r,s,a)}evaluate(e){const t=this.labels,i=this.outputs;if(t.length===1)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=t[0])return i[0].evaluate(e);const s=t.length;if(r>=t[s-1])return i[s-1].evaluate(e);const o=fa(t,r),a=t[o],l=t[o+1],u=bn.interpolationFactor(this.interpolation,r,a,l),c=i[o].evaluate(e),h=i[o+1].evaluate(e);return this.operator==="interpolate"?Wh[this.type.kind.toLowerCase()](c,h,u):this.operator==="interpolate-hcl"?Vi.reverse(Vi.interpolate(Vi.forward(c),Vi.forward(h),u)):qi.reverse(qi.interpolate(qi.forward(c),qi.forward(h),u))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;this.interpolation.name==="linear"?e=["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?e=["linear"]:e=["exponential",this.interpolation.base]:e=["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)t.push(this.labels[i],this.outputs[i].serialize());return t}}function Kn(n,e,t,i){const r=i-t,s=n-t;return r===0?0:e===1?s/r:(Math.pow(e,s)-1)/(Math.pow(e,r)-1)}var jt=bn;class vn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let i=null;const r=t.expectedType;r&&r.kind!=="value"&&(i=r);const s=[];for(const a of e.slice(1)){const l=t.parse(a,1+s.length,i,void 0,{typeAnnotation:"omit"});if(!l)return null;i=i||l.type,s.push(l)}return r&&s.some(a=>Si(r,a.type))?new vn(B,s):new vn(i,s)}evaluate(e){let t=null,i=0,r;for(const s of this.args){if(i++,t=s.evaluate(e),t&&t instanceof Et&&!t.available&&(r||(r=t),t=null,i===this.args.length))return r;if(t!==null)break}return t}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var wa=vn;class ss{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let s=1;s<e.length-1;s+=2){const o=e[s];if(typeof o!="string")return t.error(`Expected string, but found ${typeof o} instead.`,s);if(/[^a-zA-Z0-9_]/.test(o))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const a=t.parse(e[s+1],s+1);if(!a)return null;i.push([o,a])}const r=t.parse(e[e.length-1],e.length-1,t.expectedType,i);return r?new ss(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,i]of this.bindings)e.push(t,i.serialize());return e.push(this.result.serialize()),e}}var Ca=ss;class os{constructor(e,t,i){this.type=e,this.index=t,this.input=i}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,M),r=t.parse(e[2],2,Be(t.expectedType||B));if(!i||!r)return null;const s=r.type;return new os(s.itemType,i,r)}evaluate(e){const t=this.index.evaluate(e),i=this.input.evaluate(e);if(t<0)throw new ve(`Array index out of bounds: ${t} < 0.`);if(t>=i.length)throw new ve(`Array index out of bounds: ${t} > ${i.length-1}.`);if(t!==Math.floor(t))throw new ve(`Array index must be an integer, but found ${t} instead.`);return i[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Zh=os;class as{constructor(e,t){this.type=W,this.needle=e,this.haystack=t}static parse(e,t){if(e.length!==3)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,B),r=t.parse(e[2],2,B);return!i||!r?null:Vr(i.type,[W,$,M,Ln,B])?new as(i,r):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${oe(i.type)} instead`)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(i==null)return!1;if(!Ti(t,["boolean","string","number","null"]))throw new ve(`Expected first argument to be of type boolean, string, number or null, but found ${oe(ge(t))} instead.`);if(!Ti(i,["string","array"]))throw new ve(`Expected second argument to be of type array or string, but found ${oe(ge(i))} instead.`);return i.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Jh=as;class wn{constructor(e,t,i){this.type=M,this.needle=e,this.haystack=t,this.fromIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,B),r=t.parse(e[2],2,B);if(!i||!r)return null;if(!Vr(i.type,[W,$,M,Ln,B]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${oe(i.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,M);return s?new wn(i,r,s):null}else return new wn(i,r)}evaluate(e){const t=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Ti(t,["boolean","string","number","null"]))throw new ve(`Expected first argument to be of type boolean, string, number or null, but found ${oe(ge(t))} instead.`);if(!Ti(i,["string","array"]))throw new ve(`Expected second argument to be of type array or string, but found ${oe(ge(i))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(e);return i.indexOf(t,r)}return i.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Kh=wn;class ls{constructor(e,t,i,r,s,o){this.inputType=e,this.type=t,this.input=i,this.cases=r,this.outputs=s,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!==1)return t.error("Expected an even number of arguments.");let i,r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);const s={},o=[];for(let u=2;u<e.length-1;u+=2){let c=e[u];const h=e[u+1];Array.isArray(c)||(c=[c]);const d=t.concat(u);if(c.length===0)return d.error("Expected at least one branch label.");for(const p of c){if(typeof p!="number"&&typeof p!="string")return d.error("Branch labels must be numbers or strings.");if(typeof p=="number"&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return d.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof p=="number"&&Math.floor(p)!==p)return d.error("Numeric branch labels must be integer values.");if(!i)i=ge(p);else if(d.checkSubtype(i,ge(p)))return null;if(typeof s[String(p)]<"u")return d.error("Branch labels must be unique.");s[String(p)]=o.length}const f=t.parse(h,u,r);if(!f)return null;r=r||f.type,o.push(f)}const a=t.parse(e[1],1,B);if(!a)return null;const l=t.parse(e[e.length-1],e.length-1,r);return!l||a.type.kind!=="value"&&t.concat(1).checkSubtype(i,a.type)?null:new ls(i,r,a,s,o,l)}evaluate(e){const t=this.input.evaluate(e);return(ge(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),i=[],r={};for(const o of t){const a=r[this.cases[o]];a===void 0?(r[this.cases[o]]=i.length,i.push([this.cases[o],[o]])):i[a][1].push(o)}const s=o=>this.inputType.kind==="number"?Number(o):o;for(const[o,a]of i)a.length===1?e.push(s(a[0])):e.push(a.map(s)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}var Qh=ls;class us{constructor(e,t,i){this.type=e,this.branches=t,this.otherwise=i}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!==0)return t.error("Expected an odd number of arguments.");let i;t.expectedType&&t.expectedType.kind!=="value"&&(i=t.expectedType);const r=[];for(let o=1;o<e.length-1;o+=2){const a=t.parse(e[o],o,W);if(!a)return null;const l=t.parse(e[o+1],o+1,i);if(!l)return null;r.push([a,l]),i=i||l.type}const s=t.parse(e[e.length-1],e.length-1,i);return s?new us(i,r,s):null}evaluate(e){for(const[t,i]of this.branches)if(t.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,i]of this.branches)e(t),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var ed=us;class Cn{constructor(e,t,i,r){this.type=e,this.input=t,this.beginIndex=i,this.endIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=t.parse(e[1],1,B),r=t.parse(e[2],2,M);if(!i||!r)return null;if(!Vr(i.type,[Be(B),$,B]))return t.error(`Expected first argument to be of type array or string, but found ${oe(i.type)} instead`);if(e.length===4){const s=t.parse(e[3],3,M);return s?new Cn(i.type,i,r,s):null}else return new Cn(i.type,i,r)}evaluate(e){const t=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Ti(t,["string","array"]))throw new ve(`Expected first argument to be of type array or string, but found ${oe(ge(t))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(e);return t.slice(i,r)}return t.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var td=Cn;function $s(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function id(n,e,t){return e===t}function nd(n,e,t){return e!==t}function rd(n,e,t){return e<t}function sd(n,e,t){return e>t}function od(n,e,t){return e<=t}function ad(n,e,t){return e>=t}function Sa(n,e,t,i){return i.compare(e,t)===0}function ld(n,e,t,i){return!Sa(n,e,t,i)}function ud(n,e,t,i){return i.compare(e,t)<0}function cd(n,e,t,i){return i.compare(e,t)>0}function hd(n,e,t,i){return i.compare(e,t)<=0}function dd(n,e,t,i){return i.compare(e,t)>=0}function li(n,e,t){const i=n!=="=="&&n!=="!=";return class Ta{constructor(s,o,a){this.type=W,this.lhs=s,this.rhs=o,this.collator=a,this.hasUntypedArgument=s.type.kind==="value"||o.type.kind==="value"}static parse(s,o){if(s.length!==3&&s.length!==4)return o.error("Expected two or three arguments.");const a=s[0];let l=o.parse(s[1],1,B);if(!l)return null;if(!$s(a,l.type))return o.concat(1).error(`"${a}" comparisons are not supported for type '${oe(l.type)}'.`);let u=o.parse(s[2],2,B);if(!u)return null;if(!$s(a,u.type))return o.concat(2).error(`"${a}" comparisons are not supported for type '${oe(u.type)}'.`);if(l.type.kind!==u.type.kind&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error(`Cannot compare types '${oe(l.type)}' and '${oe(u.type)}'.`);i&&(l.type.kind==="value"&&u.type.kind!=="value"?l=new rt(u.type,[l]):l.type.kind!=="value"&&u.type.kind==="value"&&(u=new rt(l.type,[u])));let c=null;if(s.length===4){if(l.type.kind!=="string"&&u.type.kind!=="string"&&l.type.kind!=="value"&&u.type.kind!=="value")return o.error("Cannot use collator to compare non-string types.");if(c=o.parse(s[3],3,Pn),!c)return null}return new Ta(l,u,c)}evaluate(s){const o=this.lhs.evaluate(s),a=this.rhs.evaluate(s);if(i&&this.hasUntypedArgument){const l=ge(o),u=ge(a);if(l.kind!==u.kind||!(l.kind==="string"||l.kind==="number"))throw new ve(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const l=ge(o),u=ge(a);if(l.kind!=="string"||u.kind!=="string")return e(s,o,a)}return this.collator?t(s,o,a,this.collator.evaluate(s)):e(s,o,a)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}serialize(){const s=[n];return this.eachChild(o=>{s.push(o.serialize())}),s}}}const fd=li("==",id,Sa),pd=li("!=",nd,ld),gd=li("<",rd,ud),md=li(">",sd,cd),yd=li("<=",od,hd),xd=li(">=",ad,dd);class cs{constructor(e,t,i,r,s,o){this.type=$,this.number=e,this.locale=t,this.currency=i,this.unit=r,this.minFractionDigits=s,this.maxFractionDigits=o}static parse(e,t){if(e.length!==3)return t.error("Expected two arguments.");const i=t.parse(e[1],1,M);if(!i)return null;const r=e[2];if(typeof r!="object"||Array.isArray(r))return t.error("NumberFormat options argument must be an object.");let s=null;if(r.locale&&(s=t.parse(r.locale,1,$),!s))return null;let o=null;if(r.currency&&(o=t.parse(r.currency,1,$),!o))return null;let a=null;if(r.unit&&(a=t.parse(r.unit,1,$),!a))return null;let l=null;if(r["min-fraction-digits"]&&(l=t.parse(r["min-fraction-digits"],1,M),!l))return null;let u=null;return r["max-fraction-digits"]&&(u=t.parse(r["max-fraction-digits"],1,M),!u)?null:new cs(i,s,o,a,l,u)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency&&"currency"||this.unit&&"unit"||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class hs{constructor(e){this.type=M,this.input=e}static parse(e,t){if(e.length!==2)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=t.parse(e[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?t.error(`Expected argument of type string or array, but found ${oe(i.type)} instead.`):new hs(i):null}evaluate(e){const t=this.input.evaluate(e);if(typeof t=="string")return t.length;if(Array.isArray(t))return t.length;throw new ve(`Expected value to be of type string or array, but found ${oe(ge(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var _d=hs;const Ea={"==":fd,"!=":pd,">":md,"<":gd,">=":xd,"<=":yd,array:rt,at:Zh,boolean:rt,case:ed,coalesce:wa,collator:zn,format:Dn,image:On,in:Jh,"index-of":Kh,interpolate:jt,"interpolate-hcl":jt,"interpolate-lab":jt,length:_d,let:Ca,literal:xn,match:Qh,number:rt,"number-format":cs,object:rt,slice:td,step:pa,string:rt,"to-boolean":Yt,"to-color":Yt,"to-number":Yt,"to-string":Yt,var:ha,within:Qr};function qs(n,[e,t,i,r]){e=e.evaluate(n),t=t.evaluate(n),i=i.evaluate(n);const s=r?r.evaluate(n):1,o=oa(e,t,i,s);if(o)throw new ve(o);return new De(e/255*s,t/255*s,i/255*s,s)}function Vs(n,e){return n in e}function Qn(n,e){const t=e[n];return typeof t>"u"?null:t}function bd(n,e,t,i){for(;t<=i;){const r=t+i>>1;if(e[r]===n)return!0;e[r]>n?i=r-1:t=r+1}return!1}function Dt(n){return{type:n}}oi.register(Ea,{error:[yh,[$],(n,[e])=>{throw new ve(e.evaluate(n))}],typeof:[$,[B],(n,[e])=>oe(ge(e.evaluate(n)))],"to-rgba":[Be(M,4),[ut],(n,[e])=>e.evaluate(n).toArray()],rgb:[ut,[M,M,M],qs],rgba:[ut,[M,M,M,M],qs],has:{type:W,overloads:[[[$],(n,[e])=>Vs(e.evaluate(n),n.properties())],[[$,Kt],(n,[e,t])=>Vs(e.evaluate(n),t.evaluate(n))]]},get:{type:B,overloads:[[[$],(n,[e])=>Qn(e.evaluate(n),n.properties())],[[$,Kt],(n,[e,t])=>Qn(e.evaluate(n),t.evaluate(n))]]},"feature-state":[B,[$],(n,[e])=>Qn(e.evaluate(n),n.featureState||{})],properties:[Kt,[],n=>n.properties()],"geometry-type":[$,[],n=>n.geometryType()],id:[B,[],n=>n.id()],zoom:[M,[],n=>n.globals.zoom],pitch:[M,[],n=>n.globals.pitch||0],"distance-from-center":[M,[],n=>n.distanceFromCenter()],"heatmap-density":[M,[],n=>n.globals.heatmapDensity||0],"line-progress":[M,[],n=>n.globals.lineProgress||0],"sky-radial-progress":[M,[],n=>n.globals.skyRadialProgress||0],accumulated:[B,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[M,Dt(M),(n,e)=>{let t=0;for(const i of e)t+=i.evaluate(n);return t}],"*":[M,Dt(M),(n,e)=>{let t=1;for(const i of e)t*=i.evaluate(n);return t}],"-":{type:M,overloads:[[[M,M],(n,[e,t])=>e.evaluate(n)-t.evaluate(n)],[[M],(n,[e])=>-e.evaluate(n)]]},"/":[M,[M,M],(n,[e,t])=>e.evaluate(n)/t.evaluate(n)],"%":[M,[M,M],(n,[e,t])=>e.evaluate(n)%t.evaluate(n)],ln2:[M,[],()=>Math.LN2],pi:[M,[],()=>Math.PI],e:[M,[],()=>Math.E],"^":[M,[M,M],(n,[e,t])=>Math.pow(e.evaluate(n),t.evaluate(n))],sqrt:[M,[M],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[M,[M],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[M,[M],(n,[e])=>Math.log(e.evaluate(n))],log2:[M,[M],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[M,[M],(n,[e])=>Math.sin(e.evaluate(n))],cos:[M,[M],(n,[e])=>Math.cos(e.evaluate(n))],tan:[M,[M],(n,[e])=>Math.tan(e.evaluate(n))],asin:[M,[M],(n,[e])=>Math.asin(e.evaluate(n))],acos:[M,[M],(n,[e])=>Math.acos(e.evaluate(n))],atan:[M,[M],(n,[e])=>Math.atan(e.evaluate(n))],min:[M,Dt(M),(n,e)=>Math.min(...e.map(t=>t.evaluate(n)))],max:[M,Dt(M),(n,e)=>Math.max(...e.map(t=>t.evaluate(n)))],abs:[M,[M],(n,[e])=>Math.abs(e.evaluate(n))],round:[M,[M],(n,[e])=>{const t=e.evaluate(n);return t<0?-Math.round(-t):Math.round(t)}],floor:[M,[M],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[M,[M],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[W,[$,B],(n,[e,t])=>n.properties()[e.value]===t.value],"filter-id-==":[W,[B],(n,[e])=>n.id()===e.value],"filter-type-==":[W,[$],(n,[e])=>n.geometryType()===e.value],"filter-<":[W,[$,B],(n,[e,t])=>{const i=n.properties()[e.value],r=t.value;return typeof i==typeof r&&i<r}],"filter-id-<":[W,[B],(n,[e])=>{const t=n.id(),i=e.value;return typeof t==typeof i&&t<i}],"filter->":[W,[$,B],(n,[e,t])=>{const i=n.properties()[e.value],r=t.value;return typeof i==typeof r&&i>r}],"filter-id->":[W,[B],(n,[e])=>{const t=n.id(),i=e.value;return typeof t==typeof i&&t>i}],"filter-<=":[W,[$,B],(n,[e,t])=>{const i=n.properties()[e.value],r=t.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[W,[B],(n,[e])=>{const t=n.id(),i=e.value;return typeof t==typeof i&&t<=i}],"filter->=":[W,[$,B],(n,[e,t])=>{const i=n.properties()[e.value],r=t.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[W,[B],(n,[e])=>{const t=n.id(),i=e.value;return typeof t==typeof i&&t>=i}],"filter-has":[W,[B],(n,[e])=>e.value in n.properties()],"filter-has-id":[W,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[W,[Be($)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[W,[Be(B)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[W,[$,Be(B)],(n,[e,t])=>t.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[W,[$,Be(B)],(n,[e,t])=>bd(n.properties()[e.value],t.value,0,t.value.length-1)],all:{type:W,overloads:[[[W,W],(n,[e,t])=>e.evaluate(n)&&t.evaluate(n)],[Dt(W),(n,e)=>{for(const t of e)if(!t.evaluate(n))return!1;return!0}]]},any:{type:W,overloads:[[[W,W],(n,[e,t])=>e.evaluate(n)||t.evaluate(n)],[Dt(W),(n,e)=>{for(const t of e)if(t.evaluate(n))return!0;return!1}]]},"!":[W,[W],(n,[e])=>!e.evaluate(n)],"is-supported-script":[W,[$],(n,[e])=>{const t=n.globals&&n.globals.isSupportedScript;return t?t(e.evaluate(n)):!0}],upcase:[$,[$],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[$,[$],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[$,Dt(B),(n,e)=>e.map(t=>gi(t.evaluate(n))).join("")],"resolved-locale":[$,[Pn],(n,[e])=>e.evaluate(n).resolvedLocale()]});var Ia=Ea;function Sr(n){return{result:"success",value:n}}function Xt(n){return{result:"error",value:n}}function vd(n){return n["property-type"]==="data-driven"}function wd(n){return!!n.expression&&n.expression.parameters.indexOf("zoom")>-1}function Cd(n){return!!n.expression&&n.expression.interpolated}function Ra(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}class Sd{constructor(e,t){this.expression=e,this._warningHistory={},this._evaluator=new aa,this._defaultValue=t?Rd(t):null,this._enumValues=t&&t.type==="enum"?t.values:null}evaluateWithoutErrorHandling(e,t,i,r,s,o,a,l){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=l||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,i,r,s,o,a,l){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=l||null;try{const u=this.expression.evaluate(this._evaluator);if(u==null||typeof u=="number"&&u!==u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new ve(`Expected value to be one of ${Object.keys(this._enumValues).map(c=>JSON.stringify(c)).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,typeof console<"u"&&console.warn(u.message)),this._defaultValue}}}function Td(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in Ia}function Tr(n,e){const t=new da(Ia,[],e?Id(e):void 0),i=t.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return i?Sr(new Sd(i,e)):Xt(t.errors)}class Xs{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!es(t.expression)}evaluateWithoutErrorHandling(e,t,i,r,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,s,o)}evaluate(e,t,i,r,s,o){return this._styleExpression.evaluate(e,t,i,r,s,o)}}class Us{constructor(e,t,i,r){this.kind=e,this.zoomStops=i,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!es(t.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,t,i,r,s,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,i,r,s,o)}evaluate(e,t,i,r,s,o){return this._styleExpression.evaluate(e,t,i,r,s,o)}interpolationFactor(e,t,i){return this.interpolationType?jt.interpolationFactor(this.interpolationType,e,t,i):0}}function Ed(n,e){if(n=Tr(n,e),n.result==="error")return n;const t=n.value.expression,i=Gn(t);if(!i&&!vd(e))return Xt([new Ue("","data expressions not supported")]);const r=ts(t,["zoom","pitch","distance-from-center"]);if(!r&&!wd(e))return Xt([new Ue("","zoom expressions not supported")]);const s=Zi(t);if(!s&&!r)return Xt([new Ue("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(s instanceof Ue)return Xt([s]);if(s instanceof jt&&!Cd(e))return Xt([new Ue("",'"interpolate" expressions cannot be used with this property')]);if(!s)return Sr(i?new Xs("constant",n.value):new Xs("source",n.value));const o=s instanceof jt?s.interpolation:void 0;return Sr(i?new Us("camera",n.value,s.labels,o):new Us("composite",n.value,s.labels,o))}function Zi(n){let e=null;if(n instanceof Ca)e=Zi(n.result);else if(n instanceof wa){for(const t of n.args)if(e=Zi(t),e)break}else(n instanceof pa||n instanceof jt)&&n.input instanceof oi&&n.input.name==="zoom"&&(e=n);return e instanceof Ue||n.eachChild(t=>{const i=Zi(t);i instanceof Ue?e=i:!e&&i?e=new Ue("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&i&&e!==i&&(e=new Ue("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Id(n){const e={color:ut,string:$,number:M,enum:$,boolean:W,formatted:An,resolvedImage:Mi};return n.type==="array"?Be(e[n.value]||B,n.length):e[n.type]}function Rd(n){return n.type==="color"&&(Ra(n.default)||Array.isArray(n.default))?new De(0,0,0,0):n.type==="color"?De.parse(n.default)||null:n.default===void 0?null:n.default}function Fd(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Er(n){if(Array.isArray(n))return n.map(Er);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const t in n)e[t]=Er(n[t]);return e}return Fd(n)}var Fa={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},projection:{type:"projection"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_symbol:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Camera"},pitch:{group:"Camera"},"distance-from-center":{group:"Camera"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},"sky-radial-progress":{group:"sky"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},projection:{name:{type:"enum",values:{albers:{},equalEarth:{},equirectangular:{},lambertConformalConic:{},mercator:{},naturalEarth:{},winkelTripel:{},globe:{}},default:"mercator",required:!0},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["source"]}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["fill-extrusion-edge-radius"]}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};function ka(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!ka(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function kd(n,e="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ka(n)||(n=Sn(n));const t=n;let i=!0;try{i=Md(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(t,null,2)}
        `)}const r=Fa[`filter_${e}`],s=Tr(i,r);let o=null;if(s.result==="error")throw new Error(s.value.map(c=>`${c.key}: ${c.message}`).join(", "));o=(c,h,d)=>s.value.evaluate(c,h,{},d);let a=null,l=null;if(i!==t){const c=Tr(t,r);if(c.result==="error")throw new Error(c.value.map(h=>`${h.key}: ${h.message}`).join(", "));a=(h,d,f,p,m)=>c.value.evaluate(h,d,{},f,void 0,void 0,p,m),l=!Gn(c.value.expression)}o=o;const u=Pa(i);return{filter:o,dynamicFilter:a||void 0,needGeometry:u,needFeature:!!l}}function Md(n){if(!ei(n))return n;let e=Er(n);return La(e),e=Ma(e),e}function Ma(n){if(!Array.isArray(n))return n;const e=Ad(n);return e===!0?e:e.map(t=>Ma(t))}function La(n){let e=!1;const t=[];if(n[0]==="case"){for(let i=1;i<n.length-1;i+=2)e=e||ei(n[i]),t.push(n[i+1]);t.push(n[n.length-1])}else if(n[0]==="match"){e=e||ei(n[1]);for(let i=2;i<n.length-1;i+=2)t.push(n[i+1]);t.push(n[n.length-1])}else if(n[0]==="step"){e=e||ei(n[1]);for(let i=1;i<n.length-1;i+=2)t.push(n[i+1])}e&&(n.length=0,n.push("any",...t));for(let i=1;i<n.length;i++)La(n[i])}function ei(n){if(!Array.isArray(n))return!1;if(Ld(n[0]))return!0;for(let e=1;e<n.length;e++){const t=n[e];if(ei(t))return!0}return!1}function Ld(n){return n==="pitch"||n==="distance-from-center"}const Pd=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ad(n){if(Pd.has(n[0]))for(let e=1;e<n.length;e++){const t=n[e];if(ei(t))return!0}return n}function Dd(n,e){return n<e?-1:n>e?1:0}function Pa(n){if(!Array.isArray(n))return!1;if(n[0]==="within")return!0;for(let e=1;e<n.length;e++)if(Pa(n[e]))return!0;return!1}function Sn(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?er(n[1],n[2],"=="):e==="!="?Xi(er(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?er(n[1],n[2],e):e==="any"?Od(n.slice(1)):e==="all"?["all"].concat(n.slice(1).map(Sn)):e==="none"?["all"].concat(n.slice(1).map(Sn).map(Xi)):e==="in"?Ys(n[1],n.slice(2)):e==="!in"?Xi(Ys(n[1],n.slice(2))):e==="has"?Hs(n[1]):e==="!has"?Xi(Hs(n[1])):e==="within"?n:!0}function er(n,e,t){switch(n){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,n,e]}}function Od(n){return["any"].concat(n.map(Sn))}function Ys(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",n,["literal",e.sort(Dd)]]:["filter-in-small",n,["literal",e]]}}function Hs(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Xi(n){return["!",n]}var zd=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Gd(n,e){const t={};for(const i in n)i!=="ref"&&(t[i]=n[i]);return zd.forEach(i=>{i in e&&(t[i]=e[i])}),t}function Aa(n){n=n.slice();const e=Object.create(null);for(let t=0;t<n.length;t++)e[n[t].id]=n[t];for(let t=0;t<n.length;t++)"ref"in n[t]&&(n[t]=Gd(n[t],e[n[t].ref]));return n}var Zs={thin:100,hairline:100,"ultra-light":100,"extra-light":100,light:200,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,heavy:800,black:800,"extra-bold":800,"ultra-black":900,"extra-black":900,"ultra-bold":900,"heavy-black":900,fat:900,poster:900},ci=" ",Js=/(italic|oblique)$/i,Ks={},jd=function(n,e,t){var i=Ks[n];if(!i){Array.isArray(n)||(n=[n]);for(var r=400,s="normal",o=[],a,l,u=0,c=n.length;u<c;++u){var h=n[u],d=h.split(" "),f=d[d.length-1].toLowerCase();f=="normal"||f=="italic"||f=="oblique"?(s=l?s:f,d.pop(),f=d[d.length-1].toLowerCase()):Js.test(f)&&(f=f.replace(Js,""),s=l?s:d[d.length-1].replace(f,""));for(var p in Zs){var m=d.length>1?d[d.length-2].toLowerCase():"";if(f==p||f==p.replace("-","")||m+"-"+f==p){r=a?r:Zs[p],d.pop(),m&&p.startsWith(m)&&d.pop();break}}!a&&typeof f=="number"&&(r=f);var g=d.join(ci).replace("Klokantech Noto Sans","Noto Sans");g.indexOf(ci)!==-1&&(g='"'+g+'"'),o.push(g)}i=Ks[n]=[s,r,o]}return i[0]+ci+i[1]+ci+e+"px"+(t?"/"+t:"")+ci+i[2]},Ir=ra(jd);const Da="https://api.mapbox.com";function ds(n){const e="mapbox://";return n.indexOf(e)!==0?"":n.slice(e.length)}function Nd(n,e,t){const i=ds(n);if(!i)return decodeURI(new URL(n,t).href);const r="sprites/";if(i.indexOf(r)!==0)throw new Error(`unexpected sprites url: ${n}`);const s=i.slice(r.length);return`${Da}/styles/v1/${s}/sprite?access_token=${e}`}function Tn(n,e){const t=ds(n);if(!t)return decodeURI(new URL(n,location.href).href);const i="styles/";if(t.indexOf(i)!==0)throw new Error(`unexpected style url: ${n}`);const r=t.slice(i.length);return`${Da}/styles/v1/${r}?&access_token=${e}`}function Ji(n,e,t,i){const r=new URL(n,i),s=ds(n);if(!s)return e&&(r.searchParams.has(t)||r.searchParams.set(t,e)),decodeURI(r.href);if(s==="mapbox.satellite"){const o=window.devicePixelRatio>=1.5?"@2x":"";return`https://api.mapbox.com/v4/${s}/{z}/{x}/{y}${o}.webp?access_token=${e}`}return`https://{a-d}.tiles.mapbox.com/v4/${s}/{z}/{x}/{y}.vector.pbf?access_token=${e}`}const Qs={},eo={};let Wd=0;function fs(n){return n.id||(n.id=Wd++),n.id}function Bd(n,e){return fs(n)+"."+Y(e)}function Oa(n){let e=Qs[n.id];return e||(e={},Qs[fs(n)]=e),e}function $d(n){let e=eo[n.id];return e||(e={},eo[fs(n)]=e),e}function tr(n){return n*Math.PI/180}const Tt=function(){const n=[];for(let e=78271.51696402048;n.length<=24;e/=2)n.push(e);return n}(),ir=new Or({extent:me("EPSG:3857").getExtent(),resolutions:Tt});function za(n,e){if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof OffscreenCanvas<"u")return new OffscreenCanvas(n,e);const t=document.createElement("canvas");return t.width=n,t.height=e,t}function ps(n,e){let t=0;const i=e.length;for(;t<i;++t)if(e[t]<n&&t+1<i){const s=e[t]/e[t+1];return t+Math.log(e[t]/n)/Math.log(s)}return i-1}const Vt={};function ri(n,e,t={},i){if(e in Vt)return i&&(i.request=Vt[e][0]),Vt[e][1];const r=t.transformRequest&&t.transformRequest(e,n)||e,s=hn(()=>r).then(o=>(o instanceof Request||(o=new Request(o)),o.headers.get("Accept")||o.headers.set("Accept","application/json"),i&&(i.request=o),fetch(o).then(function(a){return delete Vt[e],a.ok?a.json():Promise.reject(new Error("Error fetching source "+e))}).catch(function(a){return delete Vt[e],Promise.reject(new Error("Error fetching source "+e))})));return Vt[e]=[r,s],s}function Ga(n,e){if(typeof n=="string")if(n.trim().startsWith("{"))try{const t=JSON.parse(n);return Promise.resolve(t)}catch(t){return Promise.reject(t)}else return n=Tn(n,e.accessToken),ri("Style",n,e);else return Promise.resolve(n)}const to={};function ja(n,e,t={}){const i=[e,JSON.stringify(n)].toString();let r=to[i];if(!r||t.transformRequest){let s;t.transformRequest&&(s=(a,l)=>{const u=t.transformRequest&&t.transformRequest(l,"Tiles")||l;if(a instanceof Yo)a.setLoader((c,h,d)=>{hn(()=>u).then(f=>{fetch(f).then(p=>p.arrayBuffer()).then(p=>{const g=a.getFormat().readFeatures(p,{extent:c,featureProjection:d});a.setFeatures(g)}).catch(p=>a.setState(Q.ERROR))})});else{const c=a.getImage();hn(()=>u).then(h=>{h instanceof Request?fetch(h).then(d=>d.blob()).then(d=>{const f=URL.createObjectURL(d);c.addEventListener("load",()=>URL.revokeObjectURL(f)),c.addEventListener("error",()=>URL.revokeObjectURL(f)),c.src=f}).catch(d=>a.setState(Q.ERROR)):c.src=h})}});const o=n.url;if(o&&!n.tiles){const a=Ji(o,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(o.startsWith("mapbox://"))r=Promise.resolve({tileJson:Object.assign({},n,{url:void 0,tiles:fu(a)}),tileLoadFunction:s});else{const l={};r=ri("Source",a,t,l).then(function(u){return u.tiles=u.tiles.map(function(c){return u.scheme==="tms"&&(c=c.replace("{y}","{-y}")),Ji(c,t.accessToken,t.accessTokenParam||"access_token",l.request.url)}),Promise.resolve({tileJson:u,tileLoadFunction:s})})}}else n=Object.assign({},n,{tiles:n.tiles.map(function(a){return n.scheme==="tms"&&(a=a.replace("{y}","{-y}")),Ji(a,t.accessToken,t.accessTokenParam||"access_token",e||location.href)})}),r=Promise.resolve({tileJson:Object.assign({},n),tileLoadFunction:s});to[i]=r}return r}function io(n,e,t,i){const r=document.createElement("canvas"),s=[2*t*e.pixelRatio+e.width,2*t*e.pixelRatio+e.height];r.width=s[0],r.height=s[1];const o=r.getContext("2d");o.drawImage(n,e.x,e.y,e.width,e.height,t*e.pixelRatio,t*e.pixelRatio,e.width,e.height);const a=o.getImageData(0,0,s[0],s[1]);o.globalCompositeOperation="destination-over",o.fillStyle=`rgba(${i.r*255},${i.g*255},${i.b*255},${i.a})`;const l=a.data;for(let u=0,c=a.width;u<c;++u)for(let h=0,d=a.height;h<d;++h){const f=(h*c+u)*4;l[f+3]>0&&o.arc(u,h,t*e.pixelRatio,0,2*Math.PI)}return o.fill(),r}function qd(n,e,t){const i=Math.max(0,Math.min(1,(t-n)/(e-n)));return i*i*(3-2*i)}function no(n,e,t){const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");r.drawImage(n,e.x,e.y,e.width,e.height,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),o=s.data;for(let a=0,l=s.width;a<l;++a)for(let u=0,c=s.height;u<c;++u){const h=(u*l+a)*4,d=o[h+3]/255,f=.75,p=.1,m=qd(f-p,f+p,d);m>0?(o[h+0]=Math.round(255*t.r*m),o[h+1]=Math.round(255*t.g*m),o[h+2]=Math.round(255*t.b*m),o[h+3]=Math.round(255*m)):o[h+3]=0}return r.putImageData(s,0,0),i}const Vd=Array(256).join("");function Rr(n,e){if(e>=.05){let t="";const i=n.split(`
`),r=Vd.slice(0,Math.round(e/.1));for(let s=0,o=i.length;s<o;++s)s>0&&(t+=`
`),t+=i[s].split("").join(r);return t}return n}let nr;function Na(){return nr||(nr=za(1,1).getContext("2d")),nr}function Ot(n,e){return Na().measureText(n).width+(n.length-1)*e}const ro={};function Fr(n,e,t,i){if(n.indexOf(`
`)!==-1){const o=n.split(`
`),a=[];for(let l=0,u=o.length;l<u;++l)a.push(Fr(o[l],e,t,i));return a.join(`
`)}const r=t+","+e+","+n+","+i;let s=ro[r];if(!s){const o=n.split(" ");if(o.length>1){const a=Na();a.font=e;const u=a.measureText("M").width*t;let c="";const h=[];for(let d=0,f=o.length;d<f;++d){const p=o[d],m=c+(c?" ":"")+p;Ot(m,i)<=u?c=m:(c&&h.push(c),c=p)}c&&h.push(c);for(let d=0,f=h.length;d<f&&f>1;++d){const p=h[d];if(Ot(p,i)<u*.35){const m=d>0?Ot(h[d-1],i):1/0,g=d<f-1?Ot(h[d+1],i):1/0;h.splice(d,1),f-=1,m<g?(h[d-1]+=" "+p,d-=1):h[d]=p+" "+h[d]}}for(let d=0,f=h.length-1;d<f;++d){const p=h[d],m=h[d+1];if(Ot(p,i)>u*.7&&Ot(m,i)<u*.6){const g=p.split(" "),y=g.pop();Ot(y,i)<u*.2&&(h[d]=g.join(" "),h[d+1]=y+" "+m),f-=1}}s=h.join(`
`)}else s=n;s=Rr(s,i),ro[r]=s}return s}const Xd=/font-family: ?([^;]*);/,Ud=/("|')/g;let Ui;function Yd(n){if(!Ui){Ui={};const e=document.styleSheets;for(let t=0,i=e.length;t<i;++t){const r=e[t];try{const s=r.rules||r.cssRules;if(s)for(let o=0,a=s.length;o<a;++o){const l=s[o];if(l.type==5){const u=l.cssText.match(Xd);Ui[u[1].replace(Ud,"")]=!0}}}catch{}}}return n in Ui}const rr={};function Hd(n,e="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){const t=n.toString();if(t in rr)return rr[t];const i=[];for(let r=0,s=n.length;r<s;++r){n[r]=n[r].replace("Arial Unicode MS","Arial");const o=n[r],a=Ir(o,1);xo(a);const l=a.split(" ");i.push([l.slice(3).join(" ").replace(/"/g,""),l[1],l[0]])}for(let r=0,s=i.length;r<s;++r){const o=i[r],a=o[0];if(!Yd(a)&&pu.get(`${o[2]}
${o[1]} 
${a}`)!==100){const l=e.replace("{font-family}",a.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",a.replace(/ /g,"+")).replace("{fontweight}",o[1]).replace("{-fontstyle}",o[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",o[2]);if(!document.querySelector('link[href="'+l+'"]')){const u=document.createElement("link");u.href=l,u.rel="stylesheet",document.head.appendChild(u)}}}return rr[t]=n,n}const Zd={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},Jd={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},Kd=function(n,e){const t=Ed(n,e);if(t.result==="error")throw new Error(t.value.map(i=>`${i.key}: ${i.message}`).join(", "));return t.value},kr={},En={zoom:0};let Yi,sr;function z(n,e,t,i,r,s,o){const a=n.id;s||(s={},console.warn("No functionCache provided to getValue()")),s[a]||(s[a]={});const l=s[a];if(!l[t]){let u=(n[e]||kr)[t];const c=Fa[`${e}_${n.type}`][t];u===void 0&&(u=c.default);let h=Td(u);if(!h&&Ra(u)&&(u=uh(u,c),h=!0),h){const d=Kd(u,c);l[t]=d.evaluate.bind(d)}else c.type=="color"&&(u=De.parse(u)),l[t]=function(){return u}}return En.zoom=i,l[t](En,r,o)}function so(n,e,t,i,r){return z(n,"layout",`${i}-allow-overlap`,e,t,r)?z(n,"layout",`${i}-ignore-placement`,e,t,r)?"none":"obstacle":"declutter"}function Qd(n,e,t,i,r){return r||console.warn("No filterCache provided to evaluateFilter()"),n in r||(r[n]=kd(e).filter),En.zoom=i,r[n](En,t)}function pt(n,e){if(n){if(n.a===0||e===0)return;const t=n.a;return e=e===void 0?1:e,t===0?"transparent":"rgba("+Math.round(n.r*255/t)+","+Math.round(n.g*255/t)+","+Math.round(n.b*255/t)+","+t*e+")"}return n}const ef=/\{[^{}}]*\}/g;function or(n,e){return n.replace(ef,function(t){return e[t.slice(1,-1)]||""})}const tf={};function nf(n,e,t,i=Tt,r=void 0,s=void 0,o=void 0,a=void 0){if(typeof e=="string"&&(e=JSON.parse(e)),e.version!=8)throw new Error("glStyle version 8 required.");tf[Bd(e,n)]=Array.from(arguments);let l,u,c;if(s){if(typeof Image<"u"){const T=new Image;let I;hn(()=>s).then(L=>{L instanceof Request?fetch(L).then(D=>D.blob()).then(D=>{I=URL.createObjectURL(D),T.src=I}).catch(()=>{}):(T.crossOrigin="anonymous",T.src=L,I&&URL.revokeObjectURL(I))}),T.onload=function(){l=T,u=[T.width,T.height],n.changed(),T.onload=null}}else if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){const T=self;T.postMessage({action:"loadImage",src:s}),T.addEventListener("message",function(L){L.data.action==="imageLoaded"&&L.data.src===s&&(l=L.data.image,u=[l.width,l.height])})}}const h=Aa(e.layers),d={},f=[],p={},m={},g=Oa(e),y=$d(e);let x;for(let T=0,I=h.length;T<I;++T){const L=h[T],D=L.id;if(typeof t=="string"&&L.source==t||Array.isArray(t)&&t.indexOf(D)!==-1){const F=L["source-layer"];if(x){if(L.source!==x)throw new Error(`Layer "${D}" does not use source "${x}`)}else{x=L.source;const O=e.sources[x];if(!O)throw new Error(`Source "${x}" is not defined`);const R=O.type;if(R!=="vector"&&R!=="geojson")throw new Error(`Source "${x}" is not of type "vector" or "geojson", but "${R}"`)}let C=d[F];C||(C=[],d[F]=C),C.push({layer:L,index:T}),f.push(D)}}const _=new Oi,v=new zi,b=[],E=function(T,I,L){const D=T.getProperties(),F=d[D.layer];if(!F)return;let C=i.indexOf(I);C==-1&&(C=ps(I,i));const O=Zd[T.getGeometry().getType()],R={id:T.getId(),properties:D,type:O},w=n.get("mapbox-featurestate")[T.getId()];let k=-1;for(let G=0,N=F.length;G<N;++G){const ee=F[G],S=ee.layer,H=S.id;if(L!==void 0&&L!==H)continue;const te=S.layout||kr,le=S.paint||kr;if(te.visibility==="none"||"minzoom"in S&&C<S.minzoom||"maxzoom"in S&&C>=S.maxzoom)continue;const P=S.filter;if(!P||Qd(H,P,R,C,y)){let de,we,Le,fe,ke,A;const Ze=ee.index;if(O==3&&(S.type=="fill"||S.type=="fill-extrusion"))if(we=z(S,"paint",S.type+"-opacity",C,R,g,w),S.type+"-pattern"in le){const K=z(S,"paint",S.type+"-pattern",C,R,g,w);if(K){const Z=typeof K=="string"?or(K,D):K.toString();if(l&&r&&r[Z]){++k,A=b[k],(!A||!A.getFill()||A.getStroke()||A.getText())&&(A=new Wt({fill:new zi}),b[k]=A),Le=A.getFill(),A.setZIndex(Ze);const J=Z+"."+we;let ie=m[J];if(!ie){const q=r[Z],V=za(q.width,q.height),ae=V.getContext("2d");ae.globalAlpha=we,ae.drawImage(l,q.x,q.y,q.width,q.height,0,0,q.width,q.height),ie=ae.createPattern(V,"repeat"),m[J]=ie}Le.setColor(ie)}}}else de=pt(z(S,"paint",S.type+"-color",C,R,g,w),we),S.type+"-outline-color"in le&&(ke=pt(z(S,"paint",S.type+"-outline-color",C,R,g,w),we)),ke||(ke=de),(de||ke)&&(++k,A=b[k],(!A||de&&!A.getFill()||!de&&A.getFill()||ke&&!A.getStroke()||!ke&&A.getStroke()||A.getText())&&(A=new Wt({fill:de?new zi:void 0,stroke:ke?new Oi:void 0}),b[k]=A),de&&(Le=A.getFill(),Le.setColor(de)),ke&&(fe=A.getStroke(),fe.setColor(ke),fe.setWidth(.5)),A.setZIndex(Ze));if(O!=1&&S.type=="line"){"line-pattern"in le?de=void 0:de=pt(z(S,"paint","line-color",C,R,g,w),z(S,"paint","line-opacity",C,R,g,w));const K=z(S,"paint","line-width",C,R,g,w);de&&K>0&&(++k,A=b[k],(!A||!A.getStroke()||A.getFill()||A.getText())&&(A=new Wt({stroke:new Oi}),b[k]=A),fe=A.getStroke(),fe.setLineCap(z(S,"layout","line-cap",C,R,g,w)),fe.setLineJoin(z(S,"layout","line-join",C,R,g,w)),fe.setMiterLimit(z(S,"layout","line-miter-limit",C,R,g,w)),fe.setColor(de),fe.setWidth(K),fe.setLineDash(le["line-dasharray"]?z(S,"paint","line-dasharray",C,R,g,w).map(function(Z){return Z*K}):null),A.setZIndex(Ze))}let It=!1,X=null,Li=0,ct,ce,Rt;if((O==1||O==2)&&"icon-image"in te){const K=z(S,"layout","icon-image",C,R,g,w);if(K){ct=typeof K=="string"?or(K,D):K.toString();let Z;const J=a?a(n,ct):void 0;if(l&&r&&r[ct]||J){const ie=z(S,"layout","icon-rotation-alignment",C,R,g,w);if(O==2){const q=T.getGeometry();if(q.getFlatMidpoint||q.getFlatMidpoints){const V=q.getExtent();if(Math.sqrt(Math.max(Math.pow((V[2]-V[0])/I,2),Math.pow((V[3]-V[1])/I,2)))>150){const se=q.getType()==="MultiLineString"?q.getFlatMidpoints():q.getFlatMidpoint();if(sr||(Yi=[NaN,NaN],sr=new _e("Point",Yi,[],2,{},void 0)),Z=sr,Yi[0]=se[0],Yi[1]=se[1],z(S,"layout","symbol-placement",C,R,g,w)==="line"&&ie==="map"){const ye=q.getStride(),xe=q.getFlatCoordinates();for(let Ce=0,ne=xe.length-ye;Ce<ne;Ce+=ye){const Ee=xe[Ce],Se=xe[Ce+1],Ie=xe[Ce+ye],he=xe[Ce+ye+1],qe=Math.min(Ee,Ie),Mt=Math.min(Se,he),Lt=Math.max(Ee,Ie),Pi=Math.max(Se,he);if(se[0]>=qe&&se[0]<=Lt&&se[1]>=Mt&&se[1]<=Pi){Li=Math.atan2(Se-he,Ie-Ee);break}}}}}}if(O!==2||Z){const q=z(S,"layout","icon-size",C,R,g,w),V=le["icon-color"]!==void 0?z(S,"paint","icon-color",C,R,g,w):null;if(!V||V.a!==0){const ae=z(S,"paint","icon-halo-color",C,R,g,w),se=z(S,"paint","icon-halo-width",C,R,g,w);let Te=`${ct}.${q}.${se}.${ae}`;if(V!==null&&(Te+=`.${V}`),ce=p[Te],!ce){const ye=so(S,C,R,"icon",g);let xe;"icon-offset"in te&&(xe=z(S,"layout","icon-offset",C,R,g,w).slice(0),xe[0]*=q,xe[1]*=-q);let Ce=V?[V.r*255,V.g*255,V.b*255,V.a]:void 0;if(J){const ne={color:Ce,rotateWithView:ie==="map",displacement:xe,declutterMode:ye,scale:q};typeof J=="string"?ne.src=J:(ne.img=J,ne.imgSize=[J.width,J.height]),ce=new dr(ne)}else{const ne=r[ct];let Ee,Se,Ie;se?ne.sdf?(Ee=io(no(l,ne,V||[0,0,0,1]),{x:0,y:0,width:ne.width,height:ne.height,pixelRatio:ne.pixelRatio},se,ae),Ce=void 0):Ee=io(l,ne,se,ae):(ne.sdf?(c||(c=no(l,{x:0,y:0,width:u[0],height:u[1]},{r:1,g:1,b:1,a:1})),Ee=c):Ee=l,Se=[ne.width,ne.height],Ie=[ne.x,ne.y]),ce=new dr({color:Ce,img:Ee,imgSize:u,size:Se,offset:Ie,rotateWithView:ie==="map",scale:q/ne.pixelRatio,displacement:xe,declutterMode:ye})}p[Te]=ce}}ce&&(++k,A=b[k],(!A||!A.getImage()||A.getFill()||A.getStroke())&&(A=new Wt,b[k]=A),A.setGeometry(Z),ce.setRotation(Li+tr(z(S,"layout","icon-rotate",C,R,g,w))),ce.setOpacity(z(S,"paint","icon-opacity",C,R,g,w)),ce.setAnchor(Jd[z(S,"layout","icon-anchor",C,R,g,w)]),A.setImage(ce),X=A.getText(),A.setText(void 0),A.setZIndex(Ze),It=!0,Rt=!1)}else Rt=!0}}}if(O==1&&S.type==="circle"){++k,A=b[k],(!A||!A.getImage()||A.getFill()||A.getStroke())&&(A=new Wt,b[k]=A);const K="circle-radius"in le?z(S,"paint","circle-radius",C,R,g,w):5,Z=pt(z(S,"paint","circle-stroke-color",C,R,g,w),z(S,"paint","circle-stroke-opacity",C,R,g,w)),J=z(S,"paint","circle-translate",C,R,g,w),ie=pt(z(S,"paint","circle-color",C,R,g,w),z(S,"paint","circle-opacity",C,R,g,w)),q=z(S,"paint","circle-stroke-width",C,R,g,w),V=K+"."+Z+"."+ie+"."+q+"."+J[0]+"."+J[1];ce=p[V],ce||(ce=new gu({radius:K,displacement:[J[0],-J[1]],stroke:Z&&q>0?new Oi({width:q,color:Z}):void 0,fill:ie?new zi({color:ie}):void 0,declutterMode:"none"}),p[V]=ce),A.setImage(ce),X=A.getText(),A.setText(void 0),A.setGeometry(void 0),A.setZIndex(Ze),It=!0}let pe,Ft,kt,$e,Je,ui;if("text-field"in te){$e=Math.round(z(S,"layout","text-size",C,R,g,w));const K=z(S,"layout","text-font",C,R,g,w);kt=z(S,"layout","text-line-height",C,R,g,w),Ft=Ir(o?o(K,e.metadata?e.metadata["ol:webfonts"]:void 0):K,$e,kt),Ft.includes("sans-serif")||(Ft+=",sans-serif"),Je=z(S,"layout","text-letter-spacing",C,R,g,w),ui=z(S,"layout","text-max-width",C,R,g,w);const Z=z(S,"layout","text-field",C,R,g,w);typeof Z=="object"&&Z.sections?Z.sections.length===1?pe=Z.toString():pe=Z.sections.reduce((J,ie,q)=>{const V=ie.fontStack?ie.fontStack.split(","):K,ae=Ir(o?o(V):V,$e*(ie.scale||1),kt);let se=ie.text;if(se===`
`)return J.push(`
`,""),J;if(O==2){J.push(Rr(se,Je),ae);return}se=Fr(se,ae,ui,Je).split(`
`);for(let Te=0,ye=se.length;Te<ye;++Te)Te>0&&J.push(`
`,""),J.push(se[Te],ae);return J},[]):pe=or(Z,D).trim(),we=z(S,"paint","text-opacity",C,R,g,w)}if(pe&&we&&!Rt){It||(++k,A=b[k],(!A||!A.getText()||A.getFill()||A.getStroke())&&(A=new Wt,b[k]=A),A.setImage(void 0),A.setGeometry(void 0));const K=so(S,C,R,"text",g);A.getText()||A.setText(X),X=A.getText(),(!X||"getDeclutterMode"in X&&X.getDeclutterMode()!==K)&&(X=new mu({padding:[2,2,2,2],declutterMode:K}),A.setText(X));const Z=z(S,"layout","text-transform",C,R,g,w);Z=="uppercase"?pe=Array.isArray(pe)?pe.map((he,qe)=>qe%2?he:he.toUpperCase()):pe.toUpperCase():Z=="lowercase"&&(pe=Array.isArray(pe)?pe.map((he,qe)=>qe%2?he:he.toLowerCase()):pe.toLowerCase());const J=Array.isArray(pe)?pe:O==2?Rr(pe,Je):Fr(pe,Ft,ui,Je);X.setText(J),X.setFont(Ft),X.setRotation(tr(z(S,"layout","text-rotate",C,R,g,w)));const ie=z(S,"layout","text-anchor",C,R,g,w),q=It||O==1?"point":z(S,"layout","symbol-placement",C,R,g,w);let V;if(q==="line-center"?(X.setPlacement("line"),V="center"):X.setPlacement(q),q==="line"&&typeof X.setRepeat=="function"){const he=z(S,"layout","symbol-spacing",C,R,g,w);X.setRepeat(he*2)}X.setOverflow(q==="point");let ae=z(S,"paint","text-halo-width",C,R,g,w);const se=z(S,"layout","text-offset",C,R,g,w),Te=z(S,"paint","text-translate",C,R,g,w);let ye=0,xe=0;if(q=="point"){V="center",ie.indexOf("left")!==-1?(V="left",xe=ae):ie.indexOf("right")!==-1&&(V="right",xe=-ae);const he=z(S,"layout","text-rotation-alignment",C,R,g,w);X.setRotateWithView(he=="map")}else X.setMaxAngle(tr(z(S,"layout","text-max-angle",C,R,g,w))*pe.length/J.length),X.setRotateWithView(!1);X.setTextAlign(V);let Ce="middle";ie.indexOf("bottom")==0?(Ce="bottom",ye=-ae-.5*(kt-1)*$e):ie.indexOf("top")==0&&(Ce="top",ye=ae+.5*(kt-1)*$e),X.setTextBaseline(Ce);const ne=z(S,"layout","text-justify",C,R,g,w);X.setJustify(ne==="auto"?void 0:ne),X.setOffsetX(se[0]*$e+xe+Te[0]),X.setOffsetY(se[1]*$e+ye+Te[1]),v.setColor(pt(z(S,"paint","text-color",C,R,g,w),we)),X.setFill(v);const Ee=pt(z(S,"paint","text-halo-color",C,R,g,w),we);if(Ee&&ae>0){_.setColor(Ee),ae*=2;const he=.5*$e;_.setWidth(ae<=he?ae:he),X.setStroke(_)}else X.setStroke(void 0);const Se=z(S,"layout","text-padding",C,R,g,w),Ie=X.getPadding();Se!==Ie[0]&&(Ie[0]=Se,Ie[1]=Se,Ie[2]=Se,Ie[3]=Se),A.setZIndex(Ze)}}}if(k>-1)return b.length=k+1,b};return n.setStyle(E),n.set("mapbox-source",x),n.set("mapbox-layers",f),n.set("mapbox-featurestate",n.get("mapbox-featurestate")||{}),E}function rf(n,e){const t=n[0],i=t.width,r=t.height,s=t.data,o=new Uint8ClampedArray(s.length),a=e.resolution*2,l=i-1,u=r-1,c=[0,0,0,0],h=2*Math.PI,d=Math.PI/2,f=Math.PI*e.sunEl/180,p=Math.PI*e.sunAz/180,m=Math.cos(f),g=Math.sin(f),y=e.highlightColor,x=e.shadowColor,_=e.accentColor,v=e.encoding;let b,E,T,I,L,D,F,C,O,R,w,k,G,N,ee,S,H,te,le,P,de,we;function Le(fe,ke="mapbox"){if(ke==="mapbox")return(fe[0]*256*256+fe[1]*256+fe[2])*.1-1e4;if(ke==="terrarium")return fe[0]*256+fe[1]+fe[2]/256-32768}for(E=0;E<=u;++E)for(L=E===0?0:E-1,D=E===u?u:E+1,b=0;b<=l;++b)T=b===0?0:b-1,I=b===l?l:b+1,F=(E*i+T)*4,c[0]=s[F],c[1]=s[F+1],c[2]=s[F+2],c[3]=s[F+3],C=e.vert*Le(c,v),F=(E*i+I)*4,c[0]=s[F],c[1]=s[F+1],c[2]=s[F+2],c[3]=s[F+3],O=e.vert*Le(c,v),R=(O-C)/a,F=(L*i+b)*4,c[0]=s[F],c[1]=s[F+1],c[2]=s[F+2],c[3]=s[F+3],C=e.vert*Le(c,v),F=(D*i+b)*4,c[0]=s[F],c[1]=s[F+1],c[2]=s[F+2],c[3]=s[F+3],O=e.vert*Le(c,v),w=(O-C)/a,G=Math.atan2(w,-R),G<0?G=d-G:G>d?G=h-G+d:G=d-G,k=Math.atan(Math.sqrt(R*R+w*w)),we=g*Math.cos(k)+m*Math.sin(k)*Math.cos(p-G),N=Math.cos(k),ee=255*we,le=Math.min(Math.max(2*e.sunEl,0),1),P=1.875-e.opacity*1.75,de=e.opacity!==.5?d*((Math.pow(P,k)-1)/(Math.pow(P,d)-1)):k,H={r:(1-N)*_.r*le*255,g:(1-N)*_.g*le*255,b:(1-N)*_.b*le*255,a:(1-N)*_.a*le*255},S=Math.abs(((G+p)/Math.PI+.5)%2-1),te={r:(y.r*(1-S)+x.r*S)*ee,g:(y.g*(1-S)+x.g*S)*ee,b:(y.b*(1-S)+x.b*S)*ee,a:(y.a*(1-S)+x.a*S)*ee},F=(E*i+b)*4,o[F]=H.r*(1-S)+te.r,o[F+1]=H.g*(1-S)+te.g,o[F+2]=H.b*(1-S)+te.b,o[F+3]=s[F+3]*e.opacity*le*Math.sin(de);return new ImageData(o,i,r)}function sf(n,e=512){return n.getExtent()?Dr({extent:n.getExtent(),tileSize:e,maxZoom:22}).getResolutions():Tt}function Wa(n,e){return e.accessToken||(e=Object.assign({},e),new URL(n).searchParams.forEach((i,r)=>{e.accessToken=i,e.accessTokenParam=r})),e}function of(n,e,t="",i={},r=void 0){let s,o,a,l,u=!0;return typeof t!="string"&&!Array.isArray(t)?(a=t,l=a.source||a.layers,i=a):l=t,typeof i=="string"?(s=i,a={}):(s=i.styleUrl,a=i),a.updateSource===!1&&(u=!1),r||(r=a.resolutions),!s&&typeof e=="string"&&!e.trim().startsWith("{")&&(s=e),s&&(s=s.startsWith("data:")?location.href:Tn(s,a.accessToken),a=Wa(s,a)),new Promise(function(c,h){Ga(e,a).then(function(d){if(d.version!=8)return h(new Error("glStyle version 8 required."));if(!(n instanceof jr||n instanceof fi))return h(new Error("Can only apply to VectorLayer or VectorTileLayer"));const f=n instanceof fi?"vector":"geojson";if(l?Array.isArray(l)?o=d.layers.find(function(v){return v.id===l[0]}).source:o=l:(o=Object.keys(d.sources).find(function(v){return d.sources[v].type===f}),l=o),!o)return h(new Error(`No ${f} source found in the glStyle.`));function p(){if(!u)return Promise.resolve();if(n instanceof fi)return qa(d.sources[o],s,a).then(function(T){const I=n.getSource();if(I?T!==I&&(I.setTileUrlFunction(T.getTileUrlFunction()),typeof I.setUrls=="function"&&typeof T.getUrls=="function"&&I.setUrls(T.getUrls()),I.format_||(I.format_=T.format_),I.getAttributions()||I.setAttributions(T.getAttributions()),I.getTileLoadFunction()===na&&I.setTileLoadFunction(T.getTileLoadFunction()),en(I.getProjection(),T.getProjection())&&(I.tileGrid=T.getTileGrid())):n.setSource(T),!isFinite(n.getMaxResolution())&&!isFinite(n.getMinZoom())){const L=n.getSource().getTileGrid();n.setMaxResolution(L.getResolution(L.getMinZoom()))}});const v=d.sources[o];let b=n.getSource();(!b||b.get("mapbox-source")!==v)&&(b=Ua(v,s,a));const E=n.getSource();return E?b!==E&&(E.getAttributions()||E.setAttributions(b.getAttributions()),E.format_||(E.format_=b.getFormat()),E.url_=b.getUrl()):n.setSource(b),Promise.resolve()}let m,g,y,x;function _(){if(!x&&(!d.sprite||g)){if(a.projection&&!r){const b=me(a.projection).getUnits();b!=="m"&&(r=Tt.map(E=>E/pr[b]))}x=nf(n,d,l,r,g,y,Hd,a.getImage),n.getStyle()?p().then(c).catch(h):h(new Error(`Nothing to show for source [${o}]`))}else x?(n.setStyle(x),p().then(c).catch(h)):h(new Error("Something went wrong trying to apply style."))}if(d.sprite){const v=new URL(Nd(d.sprite,a.accessToken,s||location.href));m=window.devicePixelRatio>=1.5?.5:1;const b=m==.5?"@2x":"";let E=v.origin+v.pathname+b+".json"+v.search;new Promise(function(T,I){ri("Sprite",E,a).then(T).catch(function(L){E=v.origin+v.pathname+".json"+v.search,ri("Sprite",E,a).then(T).catch(I)})}).then(function(T){if(T===void 0&&h(new Error("No sprites found.")),g=T,y=v.origin+v.pathname+b+".png"+v.search,a.transformRequest){const I=a.transformRequest(y,"SpriteImage")||y;(I instanceof Request||I instanceof Promise)&&(y=I)}_()}).catch(function(T){h(new Error(`Sprites cannot be loaded: ${E}: ${T.message}`))})}else _()}).catch(h)})}const mt={};function Ba(n,e){let t;return n.some(function(i){if(i.id==e)return t=i.source,!0}),t}function af(n,e){const t=n.bounds;if(t){const i=gr([t[0],t[1]],e),r=gr([t[2],t[3]],e);return[i[0],i[1],r[0],r[1]]}return me(e).getExtent()}function $a(n,e,t){const i=new ta({tileJSON:e,tileSize:n.tileSize||e.tileSize||512}),r=i.getTileJSON(),s=i.getTileGrid(),o=me(t.projection||"EPSG:3857"),a=af(r,o),l=o.getExtent(),u=r.minzoom||0,c=r.maxzoom||22,h={attributions:i.getAttributions(),projection:o,tileGrid:new Or({origin:l?Lo(l):s.getOrigin(0),extent:a||s.getExtent(),minZoom:u,resolutions:sf(o,e.tileSize).slice(0,c+1),tileSize:s.getTileSize(0)})};return Array.isArray(r.tiles)?h.urls=r.tiles:h.url=r.tiles,h}function lf(n,e,t,i){const r={id:n.id,type:n.type},s=n.layout||{},o=n.paint||{};r.paint=o;const a=ps(e,t.resolutions||Tt);let l;const u=z(r,"paint","background-color",a,mt,i);return o["background-opacity"]!==void 0&&(l=z(r,"paint","background-opacity",a,mt,i)),s.visibility=="none"?void 0:pt(u,l)}function uf(n,e,t){const i=document.createElement("div");return i.className="ol-mapbox-style-background",i.style.position="absolute",i.style.width="100%",i.style.height="100%",new Ro({source:new Ri({}),render(r){const s=lf(n,r.viewState.resolution,e,t);return i.style.backgroundColor=s,i}})}function qa(n,e,t){return new Promise(function(i,r){ja(n,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=$a(n,s,t);a.tileLoadFunction=o,a.format=new Nc,i(new ia(a))}).catch(r)})}function cf(n,e,t){const i=new fi({declutter:!0,visible:!1});return qa(n,e,t).then(function(r){r.set("mapbox-source",n),i.setSource(r)}).catch(function(r){i.setSource(void 0)}),i}function Va(n){return`{bbox-${(n?n.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function hf(n,e,t){return new Promise(function(i,r){ja(n,e,t).then(function({tileJson:s,tileLoadFunction:o}){const a=new ta({interpolate:t.interpolate===void 0?!0:t.interpolate,transition:0,crossOrigin:"anonymous",tileJSON:s});a.tileGrid=$a(n,s,t).tileGrid,t.projection&&(a.projection=me(t.projection));const l=a.getTileUrlFunction();o&&a.setTileLoadFunction(o),a.setTileUrlFunction(function(u,c,h){const d=Va(h);let f=l(u,c,h);if(f.indexOf(d)!=-1){const p=a.getTileGrid().getTileCoordExtent(u);f=f.replace(d,p.toString())}return f}),a.set("mapbox-source",n),i(a)}).catch(function(s){r(s)})})}function Xa(n,e,t){const i=new ko;return hf(n,e,t).then(function(r){i.setSource(r)}).catch(function(){i.setSource(void 0)}),i}function df(n,e,t){const i=Xa(n,e,t);return new Ho({source:new ea({operationType:"image",operation:rf,sources:[i]})})}function Ua(n,e,t){const i=t.projection?new Cs({dataProjection:t.projection}):new Cs,r=n.data,s={};if(typeof r=="string"){const a=Ji(r,t.accessToken,t.accessTokenParam||"access_token",e||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(a)){const u=(h,d,f)=>{const p=Va(f);return a.replace(p,`${h.join(",")}`)},c=new Hi({attributions:n.attribution,format:i,loader:(h,d,f,p,m)=>{const g=typeof u=="function"?u(h,d,f):u;ri("GeoJSON",g,t).then(y=>{const x=c.getFormat().readFeatures(y,{featureProjection:f});c.addFeatures(x),p(x)}).catch(y=>{c.removeLoadedExtent(h),m()})},strategy:pc});return c.set("mapbox-source",n),c}const l=new Hi({attributions:n.attribution,format:i,url:a,loader:(u,c,h,d,f)=>{ri("GeoJSON",a,t).then(p=>{const m=l.getFormat().readFeatures(p,{featureProjection:h});l.addFeatures(m),d(m)}).catch(p=>{l.removeLoadedExtent(u),f()})}});return l}s.features=i.readFeatures(r,{featureProjection:cn()||"EPSG:3857"});const o=new Hi(Object.assign({attributions:n.attribution,format:i},s));return o.set("mapbox-source",n),o}function ff(n,e,t){return new jr({declutter:!0,source:Ua(n,e,t),visible:!1})}function pf(n,e,t){let i=null;return function(r){n.paint&&"raster-opacity"in n.paint&&r.frameState.viewState.zoom!==i&&(i=r.frameState.viewState.zoom,delete t[n.id],gf(n,e,i,t))}}function gf(n,e,t,i){const r=z(n,"paint","raster-opacity",t,mt,i);e.setOpacity(r)}function mf(n,e){function t(){const i=e.get("mapbox-style");if(!i)return;const r=Aa(i.layers),s=n.get("mapbox-layers"),o=r.filter(function(a){return s.includes(a.id)}).some(function(a){return!a.layout||!a.layout.visibility||a.layout.visibility==="visible"});n.get("visible")!==o&&n.setVisible(o)}n.on("change",t),t()}function yf(n,e,t,i){const r=Oa(n),s=n.layers,o=t.type,a=t.source||Ba(s,t.ref),l=n.sources[a];let u;if(o=="background")u=uf(t,i,r);else if(l.type=="vector")u=cf(l,e,i);else if(l.type=="raster")u=Xa(l,e,i),u.setVisible(t.layout?t.layout.visibility!=="none":!0),u.on("prerender",pf(t,u,r));else if(l.type=="geojson")u=ff(l,e,i);else if(l.type=="raster-dem"&&t.type=="hillshade"){const h=df(l,e,i);u=h,h.getSource().on("beforeoperations",function(d){const f=d.data;f.resolution=d.resolution;const p=ps(d.resolution,i.resolutions||Tt);f.encoding=l.encoding,f.vert=5*z(t,"paint","hillshade-exaggeration",p,mt,r),f.sunAz=z(t,"paint","hillshade-illumination-direction",p,mt,r),f.sunEl=35,f.opacity=.3,f.highlightColor=z(t,"paint","hillshade-highlight-color",p,mt,r),f.shadowColor=z(t,"paint","hillshade-shadow-color",p,mt,r),f.accentColor=z(t,"paint","hillshade-accent-color",p,mt,r)}),u.setVisible(t.layout?t.layout.visibility!=="none":!0)}const c=a;return u&&u.set("mapbox-source",c),u}function oo(n,e,t,i){const r=[];let s=null;if(e instanceof Ao){if(s=e.getView(),!s.isDef()&&!s.getRotation()&&!s.getResolutions()){const h=i.projection?me(i.projection):s.getProjection();s=new du(Object.assign(s.getProperties(),{maxResolution:Tt[0]/pr[h.getUnits()],projection:i.projection||s.getProjection()})),e.setView(s)}"center"in n&&!s.getCenter()&&s.setCenter(gr(n.center,s.getProjection())),"zoom"in n&&s.getZoom()===void 0&&s.setResolution(Tt[0]/pr[s.getProjection().getUnits()]/Math.pow(2,n.zoom)),(!s.getCenter()||s.getZoom()===void 0)&&s.fit(s.getProjection().getExtent(),{nearest:!0,size:e.getSize()})}e.set("mapbox-style",n),e.set("mapbox-metadata",{styleUrl:t,options:i});const o=n.layers;let a=[],l,u,c;for(let h=0,d=o.length;h<d;++h){const f=o[h],p=f.type;if(p=="heatmap"){console.debug(`layers[${h}].type "${p}" not supported`);continue}else c=f.source||Ba(o,f.ref),(!c||c!=u)&&(a.length&&(r.push(ao(l,a,n,t,e,i)),a=[]),l=yf(n,t,f,i),l instanceof jr||l instanceof fi||(a=[]),u=l.get("mapbox-source")),a.push(f.id)}return r.push(ao(l,a,n,t,e,i)),Promise.all(r)}function bf(n,e,t={}){let i,r;if(typeof n=="string"||n instanceof HTMLElement?r=new Ao({target:n}):r=n,typeof e=="string"){const s=e.startsWith("data:")?location.href:Tn(e,t.accessToken);t=Wa(s,t),i=new Promise(function(o,a){Ga(e,t).then(function(l){oo(l,r,s,t).then(function(){o(r)}).catch(a)}).catch(function(l){a(new Error(`Could not load ${e}: ${l.message}`))})})}else i=new Promise(function(s,o){oo(e,r,!t.styleUrl||t.styleUrl.startsWith("data:")?location.href:Tn(t.styleUrl,t.accessToken),t).then(function(){s(r)}).catch(o)});return i}function ao(n,e,t,i,r,s={}){let o=24,a=0;const l=t.layers;for(let u=0,c=l.length;u<c;++u){const h=l[u];e.indexOf(h.id)!==-1&&(o=Math.min("minzoom"in h?h.minzoom:0,o),a=Math.max("maxzoom"in h?h.maxzoom:24,a))}return new Promise(function(u,c){const h=function(){const f=n.getSource();if(!f||f.getState()==="error"){c(new Error("Error accessing data for source "+n.get("mapbox-source")));return}if("getTileGrid"in f){const p=f.getTileGrid();if(p){const m=p.getMinZoom();(o>0||m>0)&&n.setMaxResolution(Math.min(ir.getResolution(o),p.getResolution(m))+1e-9),a<24&&n.setMinResolution(ir.getResolution(a)+1e-9)}}else o>0&&n.setMaxResolution(ir.getResolution(o)+1e-9);f instanceof Hi||f instanceof ia?of(n,t,e,Object.assign({styleUrl:i},s)).then(function(){mf(n,r),u()}).catch(c):u()};n.set("mapbox-layers",e);const d=r.getLayers();d.getArray().indexOf(n)===-1&&d.push(n),n.getSource()?h():n.once("change:source",h)})}export{kn as F,Cs as G,Nt as L,Fi as M,Rs as R,jr as V,Hi as a,Ve as b,bf as c,vi as d,wi as e,xu as f};
